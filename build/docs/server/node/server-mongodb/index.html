<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-server/node/server-mongodb">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">mongodb | WEB - 前端开发</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/server/node/server-mongodb"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="mongodb | WEB - 前端开发"><meta data-rh="true" name="description" content="非关系型数据库-基于分布式文件存储的NoSQL"><meta data-rh="true" property="og:description" content="非关系型数据库-基于分布式文件存储的NoSQL"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/server/node/server-mongodb"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/server/node/server-mongodb" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/server/node/server-mongodb" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="WEB - 前端开发 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="WEB - 前端开发 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.99c6e2a1.css">
<link rel="preload" href="/assets/js/runtime~main.4efd6171.js" as="script">
<link rel="preload" href="/assets/js/main.bda8fe25.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/photo.jpg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/photo.jpg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">我的WEB文档</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/other-weblinks">文档</a><a href="https://github.com/liaozhongxun" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/blogtype/play-rtsp-video">blogtype</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/book/js/JavaScript 核心进阶">book</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/database/">时序库</a><button aria-label="Toggle the collapsible sidebar category &#x27;时序库&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/idea/idea-sublime">idea</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/linux/">linux</a><button aria-label="Toggle the collapsible sidebar category &#x27;linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/other/other-algorithm">other</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/other-weblinks-yule">非学习资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/other-weblinks">工作学习资源</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/project/xuepindata-v">project</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/server/C/C-base">server</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/C/C-base">C</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/C++/c++-base">C++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/Ruby/Tool/child-server/ruby-sass">Ruby</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/go/go-bash">go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/server/node/node-apidoc">node</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/node-apidoc">接口文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/node-library">库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/server-express">express</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/server-issues">问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/server/node/server-mongodb">mongodb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/server-nodejs">nodejs基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/别人的文档">别人的文档</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/python/python-base">python</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/web/h5model/h5-model-localvideo">web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/window/win-gitbash">window</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">server</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">node</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">mongodb</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>mongodb</h1></header><blockquote><p>非关系型数据库-基于分布式文件存储的NoSQL</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下载安装m层">下载安装(M层)<a class="hash-link" href="#下载安装m层" title="Direct link to heading">​</a></h2><p><a href="https://www.mongodb.com/try/download" target="_blank" rel="noopener noreferrer">官网下载</a></p><ul><li>MongoDB Community Server 社区版</li><li>MongoDB Enterprise Server 企业版</li></ul><p><a href="https://www.mongodb.com/try/download/database-tools" target="_blank" rel="noopener noreferrer">MongoDb Tools</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装">安装<a class="hash-link" href="#安装" title="Direct link to heading">​</a></h3><ol><li><p>安装</p><ul><li>选择 complete 完全安装非自定义,不要勾选 Install MongoDB Compass</li><li>安装完成之后可能要配置环境变量</li></ul></li><li><p>开启数据库</p><ul><li>终端输入 mongod 执行(一般会提示缺少 C:/data/db 手动新建目录就行了)</li><li>或 mongod --dbpath d:/data/db 指定数据库路径<ul><li>可设置配置文件 <code>mongod.conf</code></li><li>通过 mongod -f mongod.conf</li></ul></li><li>执行成功后后面有一闪一闪的光标,数据库开启成功(窗口不用关闭)</li></ul></li><li><p>连接数据库</p><ul><li>开启新终端 输入 mongo</li><li>输入 show dbs 出现数据库说明连接成功了</li></ul></li><li><p>linux arch系列</p><ul><li>安装aur:mongodb、 mongodb-tools</li><li>创建并添加权限:chmod 777 /data/db</li></ul></li><li><p>centos 安装</p></li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 配置源 vim /etc/yum.repos.d/mongodb-org-5.0.repo </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mongodb-org-5.0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">MongoDB Repository</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">baseurl</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://repo.mongodb.org/yum/redhat/</span><span class="token variable" style="color:#36acaa">$releasever</span><span class="token plain">/mongodb-org/5.0/x86_64/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">gpgcheck</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">gpgkey</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://www.mongodb.org/static/pgp/server-5.0.asc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  yum install -y mongodb-org</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  systemctl start mongod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongodb 数据默认存储目录为 /var/lib/mongo ,可以通过 </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/mongodb.conf 查看或设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重启或关闭可能造成，数据损坏，导致启动错误, 可以查看 /tmp/mongodb-27017.sock  ,有就删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 或 rm -f //xxx//x/data/db/*.lock  ,修复  mongod --repair --dbpath=//xx/x/x/data/db</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="6"><li>源码安装</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">下载 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建存储数据和日志的目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /mongod/data /mongod/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 进入mongodb加油目录 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># --fork 后台启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># --auth 开启认证模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># --logappend 追加方式记录日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"> --dbpath</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/mongod/data --logpath</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/mongod/log/mongodb.log --bind_ip</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0 --fork</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mongo控制台外关闭</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"> --dbpath</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/mongod/data --shutdown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 控制台中关闭</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.shutdownServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">exit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 指定配置文件/xx/xx/xx/mongod.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod -f /xx/xx/xx/mongod.conf 启动</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="连接数据库">连接数据库<a class="hash-link" href="#连接数据库" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="图形工具连接">图形工具连接<a class="hash-link" href="#图形工具连接" title="Direct link to heading">​</a></h4><p><a href="https://www.mongodb.com/try/download/compass" target="_blank" rel="noopener noreferrer">官方工具 compass</a>
<a href="http://www.navicat.com.cn/what-is-navicat-for-mongodb" target="_blank" rel="noopener noreferrer">navicat</a>
<a href="https://robomongo.org/" target="_blank" rel="noopener noreferrer">robo 3t</a>
<a href="https://nosqlbooster.com/downloads" target="_blank" rel="noopener noreferrer">nosqlbooster</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="工具连接远程">工具连接远程<a class="hash-link" href="#工具连接远程" title="Direct link to heading">​</a></h4><blockquote><p>  不连接远程ssh 默认本地连接</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">../../../static/img/mongodToolSSH.jpg</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">alt</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">ssh</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">zoom</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:#36acaa">50</span><span class="token tag special-attr attr-value value css language-css unit" style="color:#e3116c">%</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">../../../static/img/2022-09-04_231517.jpg</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">zoom</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css number" style="color:#36acaa">50</span><span class="token tag special-attr attr-value value css language-css unit" style="color:#e3116c">%</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></blockquote><p>默认无密码登陆，如果设置了 --auth 就要选择密码连接</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="命令行连接">命令行连接<a class="hash-link" href="#命令行连接" title="Direct link to heading">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mongo mongodb://mongoroot:mongopwd@114.115.xxx.xxx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mongoose-连接">mongoose 连接<a class="hash-link" href="#mongoose-连接" title="Direct link to heading">​</a></h4><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mongoose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mongodb://localhost/pro-node-lagou&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 远程连接服务端，ip 设置0.0.0.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongoose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;mongodb://mongoroot:xxxxxx@xxx.xxx.xxx.xxx:27017/pro-node-lagou?authSource=admin&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安全">安全<a class="hash-link" href="#安全" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="用户管理权限">用户管理权限<a class="hash-link" href="#用户管理权限" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mongo 的权限认证与登录，默认是不需要的，通过 --auth 开启的mongo服务，才需要</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看角色列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show roles</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root  </span><span class="token comment" style="color:#999988;font-style:italic"># 超级账号，超级权限，只在admin库中可用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dbOwner </span><span class="token comment" style="color:#999988;font-style:italic"># 允许用户在指定数据库中执行任意操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">read</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#允许用户读取指定数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">readWrite </span><span class="token comment" style="color:#999988;font-style:italic"># 允许用户读写指定数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建管理员账户，哪个创建的用户，默认归属那个数据库，只能操作那个数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">、进入 use admin 管理员库设置管理员账号</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">默认没密码的</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">、db.createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user:</span><span class="token string" style="color:#e3116c">&quot;mongoroot&quot;</span><span class="token plain">,pwd:</span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain">,roles:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;root&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain">、db.createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user:</span><span class="token string" style="color:#e3116c">&quot;u1&quot;</span><span class="token plain">,pwd:</span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain">,roles:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> role: </span><span class="token string" style="color:#e3116c">&quot;userAdminAnyDatabase&quot;</span><span class="token plain">, db: </span><span class="token string" style="color:#e3116c">&quot;admin&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 给u1指定库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4</span><span class="token plain">、db.auth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;mongoroot&#x27;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&#x27;123456&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 验证账号是否可用，1 成功</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看用户信息 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># &quot;db&quot; : &quot;testuser&quot; 表示用户只能操作 testuser 数据库 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show </span><span class="token function" style="color:#d73a49">users</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 普通数据库下创建用户，u2只能操作这一个数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">user:</span><span class="token string" style="color:#e3116c">&quot;u2&quot;</span><span class="token plain">,pwd:</span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain">,roles:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;dbOwner&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除用户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.dropUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;u2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 普通方式启动还是不需要账号密码就能登录，要以授权方式启动 --auth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"> --dbpath</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/mongod/data --logpath</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/mongod/log/mongodb.log --bind_ip</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token plain">.0.0 --fork --auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 配置文件添加 auth</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">security:                                                                                                       authorization: enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 以账号登录,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo -umongoroot -p123456 --authenticationDatabase</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo -uu2 -p123456 --authenticationDatabase</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">testuser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 普通连接，授权放方式登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># use 到某个数据库test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.auth</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;testRoleRser&#x27;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&#x27;123456&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="副本集replication-复制">副本集(replication) 复制<a class="hash-link" href="#副本集replication-复制" title="Direct link to heading">​</a></h3><ol><li>一个活跃节点( <strong>Primary</strong> ) + N 个备份节点( <strong>Secondary</strong> )<ol><li>数据同步备份<ol><li>备份节点<code>定期，轮询</code>获取<code>主节点</code>的<code>数据库操作</code>，自己数据库副本<code>执行这些操作</code>，来<code>实现数据同步</code></li></ol></li><li>若活跃接点奔溃，数据库会将其中一个北方接点审计为活跃接点</li><li>备份节点不能主动去操作，想看的话先执行<code>rs.slaveOk()</code></li></ol></li><li>实现故障转移，主从复制<ol><li>解决问题 数据冗余备份，架构高可用</li><li>无法解决单节点压力问题( 硬件限制，并发访问压力)</li></ol></li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 启动三个服务器，并设置所属的副本集 为 rs0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --port </span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"> --dbpath </span><span class="token string" style="color:#e3116c">&quot;D:/mongod/data1&quot;</span><span class="token plain"> --replSet rs0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --port </span><span class="token number" style="color:#36acaa">27018</span><span class="token plain"> --dbpath </span><span class="token string" style="color:#e3116c">&quot;D:/mongod/data2&quot;</span><span class="token plain"> --replSet rs0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --port </span><span class="token number" style="color:#36acaa">27019</span><span class="token plain"> --dbpath </span><span class="token string" style="color:#e3116c">&quot;D:/mongod/data3&quot;</span><span class="token plain"> --replSet rs0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 登录任意一个端口的 mongo，设置，初始化副本集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 设置配置对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replSet_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _id:</span><span class="token string" style="color:#e3116c">&quot;rs0&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    members:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _id:0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host:</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:27017&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _id:1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host:</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:27018&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _id:2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host:</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:27019&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">replSet_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _id:</span><span class="token string" style="color:#e3116c">&quot;rs1&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    members:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _id:1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            host:</span><span class="token string" style="color:#e3116c">&quot;114.115.212.129:27018&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs.initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">replSet_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看副本集状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># health:1 健康的， stateStr:&quot;PRIMARY&quot; 主节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs.status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 验证数据同步备份</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs.slaveOk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 备份节点中执行后才能正常访问</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 登录指定端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27019 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="多服务器副本集">多服务器副本集<a class="hash-link" href="#多服务器副本集" title="Direct link to heading">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 服务器1 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p ./mongodb/repl/rs_1/log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p ./mongodb/repl/rs_1/data/db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> ./mongodb/repl/rs_1/mongod.conf </span><span class="token comment" style="color:#999988;font-style:italic"># 填写 /etc/mongod.conf 内容 更改数据和日志地址 放开 replSetName: 副本集名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 服务器2 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">。。。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 进入希望作为获得节点的服务器 mongo localhost:27018 启动数据库 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod -f /root/mongodb/repl/rs_1/mongod.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 初始化 (可以直接传入配置)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs.initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看状态，rs.conf() 本质是 local 库下 db.system.replset.find()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rs.conf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># host不是ip需要修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.members</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">.host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;192.168.16.134:27018&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs.reconfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 重载配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 添加副本节点 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs.add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;114.115.212.129:27018&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 云端端安全组开放端口，本地主要防火墙开放端口 ,  问题可能没关闭selinux</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># https://ke.qq.com/course/2930572/9864689478317964#term_id=103043162 add无法添加 卡住</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 程序连接方式 mongodb://username:password@192.168.56.101:27017,192.168.56.102:27017,192.168.56.103:27017/db_name?replicaSet=rschunqiu</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var </span><span class="token assign-left variable" style="color:#36acaa">config</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;rs1&quot;</span><span class="token plain">,members:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:1,host:</span><span class="token string" style="color:#e3116c">&quot;114.115.212.129:27018&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mongodb-使用">MongoDB 使用<a class="hash-link" href="#mongodb-使用" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a class="hash-link" href="#概念" title="Direct link to heading">​</a></h3><ul><li><p>NoSQL <strong>( Not Only SQL )</strong> 非关系型数据库，是 不<code>同于传统关系型数据库</code> 的统称</p><ul><li>关系，表和表之间通过<strong>主键</strong>和<strong>外键</strong>是有联系的</li><li>一个主表，相关的东西，因为<strong>类型属性不同</strong>，需要存储到<strong>其他表</strong>中，用的时候，通过<strong>主外键取来</strong>使用</li><li>非关系型就不需要，相关的东西直接存放到文档，子属性中就行，<code>容易设计,且速度快</code></li></ul></li><li><p>对比关系数据库</p><ul><li>数据库(database) -&gt; 集合(collectiion) -&gt; 文档(document) -&gt; 字段(field)   -&gt; 索引(index)  -&gt; _id     -&gt;  视图(view) -&gt; 聚合操作</li><li>数据库(databsse) -&gt; 表(table) -&gt;         行(row) -&gt;        列(column) -&gt;    索引(index) -&gt;  主键  -&gt;  视图(view) -&gt; 表链接</li></ul></li><li><p>适用场景</p><ul><li>基于灵活的json文档模型，适合业务变化快，敏捷的快速开发</li><li>读写速度快，更适合处理大 数据</li></ul></li><li><p>NoSQL 的优点/缺点</p><ul><li>分布式计算 : 当数据多了，快存不下了 ，添加扩展一个节点就可以继续存放了 </li><li>...</li></ul></li><li><p>默认数据库</p><ul><li><strong>admin</strong> : 管理员权限数据库</li><li><strong>local</strong> ：这个数据库永远不会被复制，可以用来储存本地服务器的任意集合</li><li><strong>config</strong>：保存分片相关信息</li></ul></li><li></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="操作指令">操作指令<a class="hash-link" href="#操作指令" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mongodb  </span><span class="token comment" style="color:#999988;font-style:italic">#数据库名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod  </span><span class="token comment" style="color:#999988;font-style:italic">#启动数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo  </span><span class="token comment" style="color:#999988;font-style:italic">#连接数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongoose </span><span class="token comment" style="color:#999988;font-style:italic">#node操作数据库的指令</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据库增删改查">数据库增删改查<a class="hash-link" href="#数据库增删改查" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 数据库操作  ( DDL-database )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show dbs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> show databases                 </span><span class="token comment" style="color:#999988;font-style:italic">#查看全部不为空的数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.getMongo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                              </span><span class="token comment" style="color:#999988;font-style:italic">#查看db链接机器地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.dropDatabase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">#删除数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">db name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">#切换数据库(或创建数据库)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">或者db.getName</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">#查看当前所在数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 切换到数据库后，当前数据库集合操作 ( DDL-table )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.createCollection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;testuser&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 创建集合，新集合没数据可能不会显示（灵活 不用知道字段以及类型）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show collections </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> show tables</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">#显示当前数据库中的集合（类似关系数据库中的表）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.drop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">#删除名为testuser的集合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 文档操作 ( DML-table )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 直接使用js语句操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">var </span><span class="token assign-left variable" style="color:#36acaa">i</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">db.testusers.insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable" style="color:#36acaa">Name$</span><span class="token variable punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">i</span><span class="token variable punctuation" style="color:#393A34">}</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain">,age:10+i</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.insert</span><span class="token operator" style="color:#393A34">|</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:1,b:2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 插入多个文档，不写中开括号就插入单个，save(废弃)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -   直接往不存在的集合插入文档，默认会自动创建这个集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.insertMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:1,b:2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 也是批量插入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                     </span><span class="token comment" style="color:#999988;font-style:italic"># 删除所有</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic"># 删除 a=1的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">b:5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 替换原有文档成 {b:5} 只有_id 会保留</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$set</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">b:5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># 原有文档的基础上，修改或增加属性 (匹配到的1条)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$set</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">b:5</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">multi:true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># 原有文档的基础上，修改或增加属性 (所有匹配到的)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        -   参数 query,更新对象，不存在记录是否插入0</span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">，是否更新所有匹配（0</span><span class="token operator" style="color:#393A34">|</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> 简写）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$inc</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">b:NumberInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 找到a=1的文档，让它的b属性自增1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$unset</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 删除指定的 key,值随意</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$push</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:</span><span class="token string" style="color:#e3116c">&quot;ele&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 所有匹配记录，list (必须不存在的或是数组类型)字段push一个元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.updateMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:</span><span class="token string" style="color:#e3116c">&quot;Name9&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$push</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;list&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$each</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;up3&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;up4&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 添加多个 $pushAll 不能用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$addToSet</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:</span><span class="token string" style="color:#e3116c">&quot;no repeat ele&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 如果值存在，不添加，不存在才添加</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$pop</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,0,1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#1 从后面删除，-1 从前面删除 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$pull</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:</span><span class="token string" style="color:#e3116c">&quot;ele&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,0,1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 通过值删除 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">a:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$pullAll</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;ele1&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;ele2&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,0,1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 删除多个 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># $pop 删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查询 ( DQL-table )</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 查询当前所在数据库，testuser 集合里面的列表文档内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:20</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查询年龄为20的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:20,name:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查询年龄为20,并且name为1的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$ne</span><span class="token plain">:20</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查询年龄不为20的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$gt</span><span class="token plain">:20</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#查找age大于2的：$gte 大于等于、 $lt 小于 、$lte 小于等于</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$gt</span><span class="token plain">:20,</span><span class="token variable" style="color:#36acaa">$lt</span><span class="token plain">:30</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#20到30之间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$or</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#或查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:20,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$or</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">sex:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查找年龄20并且sex为1，或 年龄20并且name为2的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$type</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查询age类型为字符串的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$all</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;Name0&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 找出全部 name 为 Name0 的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$all</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;test1&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;test2&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 找出 list 中同时存在 test1 和 test2 的所有文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$in</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;test1&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;test2&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 找出 list 中存在 test1 或 test2 的所有文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">list:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$nin</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;test1&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;test2&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 找出 list 中不存在 test1 和 test2 的所有文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:/^1/</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#正则查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># 其他查询关键词 $lte 小于等于，$gte 大于等于 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 对找到的内容进行二次操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">条件</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:0,age:0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#0表示不要，1表示要，只能全部0（选择排除哪些字段）或全部1（选择哪些 ）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.sort</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#1升序、-1降序</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#取指定数目</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.skep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.limit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#跳过n条再取指定数目 sort&gt;skep&gt;limit与书写顺序无关</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#统计数目</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.findOne</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#只取一条</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    db.testuser.distinct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">#查询名称不重复的记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 方法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.pretty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 容易阅读的格式返回 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> .find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.explain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查询分析</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> var sfind </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> db.testusers.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sfind.next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查找下一个文档 .hasNext() 查看是否存在下一个文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="索引">索引<a class="hash-link" href="#索引" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 索引操作 提高查询效率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.createIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">key:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 单字段创建，key 创建索引的字段，1 按升序建，-1 按降序建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.createIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">key:1,name:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 创建复合索引（索引一般给查询语句关联的字段建立）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.createIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:1,xxx:xxxx</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    background:true, </span><span class="token comment" style="color:#999988;font-style:italic"># 是否后台创建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unique:true, </span><span class="token comment" style="color:#999988;font-style:italic"># 是否设置唯一索引，索引字段不可重复，有重复值的字段也不能是唯一索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name:</span><span class="token string" style="color:#e3116c">&#x27;xx&#x27;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 所有名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 创建索引 ,多个就是复核索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.getIndexes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 获取查看索引 _id 是默认的 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.dropIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 删除_id之外的索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.dropIndexes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 删除_id之外的所有索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.xxx.find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">xx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">.explain</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;inputStage&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;stage&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;IXSCAN&quot;</span><span class="token plain">, </span><span class="token comment" style="color:#999988;font-style:italic"># 值为 IXSCAN 表示基于索引扫描，如果 COLLSCAN 全局扫描</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;keyPattern&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 使用了这些索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;age&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;indexName&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;age_1&quot;</span><span class="token plain">, </span><span class="token comment" style="color:#999988;font-style:italic"># 索引名称  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;isUnique&quot;</span><span class="token plain"> </span><span class="token builtin class-name">:</span><span class="token plain"> true, </span><span class="token comment" style="color:#999988;font-style:italic"># 是否是唯一索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分组group">分组(group)<a class="hash-link" href="#分组group" title="Direct link to heading">​</a></h3><blockquote><p>  只能对本地单台机器数据处理</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 分组统计 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 统计各组身高不高于170的人数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">sex:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,  </span><span class="token comment" style="color:#999988;font-style:italic"># 分组字段，指定根据什么来分组 -- 如果通过性别 可分为两组 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cond:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">height:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$lt</span><span class="token plain">:170</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><span class="token comment" style="color:#999988;font-style:italic"># 查询条件  --   通过条件筛选，只对符合条件的进行操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    initial:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">counter</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,    </span><span class="token comment" style="color:#999988;font-style:italic"># 初始化 -- 这边这样每组调用 reduce前 都会把counter从0开始</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 聚合函数， 每组都会调用 reduce,参数一 是该组的每一个文档 ，result 全局属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reduce:function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">item,result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">result.counter </span><span class="token operator" style="color:#393A34">+=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    finalize:function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 每统计一组后的回调函数，比如平均值就需要 reduce 相加完，来这里操作</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 通过分支最终的到的结果中留下 [{sex:m, counter:10},{sex:g, counter:20}]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># group 不支持分布式运算</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="聚合aggragate">聚合(aggragate)<a class="hash-link" href="#聚合aggragate" title="Direct link to heading">​</a></h3><blockquote><p>  主要对集合中的数据进行各种统计，并返回统计后的数据结果</p></blockquote><ol><li>常用管道操作<ol><li>$group : 将集合的统计结果进行分组</li><li>$match : 用于过滤数据，找出符合条件的文档 ( 类似 where 子句)</li><li>$project : 修改输入文档的结构，增加删除字段等</li><li>$limit : 限制管道返回的文档数量</li><li>$skip : 跳过指定属性的文档</li><li>$sort : 将文档排序后输出</li><li>$unwind : 将文档中某一个数组字段，拆分成多条，每条包含数组的一个值</li></ol></li><li>常用管道表达式<ol><li>平均数($avg)</li><li>求和($sum)</li><li>第一个($first)</li><li>最后一个($last)</li><li>最大/小($max/$min)</li><li>得到的数据放到数组中($push)</li></ol></li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 数据通过多个管道进行处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># db.testuser.aggragate([{操作1},{操作2:{xxx}}])</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 通过 sex 字段分组，得到每组的平均 height，保存到 avgerxxx 中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.aggragate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$group</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$sex</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">,avgerxxx:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$avg</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$height</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 通过 sex 字段分组，得到每组的最矮的人的高</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.testuser.aggragate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$group</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$sex</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">,minval:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$min</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$height</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 把各组没人身高放到储存起来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.study.aggregate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$group</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$sex</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">,heiarr:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$push</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$height</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 多管道</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 身高大于180，男女生的数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.study.aggregate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$match</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">height:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$gt</span><span class="token plain">:180</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$group</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$sex</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">,sums:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$sum</span><span class="token plain">:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 身高大于180，男女生的数量，只输出属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> db.study.aggregate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$match</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">height:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$gt</span><span class="token plain">:170</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$group</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$sex</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">,sums:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$sum</span><span class="token plain">:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$project</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:0,sums:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 身高大于180，男女生的数量,排序输出 -1 降序</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  db.study.aggregate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$match</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">height:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$gt</span><span class="token plain">:170</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$group</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$sex</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token plain">,sums:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$sum</span><span class="token plain">:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$sort</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">sums:-1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 找出女生，降序后，第2-3个，的名字与高度</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> db.study.aggregate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$match</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">sex:</span><span class="token string" style="color:#e3116c">&quot;g&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$sort</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">height:-1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$skip</span><span class="token plain">:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$limit</span><span class="token plain">:2</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$project</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:0,name:1,height:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 将文档数组类型字段 list，将文档拆分多个文档，每个文档的list 是原来 list数组的一个值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> db.study.aggregate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token variable" style="color:#36acaa">$unwind</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">$list</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapreduce">MapReduce<a class="hash-link" href="#mapreduce" title="Direct link to heading">​</a></h3><blockquote><p>  大数据计算模型，支持分布式，支持大量服务器同时工作 </p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 通过 map (第一个函数)，处理每一个文档，map函数中最后通过调用 emit(key,value) 返回键值对</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 系统会将emit的数据整理成 &lt;k1,[v1,v2,v5]&gt;  &lt;k2,[v3,v4]&gt; 这样的格式 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 通过 reduce (第二个函数)，&lt;k1,[v1,v2,v5]&gt; 对每一个相同键进行处理  =&gt; 参数1 = k1,参数2 = [v1,v2,v5]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参数三，一个对象，把reduce输出的值进行各种处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 统计 study 集合中，相同年龄的有谁，输出到当前数据库的 res 集合中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># res集合中 _id 就是 age的值，value就是age值，对应的学生名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var map </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function-name function" style="color:#d73a49">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 先把文档数据经过各种处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">this.age,this.name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 可以调用多次</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var reduce </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">age,values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># k1,[v1,v2,v5]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token builtin class-name">return</span><span class="token plain"> values</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.study.mapReduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map,reduce,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">out:</span><span class="token string" style="color:#e3116c">&quot;res&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># optin    </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    out 输出的集合名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query 塞选完再执行map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sort</span><span class="token plain"> 排序完再执行map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limit 限制个数执行map</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.study.mapReduce</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">map,reduce,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    out:</span><span class="token string" style="color:#e3116c">&quot;res&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sort:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:-1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    query:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">age:20</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limit:2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分片分布式集群">分片，分布式集群<a class="hash-link" href="#分片分布式集群" title="Direct link to heading">​</a></h3><p><img loading="lazy" src="D:%5CMyData%5Cprojects%5Clzo-docs-blog-2%5Cstatic%5Cimg%5C2022-09-12_094526.jpg" alt="集群规划" class="img_ev3q"></p><ol><li><p><strong>对比副本集：</strong>副本集类似备份，每个备份节点内容是一样的，不担心某个数据库挂了</p></li><li><p><strong>分布式集群：</strong>每个服务器只存能存下数据的一部分，满了，在开一个服务器，继续储存</p></li><li><p><strong>主要部分：</strong></p><ol><li><code>分片节点</code> - 普通mongod 进程，也可以是副本集，保存分片后的集合数据块</li><li><code>mongos路由节点</code> - 起到一个前端路由功能，供客户端进行接入，启动时从<code>配置节点</code>加载信息，当客户端连接到服务器时，会询问配置服务器，要到那个分片服务器上操作数据</li><li><code>配置节点</code> - 记录了<code>每个分片服务器</code>包含了<code>哪些数据</code>的信息，保存的只是数据的<code>分布表</code></li></ol></li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1、启动三个分片节点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --shardsvr --dbpath </span><span class="token string" style="color:#e3116c">&quot;/root/mongos/data1/data/&quot;</span><span class="token plain"> --port </span><span class="token number" style="color:#36acaa">1111</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --shardsvr --dbpath </span><span class="token string" style="color:#e3116c">&quot;/root/mongos/data2/data/&quot;</span><span class="token plain"> --port </span><span class="token number" style="color:#36acaa">2222</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --shardsvr --dbpath </span><span class="token string" style="color:#e3116c">&quot;/root/mongos/data3/data/&quot;</span><span class="token plain"> --port </span><span class="token number" style="color:#36acaa">3333</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 配置文件 有一个 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sharding:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clusterRile:shardsvr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2、启动配置节点副本集</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --configsvr --replSet rs_cfg --dbpath </span><span class="token string" style="color:#e3116c">&quot;/root/mongos/config_data7/data/&quot;</span><span class="token plain"> --port </span><span class="token number" style="color:#36acaa">7777</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongod --configsvr --replSet rs_cfg --dbpath </span><span class="token string" style="color:#e3116c">&quot;/root/mongos/config_data78data/&quot;</span><span class="token plain"> --port </span><span class="token number" style="color:#36acaa">8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 副本集哪有的配置信息初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo --port </span><span class="token number" style="color:#36acaa">7777</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 登录 7777 端口服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _id:</span><span class="token string" style="color:#e3116c">&quot;rs_cfg&quot;</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    configsvr:true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    members:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:0,host:</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:7777&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:1,host:</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1:8888&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rs.initiate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cfg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3、启动 mongos 路由节点 (前面的都是mongod服务) 都在mongos操作所有数据，不需要去哪些分片节点了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos --configdb 副本集名/配置节点地址 --port 端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongos --configdb rs_cfg/localhost:7777,localhost:8888 --port </span><span class="token number" style="color:#36acaa">9999</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 4、将分片节点信息添加到路由服务器中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mongo 5.x新版 sh. 肯都有改db.runCommand()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongo --port </span><span class="token number" style="color:#36acaa">9999</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 进入mongos 服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh.addShard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;localhost:1111&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># sh 表示分布式集群</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh.addShard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;localhost:2222&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh.addShard</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;localhost:3333&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh.status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 查看集群状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 5、启动分片， </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh.enableSharding</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 将test作为分片数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.runCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">enableSharding:</span><span class="token string" style="color:#e3116c">&quot;test&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh.shardCollection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;test.persons&quot;</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 对test persons集合提供分片支持，片键name,1 代表启用name为片键</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.runCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">shardCollection:</span><span class="token string" style="color:#e3116c">&quot;test.persons&quot;</span><span class="token plain">,key:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db.runCommand</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">shardCollection:</span><span class="token string" style="color:#e3116c">&quot;test.persons&quot;</span><span class="token plain">,key:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">_id:</span><span class="token string" style="color:#e3116c">&quot;hashed&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># hash 散列平均分片到所有分片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 片键(shard key)，通过片键决定数据存到哪个节点分片，片键必须是集合文档中存在的，片键太有规律肯能所有的会被分片到同一个分片</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># mongos 不允许插入没有片键的文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 设置分片时在集合中选一个键，该键的值作为财富数据的依据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 6、使用 进入mongos --port 9999 服务，操作与以前单个服务一致</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">var </span><span class="token assign-left variable" style="color:#36acaa">i</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">i++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">db.persons.insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">name:</span><span class="token string" style="color:#e3116c">&quot;name&quot;</span><span class="token plain">+i,age:i</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 测试数据储存位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mongoose">mongoose<a class="hash-link" href="#mongoose" title="Direct link to heading">​</a></h3><p><a href="http://www.mongoosejs.net/docs/index.html" target="_blank" rel="noopener noreferrer">官网</a></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mongoose</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>基本使用</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> mongoose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mongoose&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//链接数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//地址:mongodb://主机/数据库名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongoose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;mongodb://localhost/test1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">useNewUrlParser</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">useUnifiedTopology</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//数据库链接对象</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> db </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mongoose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">connection</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;error&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">bind</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">console</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;connection error:&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">db</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">once</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;open&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;链接成功&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//Mongoose 里，一切都始于Schema。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//创建一个和集合相关的schema对象(类似表头)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mongoose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Schema</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> userSchema </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Schema</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">us</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//标题:{类型:String,是否必须:true,默认:&#x27;123456&#x27;}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">ps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">required</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123456&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//年龄:Number类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//将schema对象转化为数据模型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mongoose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;user&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userSchema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> </span><span class="token maybe-class-name">UserTest</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mongoose</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;usertest&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> userSchema</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//该数据对象与集合相连(&#x27;test1里的集合名&#x27;,schema对象)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//数据库中的集合名会自动以复数形式表示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//操作数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//API文档 -&gt; 模型(mongoose的增删改查) -&gt; 插入方法 Model.insertMany()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">insertMany</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">us</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;123&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">ps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;插入成功&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;插入失败：&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//查询</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;查询成功&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;查询失败：&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;删除成功&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;删除失败：&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//Model.update(&#x27;更新条件&#x27;,&#x27;更新内容&#x27;,[options],[callback]);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">User</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">update</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">age</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">us</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;new123&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;更新成功&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;更新失败：&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="导入导出备份">导入导出备份<a class="hash-link" href="#导入导出备份" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="备份-mongodump-">备份（ mongodump ）<a class="hash-link" href="#备份-mongodump-" title="Direct link to heading">​</a></h3><blockquote><p>  .bson 方式输出，无法查看</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># mongodump -h dbhost -d dbname -c cname -o dbdirectory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbhost 需要备份的主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbname 需要备份的数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cname 需要备份的集合 (备份整个数据库就不需要 -c 了)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbdirectory 输出存放位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongodump -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017 -d </span><span class="token builtin class-name">test</span><span class="token plain"> -c table -o /root/mongosave/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongodump -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1 --port </span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"> -d </span><span class="token builtin class-name">test</span><span class="token plain"> -c table -o /root/mongosave/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># --auth 开启的 mongo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongodump -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017 -u admin -p </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"> --authenticationDatabase admin -d </span><span class="token builtin class-name">test</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 备份成功后生成两文件 .json 试一下概要信息，.bson(json 的二进制格式) 保存真正的数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="恢复--mongorestore-">恢复 ( mongorestore )<a class="hash-link" href="#恢复--mongorestore-" title="Direct link to heading">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># mongorestore -h dbhost ----nsInclude=&quot;数据库名.集合名&quot; --dir=dbdirectory</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbhost 需要备份的主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbdirectory 需要恢复的数据库、或集合的位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># --drop 删除集合中所有数据，完全恢复备份的数据，备份后添加的数据会被删</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongorestore -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017 --nsInclude</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;test.table&quot;</span><span class="token plain"> --dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/mongosave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 账号密码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongorestore -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017 -u admin -p </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"> --authenticationDatabase admin --nsInclude</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;test.table&quot;</span><span class="token plain"> --dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/root/mongosave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 数据恢复，会将备份之后删除的添加回来，备份之后添加的默认不动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="导出--mongoexport-">导出 （ mongoexport ）<a class="hash-link" href="#导出--mongoexport-" title="Direct link to heading">​</a></h3><blockquote><p>  得到一份可以可以看的 json 数据，普通数据，任何地方都能导入</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># mongoexport -h dbhost -d dbname -c cname -o dbdirectory/xxxx.json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbhost 需要导出的主机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbname 需要导出的数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># cname 需要导出的集合</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># dbdirectory 输出存放位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongoexport  -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017  -d </span><span class="token builtin class-name">test</span><span class="token plain"> -c table -o /root/mongoexport/xx2.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongoexport  -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017  -u admin -p </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"> --authenticationDatabase admin -d </span><span class="token builtin class-name">test</span><span class="token plain"> -c table -o /root/mongoexport/xx2.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="导入--mongoimport-">导入 ( mongoimport )<a class="hash-link" href="#导入--mongoimport-" title="Direct link to heading">​</a></h3><blockquote><p>  在原有数据追加数据(_id重复会导致无法导入，没_id会自动生成_id)，不存在的数据库或集合，导入会自动创建</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mongoimport -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017 -d test2 -c tab2 ./mongoexport/xx2.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mongoimport -h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:27017 -u admin -p </span><span class="token number" style="color:#36acaa">123456</span><span class="token plain"> --authenticationDatabase admin -d test2 -c tab2 ./mongoexport/xx2.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>数据库相关工具<ul><li>导入<code>mongoimport</code><ul><li><code>-h</code> : 指明数据库宿主机的IP</li><li><code>-u</code> : 指明数据库的用户名</li><li><code>-p</code> : 指明数据库的密码</li><li><code>-d</code> : 指明数据库的名字</li><li><code>-c</code> : 指明collection的名字</li><li><code>-f</code> : 指明要导出那些列</li><li><code>-o</code> : 指明到要导出的文件名</li><li><code>-q</code> : 指明导出数据的过滤条件</li><li></li><li><code>mongoexport -d pro-node-lagou -c menus -o D:\lzo-project\lzo-everyday\mongodb-export\menus.dat</code></li><li><code>mongoexport -h IP --port 端口 -u 用户名 -p 密码 -d 数据库 -c 表名 -f 字段1，字段2 -q‘{条件导出}’ </code>--csv -o 文件名</li></ul></li><li>导出<code>mongoexport</code><ul><li><code>-h</code> : 指明数据库宿主机的IP</li><li><code>-u</code> : 指明数据库的用户名</li><li><code>-p</code> : 指明数据库的密码</li><li><code>-d</code> : 指明数据库的名字</li><li><code>-c</code> : 指明collection的名字</li><li><code>-f</code> : 指明要导入那些列</li><li><code>mongoimport -d pro-node-lagou -c menus menus.dat</code></li></ul></li><li>恢复<code>mongorestore</code><ul><li><code>mongorestore D:\lzo-project\lzo-everyday\mongodb-export</code></li></ul></li><li><code>mongofiles</code>保存大文件</li><li><code>mongostat</code>是mongodb自带的状态检测工具</li><li><code>mongotop</code>用来跟踪MongoDB的实例</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/server/node/server-mongodb.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/server/node/server-issues"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">问题</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/server/node/server-nodejs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">nodejs基础</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#下载安装m层" class="table-of-contents__link toc-highlight">下载安装(M层)</a><ul><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a></li><li><a href="#连接数据库" class="table-of-contents__link toc-highlight">连接数据库</a></li></ul></li><li><a href="#安全" class="table-of-contents__link toc-highlight">安全</a><ul><li><a href="#用户管理权限" class="table-of-contents__link toc-highlight">用户管理权限</a></li><li><a href="#副本集replication-复制" class="table-of-contents__link toc-highlight">副本集(replication) 复制</a></li></ul></li><li><a href="#mongodb-使用" class="table-of-contents__link toc-highlight">MongoDB 使用</a><ul><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a></li><li><a href="#操作指令" class="table-of-contents__link toc-highlight">操作指令</a></li><li><a href="#数据库增删改查" class="table-of-contents__link toc-highlight">数据库增删改查</a></li><li><a href="#索引" class="table-of-contents__link toc-highlight">索引</a></li><li><a href="#分组group" class="table-of-contents__link toc-highlight">分组(group)</a></li><li><a href="#聚合aggragate" class="table-of-contents__link toc-highlight">聚合(aggragate)</a></li><li><a href="#mapreduce" class="table-of-contents__link toc-highlight">MapReduce</a></li><li><a href="#分片分布式集群" class="table-of-contents__link toc-highlight">分片，分布式集群</a></li><li><a href="#mongoose" class="table-of-contents__link toc-highlight">mongoose</a></li></ul></li><li><a href="#导入导出备份" class="table-of-contents__link toc-highlight">导入导出备份</a><ul><li><a href="#备份-mongodump-" class="table-of-contents__link toc-highlight">备份（ mongodump ）</a></li><li><a href="#恢复--mongorestore-" class="table-of-contents__link toc-highlight">恢复 ( mongorestore )</a></li><li><a href="#导出--mongoexport-" class="table-of-contents__link toc-highlight">导出 （ mongoexport ）</a></li><li><a href="#导入--mongoimport-" class="table-of-contents__link toc-highlight">导入 ( mongoimport )</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/other-weblinks">收藏网址</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/other/other-markdown">Markdown</a></li></ul></div><div class="col footer__col"><div class="footer__title">外部链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/liaozhongxun" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/lzo-gitee" target="_blank" rel="noopener noreferrer" class="footer__link-item">码云<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lzo-gitee.gitee.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">码云WEB<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lzo-gitee.gitee.io/gitee-static/images/home.png" target="_blank" rel="noopener noreferrer" class="footer__link-item">码云 WEB static BasePath<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4efd6171.js"></script>
<script src="/assets/js/main.bda8fe25.js"></script>
</body>
</html>