<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-server/node/server-nodejs">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">nodejs基础 | WEB - 前端开发</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/server/node/server-nodejs"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="nodejs基础 | WEB - 前端开发"><meta data-rh="true" name="description" content="概念"><meta data-rh="true" property="og:description" content="概念"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/server/node/server-nodejs"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/server/node/server-nodejs" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/server/node/server-nodejs" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="WEB - 前端开发 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="WEB - 前端开发 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.dae88263.css">
<link rel="preload" href="/assets/js/runtime~main.001365ce.js" as="script">
<link rel="preload" href="/assets/js/main.c475113b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/photo.jpg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/photo.jpg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">我的WEB文档</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/other-weblinks">文档</a><a href="https://github.com/liaozhongxun" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/blogtype/play-rtsp-video">blogtype</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/book/js/JavaScript 核心进阶">book</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/database/">时序库</a><button aria-label="Toggle the collapsible sidebar category &#x27;时序库&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/idea/idea-sublime">idea</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/linux/">linux</a><button aria-label="Toggle the collapsible sidebar category &#x27;linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/other/other-algorithm">other</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/other-weblinks-yule">非学习资源</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/other-weblinks">工作学习资源</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/project/xuepindata-v">project</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/server/C/C-base">server</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/C/C-base">C</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/C++/c++-base">C++</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/Ruby/Tool/child-server/ruby-sass">Ruby</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/go/go-bash">go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/server/node/node-apidoc">node</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/node-apidoc">接口文档</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/node-library">库</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/server-express">express</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/server-issues">问题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/server-mongodb">mongodb</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/server/node/server-nodejs">nodejs基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/node/别人的文档">别人的文档</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/server/python/python-base">python</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/web/h5model/h5-model-localvideo">web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/window/win-gitbash">window</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">server</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">node</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">nodejs基础</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>nodejs基础</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="概念">概念<a class="hash-link" href="#概念" title="Direct link to heading">​</a></h2><blockquote><p>  终端直接输入 node 进入可以运行 node 代码的换叫 REPL 环境</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nodejs">nodejs<a class="hash-link" href="#nodejs" title="Direct link to heading">​</a></h3><ul><li>javascript 运行时</li><li>不是语言、不是框架、是一个平台、一个基于v8引擎的js运行环境(宿主环境)<ul><li>哪里安装nodejs，JavaScript代码就能在哪里运行,nodejs之前一般是在浏览器中运行的</li><li>所以NodeJs跨平台</li><li>使js可以做很多浏览器网站之外的事情</li><li>如:<code>Node的Electron开发的VsCode</code> 、<code>gulp</code>、<code>webpack</code></li></ul></li><li>除了nodejs外js其他宿主环境:浏览器</li><li>nodejs通过<code>V8 js引擎</code>，node API将任务放到libuv中(事件循环、文件系统、网络IO、线程池等)</li><li>nodejs架构<ul><li>js操作与Node提供的API(js编写)</li><li>解析js的V8（大部分C++）</li><li>libuv(C语言编写)</li></ul></li><li>应用场景<ul><li>electron桌面程序开发</li><li>前端开发库（npm、yarn...）</li><li>使用nodejs作为web开发服务器</li><li>通过nodejs完成前后的渲染同构<ul><li>在后端执行js代码，渲染出最终的html代码，让浏览器直接解析，优化项目</li></ul></li><li>通过node编写自动化脚本</li></ul></li><li>终端输入node回车，进入nodejs的REPL(交互式测试编程环境)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="js-引擎">JS 引擎<a class="hash-link" href="#js-引擎" title="Direct link to heading">​</a></h3><blockquote><p>作用:将js转汇编转二进制最终变为cpu可以认识的数据
JS 的解释阶段，预处理阶段，执行阶段生成执行上下文，VO，作用域链、回收机制等等</p></blockquote><ul><li>常见的JS引擎<ul><li><code>SpiderMonkey</code>:第一款，也是作者<code>Brendan Eich</code>开发的</li><li><code>Chakra</code>:微软开发主要<code>IE</code>浏览器</li><li><code>JavaScriptCore</code>:浏览器引擎(WebKit)中的内置JS引擎，Apply公司开发(小程序的JsCore)<ul><li>WebKit = 渲染工作的(WebCore) 与 JS引擎(JavaScriptCore) 组成 </li></ul></li><li><code>V8</code>:Google开发<ul><li><code>在Chrome中，只有Html的渲染采用了WebKit的WebCore代码，而在JavaScript上，重新搭建了一个NB哄哄的V8引</code></li><li><code>谷歌浏览器体验好的原因之一</code>6</li></ul></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基础操作">基础操作<a class="hash-link" href="#基础操作" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="主要组成部分">主要组成部分<a class="hash-link" href="#主要组成部分" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="&amp;quot;node模型&amp;quot;" src="/assets/images/nodejs-model-e8997e9f06d2053e5108a3a419adc333.png" width="800" height="316" class="img_ev3q">   </p><p>Node.js 被分为了四层，分别是 <code>应用层</code>、<code>V8引擎层</code>、<code>Node API</code>层 和 <code>LIBUV层</code>。</p><ul><li><p>应用层：即 JavaScript 交互层，常见的就是 Node.js 的模块，比如 http，fs</p></li><li><p>V8引擎层：  即利用 V8 引擎来解析JavaScript 语法，进而和下层 API 交互，(c++)</p></li><li><p>NodeAPI层：  为上层模块提供系统调用，一般是由 C 语言来实现，和操作系统进行交互 。</p></li><li><p>LIBUV层： 是跨平台的底层封装，实现了 事件循环、文件操作等，是 Node.js 实现异步的核心 </p></li><li><p>Node.js 内部都是通过 线程池 来完成异步 I/O 操作</p><ul><li>Node.js 的单线程仅仅是指 JavaScript 运行在单线程中，而并非 Node.js 是单线程。</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="流程">流程<a class="hash-link" href="#流程" title="Direct link to heading">​</a></h3><ol><li>执行步骤:<ol><li>用户编写<code>编写fs.readFile()</code></li><li>V8拿到用户代码进行翻译，解析 -&gt; 完成之后就可以执行    </li><li>执行时经过<code>NODE.js BINDINGS</code>到<code>libuv</code>与操作系统沟通,读取文件内容    </li><li>BINDINGS作用是使v8翻译处理的代码能与libuv（独立的库）的代码进行沟通</li></ol></li><li>操作文件细节<ol><li>js不能直接对一个文件进行操作</li><li>任何程序的文件操作都时需要<code>系统调用</code>(操作系统的文件系统)    </li><li>Node通过libuv库来操作文件进行系统调用</li></ol></li><li>操作系统提供两种调用方式<code>阻塞调用</code>和<code>非阻塞调用</code><ol><li>阻塞和非阻塞是针对系统调用，是系统(被调用方)提供给外界用户的调用方式</li><li>同步和异步是针对用户端来说的 (如同步执行代码会被阻塞,系统不会分配新线程来处理它) ，</li><li>客户端完全可以主线程通过异步陆续执行，当某个地方执行到阻塞调用时，新开一个进程让他等，主线程继续执行</li><li><code>阻塞</code>    </li><li><code>非阻塞</code><ol><li>后续代码得不到结果，需要不断<code>轮训操作</code>，或类似方式处理</li><li><code>轮训操作</code>libuv的线程池(Thread Pool) 进行处理</li><li>当得到结果时就可以将对应的回调放到事件循环(某一个队中)</li></ol></li></ol></li><li>node的事件循环<ul><li>比浏览器多:文件IO操作、数据库、子进程、网络IO、定时器、完成对应操作都回家返回结果和回调放到任务队列中<ul><li>事件循环会不断的从任务队列取出对应的事件（回调函数）来执行</li><li>事件循环具体来说，是主线程过了一遍，异步操作添加到自己的队列位置后，开始执行各个队列的过程</li></ul></li><li>node每一次事件循环(Tick)都有很多阶段<ul><li>定时器（timers）</li><li>待定回调(Pending Callback)</li><li>idle,prepare:仅系统内部使用</li><li>轮询(Poll):检索新的I/O事件，执行I/O事件的回调<ul><li>每次Tick中这个阶段世间会比较长，系统希望io回调尽可能早相应，用户尽早拿到数据来用</li><li>甚至会阻塞</li></ul></li><li>检测：setImmediate()回调在这里执行<ul><li>立即执行，是说不会保存到其他地方，直接放到check queue中</li></ul></li><li>关闭的回调函数：如 socket.on(&quot;close&quot;,()=&gt;{})</li><li>node事件循环的队列<ul><li>微任务队列<ul><li><strong>next tick queue ：</strong>process.nextTick  </li><li><strong>other queue ：</strong>Promise.then回调、queueMicrotask</li></ul></li><li>宏任务队列<ul><li><strong>timer queue ：</strong>setTimeout、setInterval<ul><li>如果时间不是0，只会被系统保存，不会直接放到队列中，要等时间到了，才会加入队列，等待下一次循环才开始执行</li><li>如果时间是0，正常情况会在本次循环宏任务最先执行，有时特殊情况不会<ul><li>出现这种情况的原因主要和setTimeout的实现代码有关，当我们不传时间参数或者设置为0的时候，nodejs会取值为1，即1ms（在浏览器端可能取值会更大一下，不同浏览器也各不相同），所以在电脑cpu性能够强，能够在1ms内执行到timers phase的情况下，由于时间延迟不满足回调不会被执行，于是只能等到第二轮再执行，这样setInterval就会先执行。</li></ul></li></ul></li><li><strong>poll quere ：</strong>IO事件</li><li><strong>check quere ：</strong>setImmediate<ul><li>setImmediate只有IE10+和Node上兼容比较好</li></ul></li><li><strong>close queue ：</strong>close 事件</li></ul></li></ul></li></ul></li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特性能">特性能<a class="hash-link" href="#特性能" title="Direct link to heading">​</a></h3><blockquote><p>Nodejs可以解析js代码，没有浏览器安全级别限制（安全沙箱、同源策略），并提供了很多系统级别API</p></blockquote><ul><li>文件读写（File System）</li><li>进程管理（Process）</li><li>网路通讯等</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="三大特点">三大特点:<a class="hash-link" href="#三大特点" title="Direct link to heading">​</a></h3><ul><li>事件驱动</li><li>非阻塞 I(input)/O(output) 输入输出流</li><li>基于 chrome V8 runtime 轻量高效</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="运行环境">运行环境<a class="hash-link" href="#运行环境" title="Direct link to heading">​</a></h3><ul><li>浏览器<ul><li>基本语法 </li><li>DOM</li><li>BOM</li><li>Ajax</li><li>系统文件数据库(处于安全性考虑 不能实现)</li></ul></li><li>服务器<ul><li>基本语法</li><li>操作数据库</li><li>操作本地文件</li><li>进程管理</li><li>网络通讯</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="模块化">模块化<a class="hash-link" href="#模块化" title="Direct link to heading">​</a></h3><ul><li>核心模块(node 软件提供的)</li><li>第三方模块(用npm安装)<ul><li>nodemailer</li></ul></li><li>自定义模块(一个js文件就是一个模块)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="模块操作">模块操作<a class="hash-link" href="#模块操作" title="Direct link to heading">​</a></h4><blockquote><p>node使用 CommonJS 规范，浏览器是不支持的</p></blockquote><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//由于模块作用域,导入后模块间不会互相污染,必须通过导出才可以在外部调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> os </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;os&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//导入模块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 默认导出</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">freemem</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//导入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> req </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./node&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">req</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 多个导出1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">export1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;export1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">export2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;export2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//多个导出2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    export1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    export2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//导入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> export1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> export2 </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;./node&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">export1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//exports 是 module.exports 的引用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">export1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> export1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">export2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> export2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exports </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">xxx</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//错误引用改变了</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="爬虫">爬虫<a class="hash-link" href="#爬虫" title="Direct link to heading">​</a></h3><ol><li>获取目标网站 (http.get)</li><li>分析网站内容 (cheerio 通过jq选择器获取想要的内容 或直接用正则匹配)</li><li>获取有效信息 下载或其他操作</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="express">express<a class="hash-link" href="#express" title="Direct link to heading">​</a></h3><p><a href="https://www.expressjs.com.cn/" target="_blank" rel="noopener noreferrer">官网</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api">api<a class="hash-link" href="#api" title="Direct link to heading">​</a></h4><ul><li>ip</li><li>端口号</li><li>pathname</li><li>method</li><li>接收用户的参数</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="templatev层">template(V层)<a class="hash-link" href="#templatev层" title="Direct link to heading">​</a></h4><ul><li>ejs</li><li>pug</li><li>jade</li><li><a href="http://www.sunxiaoning.com/language/474.html" target="_blank" rel="noopener noreferrer">art-template</a></li><li>将vue当做模板放到后端执行就是vue SSR</li></ul><p>前后端分离:管理代码方便
服务端直接渲染返页面:速度效率快，不方便管理</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="页面渲染-render">页面渲染 render<a class="hash-link" href="#页面渲染-render" title="Direct link to heading">​</a></h4><ul><li>SSR (Server Side render 服务端渲染,返回整个页面)</li><li>CSR (Client Side render 客户端渲染,返回数据如JSON)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="什么是服务器">什么是服务器<a class="hash-link" href="#什么是服务器" title="Direct link to heading">​</a></h3><ul><li>服务器<ul><li>服务器的本质就是一台电脑</li><li>服务器软件(如:PHP的apach、Java的tomcat、微软的iis、ngnix、node等)</li><li>得到服务器IP和端口号</li></ul></li><li>局域网：服务器通过网线或无线相连接,每个电脑都会有一个IP</li><li>外网</li><li>IP:找到服务器主机的位置</li><li>端口号:找到主机中某个程序的位置(0-65535)<ul><li>0-1023： BSD保留端口，也叫系统端口(0不使用)</li><li>1024-5000： BSD临时端口,留给应用程序使用</li><li>5001-65535：BSD服务器(非特权)端口，用来给用户自定义端</li><li>http服务 80,用户访问就不要输入端口号了</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="中间件middlewear">中间件middlewear<a class="hash-link" href="#中间件middlewear" title="Direct link to heading">​</a></h3><ul><li>内置中间件(静态资源目录 static)</li><li>自定义中间件(全局 局部)</li><li>第三方中间件 (如 body-parser)</li></ul><p>注意next()</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="静态资源目录-static">静态资源目录 static<a class="hash-link" href="#静态资源目录-static" title="Direct link to heading">​</a></h3><blockquote><p>指定一个目录,目录可以被访问 类似Apache 的www</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="图片上传">图片上传<a class="hash-link" href="#图片上传" title="Direct link to heading">​</a></h3><blockquote><p>原理:将图片、音乐等要上传的东西转换文数据流,通过ajax或form表单传到服务器，服务器接收这些数据后再写入文件系统之中</p></blockquote><ol><li>安装multer模块</li></ol><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> multer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>使用</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> multer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;multer&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>设置路径与文件名</li></ol><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> storage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> multer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">diskStorage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api接口">api接口<a class="hash-link" href="#api接口" title="Direct link to heading">​</a></h3><ul><li>url</li><li>方法</li><li>参数</li><li>结果</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-跨域-cors中间件处理">node 跨域 cors中间件处理<a class="hash-link" href="#node-跨域-cors中间件处理" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="身份验证">身份验证<a class="hash-link" href="#身份验证" title="Direct link to heading">​</a></h3><p>http请求 无状态 服务器、客户端相互不认识</p><ul><li>无状态，http的每次请求对服务器来说都是单独的请求，和之前请求没有任何关系</li></ul><p>基本思路:</p><ol><li>某个用户登录成功后,将用户相关信息加密,生成一个字符串给前端（通过cookie自动传）</li><li>这个用户调用其他接口时，将加密字符串（登录凭证）传给服务器，后端通过这些字符判断用户的身份（通过cookie自动传）</li><li>再根据这个用户的权限进行验证，是否可以操作</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="方案一session--cookie">方案一、session + cookie<a class="hash-link" href="#方案一session--cookie" title="Direct link to heading">​</a></h4><p>相关插件:</p><ul><li>cookie-parser 解析cookie</li><li>express-session
或</li><li>cookie-session</li></ul><p>使用步骤:</p><ol><li>用户输入用户名、密码进行登录</li><li>成功后，后端会存一个session，保存用户信息</li><li>session值当做cookie内容被种到客户端	</li><li>cookie会在请求下一个资源时携带（默认域名为作用域，子域名不会携带）</li><li>后端将cookie内容与session值进行对比，相等通过，不相等不通过</li><li>缺点:服务器需要存每个用户的session</li><li>cookie 不设置过期时间(内存cookie，会话cookie)，浏览器关闭自动删除，设置过期时间（硬盘cookie）浏览器关闭依然存在，过期了才会删除</li><li>当访问接口时，发现浏览器cookie存储有，与该接口同域名的cookie，就会自动携带到请求头中</li></ol><p>缺点
每个http都会携带
大小4kb限制
其他客户端(IOS 安卓) 必须手动设置，与浏览器自动不一致
分布式系统和服务器集群要保证服务器1中的session，要在服务器2、3中正确解析
设置cookie</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 客户端设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cookie</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;name=lzoxun;max-age=5;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 5s过期时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// koa 后端设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// sessin 基于 cookie，只能服务端设置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// npm install koa-session</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 设置 session 到时候 ctx 就会有session这个属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Session</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;koa-session&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> session </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;sessionid&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">maxAge</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">signed</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//签名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">keys</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;fdsafafsa&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 签名就要有这个，用户不知道这个就不能正确加解密，session别修改，这边也不会获取</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="方案二jwt-json-web-token">方案二、<a href="http://jwt.io" target="_blank" rel="noopener noreferrer">jwt</a> （json web token）<a class="hash-link" href="#方案二jwt-json-web-token" title="Direct link to heading">​</a></h4><p>使用步骤:</p><ul><li>用户登录 服务器产生一个token(加密字符串)发送给前端</li><li>前端将token进行保存  </li><li>前端发起数据请求通过 headers 携带 token</li><li>服务器验证token是否合法,如果合法继续操作否则终止操作  </li><li>token应用场景:无状态请求、保存用户登录状态、第三方登录...  </li></ul><p>jwt 生成token 的组成部分
header
alg : 默认 { algorithm: &quot;HS256&quot;} 对称加密
typ : 固定值
payload
用户信息
signature
设置 secreKey</p><p>生成 header.payload.siggnature 加密后的字符串</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="密码学">密码学<a class="hash-link" href="#密码学" title="Direct link to heading">​</a></h4><p>两种加密方式:
非对称加密（又叫公钥加密）:RS256、RSA算法 ...
通过私钥产生token、通过公钥解密token
指加密和解密使用不同密钥的加密算法,也称为公私钥加密。
加密过程: 原文 + 公钥 = 密文 （项目中好像遇到原文+私钥=密文？？）
解密过程: 密文 + 私钥 = 原文</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">相对安全复杂</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对称加密: AES
加密解密预定一个密钥，加密和解密使用相同同密钥的加密算法
加密过程: 原文 + 密钥 = 密文
解密过程: 密文 - 密钥 = 原文</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">相对简单快速</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>客户端加密的意义
1、如果被抓包，抓走的是明文还是密文，对方都可以拿来登陆，仅有的作用是，如果密码够复杂，对方无法解密，对面就不知道你的真时密码，就不肯拿真实密码去其他平台尝试登陆你的账户</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">2、类似(姓名、银行卡号、家庭住址。。。) 这种也可以客户端</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、如果可以做到到直接抓包无法登陆,或者不容易登陆 呢</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>​    </p><p>安全登陆姿势
1、将  密码+时间戳  加密后传输，服务端解密，并按照时间戳3s有效的方式允许登陆.这样也能加强安全性</p><p>客户端加服务器解密
客户端通过 <code>crypto-js</code> 将字符串通过指定方式加密，服务器拿到加密串后，可以以同样方式解密，或再次加密。。。</p><p>[官网]<!-- -->(<a href="https://www.openssl.org/source/" target="_blank" rel="noopener noreferrer"> https://www.openssl.org/source/</a>)    <a href="http://slproweb.com/products/Win32OpenSSL.html" target="_blank" rel="noopener noreferrer">下载地址</a></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># openssl方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 生成私钥 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl 回车</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenSSL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> genrsa -out rsa_private_key.pem </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#(-out 文件名 字符数) </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 根据私钥生成公钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenSSL</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem </span><span class="token comment" style="color:#999988;font-style:italic">#(-in 私钥名 -pubout -out 公钥名)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对称加密：指加密和解密使用<code>相同密钥</code>的加密算法。对称加密算法用来对敏感数据等信息进行加密,常用的算法包括DES、3DES、AES、DESX、Blowfish、RC4、...</p><p>插件  </p><ul><li><a href="https://www.npmjs.com/package/jsonwebtoken" target="_blank" rel="noopener noreferrer">jsonwebtoken</a></li></ul><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> jwt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;jsonwebtoken&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> scrict </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jfjdsajfdsajfdsa&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//私钥 （对称加密解密都是它）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> playload </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//传递的数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">us</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">123</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">ps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">456</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">creatToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">playload</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//产生token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    playload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">ctime</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    playload</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exp</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//30分钟过期</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 签名 默认HS256加密方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">sign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">playload</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scrict</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">checkToken</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">token</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resovle</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//验证</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">verify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> scrict</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">reject</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;token 验证失败&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">//ctime + exp &lt; Data().now 说明超时了 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">resolve</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    creatToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    checkToken</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// token 解码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> decoded </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">complete</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="密码加密-bcrypt">密码加密 bcrypt<a class="hash-link" href="#密码加密-bcrypt" title="Direct link to heading">​</a></h4><blockquote><p>每次加密得到的hash字符串是不一样的,验证时可以通过输入的密码与hash进行匹配</p></blockquote><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> bcrypt -S</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="express-rmvp-模式">Express RMVP 模式<a class="hash-link" href="#express-rmvp-模式" title="Direct link to heading">​</a></h3><blockquote><p>MVC -&gt; MVP|RMVP -&gt; MVVM ,Web 设计模式</p></blockquote><p><a href="http://www.ruanyifeng.com/blog/2015/02/mvcmvp_mvvm.html" target="_blank" rel="noopener noreferrer">参考</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mvc">MVC<a class="hash-link" href="#mvc" title="Direct link to heading">​</a></h4><ul><li>M:Model,模型层，数据相关的操作</li><li>V:View,视图层，用户界面渲染逻辑(html、css...)</li><li>C:控制器，js</li><li>MVC之间三方都能相互通讯</li><li>View层是界面，Controller层是业务逻辑，Model层是数据库访问(WEB接口调用)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mvp">MVP<a class="hash-link" href="#mvp" title="Direct link to heading">​</a></h4><ul><li>M:Model,模型层，数据相关的操作</li><li>V:View,视图层，用户界面渲染逻辑(html、css...)</li><li>P:Presenter,响应视图指令，同时进行相关业务处理，必要时候获调用 Model 获取底层数据，返回指令结果到视图，驱动视图渲染</li><li>MVP中M和V无法通讯<ul><li>Model 不再负责业务逻辑和视图变化，只负责底层数据处理</li><li>View 层只负责发起指令和根据数据渲染 UI，不再有主动监听数据变化等行为，所以也被称之为被动视图</li></ul></li><li>R:请求,RMVP是通过请求与控制器通讯(如 app.use(&quot;/R&quot;,xxx)) </li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mvvm">MVVM<a class="hash-link" href="#mvvm" title="Direct link to heading">​</a></h4><ul><li>M:Model,模型层，数据相关的操作</li><li>V:View,视图层，用户界面渲染逻辑(html、css...)</li><li>VM:ViewModel,</li><li>与MVP唯一的区别是，它采用双向绑定(data-binding),P虽然能与V相互通信,但是VM与V一端变化另一端直接变化</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="node服务调用谷歌控制台">node服务调用谷歌控制台<a class="hash-link" href="#node服务调用谷歌控制台" title="Direct link to heading">​</a></h3><p>node-dev 功能与nodemon类似</p><ul><li>通过 nodemon --inspect --inspect-brk? server.js 开启服务 </li><li>配合debugger使用</li><li>谷歌打开地址: chrome://inspect/#devices </li><li>点击 Open dedicated DevTools for Node -&gt; Connection 添加域名端口号</li><li>就能在 Open dedicated DevTools for Node -&gt; console 中天使node项目了</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="开发中常用插件">开发中常用插件<a class="hash-link" href="#开发中常用插件" title="Direct link to heading">​</a></h3><ul><li>log4js //日志操作</li><li>pm2 // 自动化部署node项目</li></ul><p><a href="https://www.bilibili.com/video/BV1Ci4y1L7gk?p=7" target="_blank" rel="noopener noreferrer">参考资料</a></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">去年工作总结与2021年工作计划</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    在去年一年时间里,逐渐完善了iot管理系统云版本，内网版，三套监控大屏系统，内网版的3D设备系统。移动端微信公众号也逐渐成熟，辉和、通佰、和猎狐三套样式都在维护，企业微信也有一套系统可以查看信息，也能方便维护人员在外面能做一些少量的管理，同时在休息时间学习了uni-app，nodejs，TypeScript，微信小程序以及云开发等新技术</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    如果有时间并且公司需要的话在2021年的计划中可以通过uni-app技术为公司开发移动端app、微信小程序、百度小程序、支付宝小程序等各个平台系统，可以通过云服务配合nodejs开发一些简单的服务器功能,不需要额外购买分配服务器，此外新的一年里如果时间计划的话，还会将现有系统进行适当优化，有适合的ui的话也可以计划将界面进行改版</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>http-server</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/server/node/server-nodejs.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/server/node/server-mongodb"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">mongodb</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/server/node/别人的文档"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">别人的文档</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#概念" class="table-of-contents__link toc-highlight">概念</a><ul><li><a href="#nodejs" class="table-of-contents__link toc-highlight">nodejs</a></li><li><a href="#js-引擎" class="table-of-contents__link toc-highlight">JS 引擎</a></li></ul></li><li><a href="#基础操作" class="table-of-contents__link toc-highlight">基础操作</a><ul><li><a href="#主要组成部分" class="table-of-contents__link toc-highlight">主要组成部分</a></li><li><a href="#流程" class="table-of-contents__link toc-highlight">流程</a></li><li><a href="#特性能" class="table-of-contents__link toc-highlight">特性能</a></li><li><a href="#三大特点" class="table-of-contents__link toc-highlight">三大特点:</a></li><li><a href="#运行环境" class="table-of-contents__link toc-highlight">运行环境</a></li><li><a href="#模块化" class="table-of-contents__link toc-highlight">模块化</a></li><li><a href="#爬虫" class="table-of-contents__link toc-highlight">爬虫</a></li><li><a href="#express" class="table-of-contents__link toc-highlight">express</a></li><li><a href="#什么是服务器" class="table-of-contents__link toc-highlight">什么是服务器</a></li><li><a href="#中间件middlewear" class="table-of-contents__link toc-highlight">中间件middlewear</a></li><li><a href="#静态资源目录-static" class="table-of-contents__link toc-highlight">静态资源目录 static</a></li><li><a href="#图片上传" class="table-of-contents__link toc-highlight">图片上传</a></li><li><a href="#api接口" class="table-of-contents__link toc-highlight">api接口</a></li><li><a href="#node-跨域-cors中间件处理" class="table-of-contents__link toc-highlight">node 跨域 cors中间件处理</a></li><li><a href="#身份验证" class="table-of-contents__link toc-highlight">身份验证</a></li><li><a href="#express-rmvp-模式" class="table-of-contents__link toc-highlight">Express RMVP 模式</a></li><li><a href="#node服务调用谷歌控制台" class="table-of-contents__link toc-highlight">node服务调用谷歌控制台</a></li><li><a href="#开发中常用插件" class="table-of-contents__link toc-highlight">开发中常用插件</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/other-weblinks">收藏网址</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/other/other-markdown">Markdown</a></li></ul></div><div class="col footer__col"><div class="footer__title">外部链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/liaozhongxun" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/lzo-gitee" target="_blank" rel="noopener noreferrer" class="footer__link-item">码云<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lzo-gitee.gitee.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">码云WEB<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lzo-gitee.gitee.io/gitee-static/images/home.png" target="_blank" rel="noopener noreferrer" class="footer__link-item">码云 WEB static BasePath<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">博客</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.001365ce.js"></script>
<script src="/assets/js/main.c475113b.js"></script>
</body>
</html>