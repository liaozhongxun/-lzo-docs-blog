"use strict";(self.webpackChunklzo_docs_blog=self.webpackChunklzo_docs_blog||[]).push([[7407],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>m});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=r.createContext({}),p=function(e){var n=r.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(o.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(t),m=a,k=d["".concat(o,".").concat(m)]||d[m]||u[m]||l;return t?r.createElement(k,s(s({ref:n},c),{},{components:t})):r.createElement(k,s({ref:n},c))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,s=new Array(l);s[0]=d;var i={};for(var o in n)hasOwnProperty.call(n,o)&&(i[o]=n[o]);i.originalType=e,i.mdxType="string"==typeof e?e:a,s[1]=i;for(var p=2;p<l;p++)s[p]=t[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},2359:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var r=t(7462),a=(t(7294),t(3905));const l={},s=void 0,i={unversionedId:"server/node/\u522b\u4eba\u7684\u6587\u6863",id:"server/node/\u522b\u4eba\u7684\u6587\u6863",title:"\u522b\u4eba\u7684\u6587\u6863",description:"\u6700\u8fd1\u8bfb\u300a\u91cd\u5b66\u524d\u7aef\u300b\uff0c\u5f00\u7bc7\u5c31\u662f\u8ba9\u4f60\u62e5\u6709\u81ea\u5df1\u7684\u77e5\u8bc6\u4f53\u7cfb\u56fe\u8c31\uff0c\u540e\u7eed\u5b66\u7684\u4e1c\u897f\u8865\u5145\u5230\u76f8\u5e94\u7684\u6a21\u5757\uff0c\u65e2\u53ef\u4ee5\u52a0\u6df1\u5bf9\u539f\u6709\u77e5\u8bc6\u7684\u7406\u89e3\uff0c\u53c8\u53ef\u4ee5\u5f3a\u5316\u8bb0\u5fc6\uff0c\u5f88\u4e0d\u9519\u7684\u5b66\u4e60\u65b9\u6848\u3002",source:"@site/docs/server/node/\u522b\u4eba\u7684\u6587\u6863.md",sourceDirName:"server/node",slug:"/server/node/\u522b\u4eba\u7684\u6587\u6863",permalink:"/docs/server/node/\u522b\u4eba\u7684\u6587\u6863",draft:!1,editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/server/node/\u522b\u4eba\u7684\u6587\u6863.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"nodejs\u57fa\u7840",permalink:"/docs/server/node/server-nodejs"},next:{title:"python",permalink:"/docs/server/python/python-base"}},o={},p=[{value:"require(id)",id:"requireid",level:2},{value:"module.exports",id:"moduleexports",level:3},{value:"JSON \u6587\u4ef6",id:"json-\u6587\u4ef6",level:3},{value:"\u52a0\u8f7d\u5927\u6587\u4ef6",id:"\u52a0\u8f7d\u5927\u6587\u4ef6",level:3},{value:"module.exports \u548c exports",id:"moduleexports-\u548c-exports",level:2},{value:"\u6267\u884c\u65f6",id:"\u6267\u884c\u65f6",level:3},{value:"exports",id:"exports",level:3},{value:"\u4f7f\u7528",id:"\u4f7f\u7528",level:3},{value:"\u8def\u5f84\u53d8\u91cf",id:"\u8def\u5f84\u53d8\u91cf",level:2},{value:"console",id:"console",level:2},{value:"process",id:"process",level:2},{value:"\u67e5\u770b PATH",id:"\u67e5\u770b-path",level:3},{value:"\u8bbe\u7f6e PATH",id:"\u8bbe\u7f6e-path",level:3},{value:"\u83b7\u53d6\u4fe1\u606f",id:"\u83b7\u53d6\u4fe1\u606f",level:3},{value:"nextTick",id:"nexttick",level:3},{value:"toString",id:"tostring",level:2},{value:"data URI",id:"data-uri",level:2},{value:"promisify",id:"promisify",level:2},{value:"\u7406\u89e3\u6d41",id:"\u7406\u89e3\u6d41",level:2},{value:"\u6d41\u7684\u7c7b\u578b",id:"\u6d41\u7684\u7c7b\u578b",level:3},{value:"\u4f7f\u7528\u5185\u5efa\u6d41 API",id:"\u4f7f\u7528\u5185\u5efa\u6d41-api",level:2},{value:"\u9759\u6001 web \u670d\u52a1\u5668",id:"\u9759\u6001-web-\u670d\u52a1\u5668",level:3},{value:"\u4e0d\u4f7f\u7528\u6d41",id:"\u4e0d\u4f7f\u7528\u6d41",level:4},{value:"\u4f7f\u7528\u6d41",id:"\u4f7f\u7528\u6d41",level:4},{value:"\u4f7f\u7528\u6d41 + gzip",id:"\u4f7f\u7528\u6d41--gzip",level:4},{value:"\u6d41\u7684\u9519\u8bef\u5904\u7406",id:"\u6d41\u7684\u9519\u8bef\u5904\u7406",level:3},{value:"\u4f7f\u7528\u6d41\u57fa\u7c7b",id:"\u4f7f\u7528\u6d41\u57fa\u7c7b",level:2},{value:"\u53ef\u8bfb\u6d41 - JSON \u884c\u89e3\u6790\u5668",id:"\u53ef\u8bfb\u6d41---json-\u884c\u89e3\u6790\u5668",level:3},{value:"\u53ef\u5199\u6d41 - \u6587\u5b57\u53d8\u8272",id:"\u53ef\u5199\u6d41---\u6587\u5b57\u53d8\u8272",level:3},{value:"\u53cc\u5de5\u6d41 - \u63a5\u53d7\u548c\u8f6c\u6362\u6570\u636e",id:"\u53cc\u5de5\u6d41---\u63a5\u53d7\u548c\u8f6c\u6362\u6570\u636e",level:3},{value:"\u8f6c\u6362\u6d41 - \u89e3\u6790\u6570\u636e",id:"\u8f6c\u6362\u6d41---\u89e3\u6790\u6570\u636e",level:3},{value:"\u6d4b\u8bd5\u6d41",id:"\u6d4b\u8bd5\u6d41",level:2},{value:"fs \u6a21\u5757\u4ea4\u4e92",id:"fs-\u6a21\u5757\u4ea4\u4e92",level:2},{value:"POSIX \u6587\u4ef6\u7cfb\u7edf",id:"posix-\u6587\u4ef6\u7cfb\u7edf",level:2},{value:"\u8bfb\u5199\u6d41",id:"\u8bfb\u5199\u6d41",level:2},{value:"\u6587\u4ef6\u76d1\u63a7",id:"\u6587\u4ef6\u76d1\u63a7",level:2},{value:"\u540c\u6b65\u8bfb\u53d6\u4e0e require",id:"\u540c\u6b65\u8bfb\u53d6\u4e0e-require",level:2},{value:"\u6587\u4ef6\u63cf\u8ff0",id:"\u6587\u4ef6\u63cf\u8ff0",level:2},{value:"\u6587\u4ef6\u9501",id:"\u6587\u4ef6\u9501",level:2},{value:"\u72ec\u5360\u6807\u8bb0",id:"\u72ec\u5360\u6807\u8bb0",level:3},{value:"mkdir \u6587\u4ef6\u9501",id:"mkdir-\u6587\u4ef6\u9501",level:3},{value:"lock \u6a21\u5757\u5b9e\u73b0",id:"lock-\u6a21\u5757\u5b9e\u73b0",level:3},{value:"\u9012\u5f52\u6587\u4ef6\u64cd\u4f5c",id:"\u9012\u5f52\u6587\u4ef6\u64cd\u4f5c",level:2},{value:"\u76d1\u89c6\u6587\u4ef6\u548c\u6587\u4ef6\u5939",id:"\u76d1\u89c6\u6587\u4ef6\u548c\u6587\u4ef6\u5939",level:2},{value:"\u9010\u884c\u5730\u8bfb\u53d6\u6587\u4ef6\u6d41",id:"\u9010\u884c\u5730\u8bfb\u53d6\u6587\u4ef6\u6d41",level:2},{value:"\u83b7\u53d6\u672c\u5730 IP",id:"\u83b7\u53d6\u672c\u5730-ip",level:2},{value:"TCP \u5ba2\u6237\u7aef",id:"tcp-\u5ba2\u6237\u7aef",level:2},{value:"\u542f\u52a8\u4e0e\u6d4b\u8bd5 TCP",id:"\u542f\u52a8\u4e0e\u6d4b\u8bd5-tcp",level:3},{value:"UDP \u5ba2\u6237\u7aef",id:"udp-\u5ba2\u6237\u7aef",level:2},{value:"\u6587\u4ef6\u53d1\u9001\u670d\u52a1",id:"\u6587\u4ef6\u53d1\u9001\u670d\u52a1",level:3},{value:"HTTP \u5ba2\u6237\u7aef",id:"http-\u5ba2\u6237\u7aef",level:2},{value:"\u542f\u52a8\u4e0e\u6d4b\u8bd5 HTTP",id:"\u542f\u52a8\u4e0e\u6d4b\u8bd5-http",level:3},{value:"\u91cd\u5b9a\u5411",id:"\u91cd\u5b9a\u5411",level:3},{value:"HTTP \u4ee3\u7406",id:"http-\u4ee3\u7406",level:3},{value:"\u5c01\u88c5 request-promise",id:"\u5c01\u88c5-request-promise",level:3},{value:"DNS \u8bf7\u6c42",id:"dns-\u8bf7\u6c42",level:2},{value:"crypto \u5e93\u52a0\u5bc6\u89e3\u5bc6",id:"crypto-\u5e93\u52a0\u5bc6\u89e3\u5bc6",level:2},{value:"\u53d1\u8d77 HTTP \u8bf7\u6c42\u7684\u65b9\u6cd5",id:"\u53d1\u8d77-http-\u8bf7\u6c42\u7684\u65b9\u6cd5",level:2},{value:"\u6267\u884c\u5916\u90e8\u5e94\u7528",id:"\u6267\u884c\u5916\u90e8\u5e94\u7528",level:2},{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:3},{value:"execFile",id:"execfile",level:3},{value:"spawn",id:"spawn",level:3},{value:"\u5355\u4e00\u4efb\u52a1",id:"\u5355\u4e00\u4efb\u52a1",level:4},{value:"\u591a\u4efb\u52a1\u4e32\u8054",id:"\u591a\u4efb\u52a1\u4e32\u8054",level:4},{value:"exec",id:"exec",level:3},{value:"fork",id:"fork",level:3},{value:"\u7236\u5b50\u901a\u4fe1",id:"\u7236\u5b50\u901a\u4fe1",level:4},{value:"\u5e38\u7528\u6280\u5de7",id:"\u5e38\u7528\u6280\u5de7",level:2},{value:"\u9000\u51fa\u65f6\u6740\u6b7b\u6240\u6709\u5b50\u8fdb\u7a0b",id:"\u9000\u51fa\u65f6\u6740\u6b7b\u6240\u6709\u5b50\u8fdb\u7a0b",level:3},{value:"Cluster \u7684\u7406\u89e3",id:"cluster-\u7684\u7406\u89e3",level:2},{value:"\u5355\u7ebf\u7a0b\u95ee\u9898",id:"\u5355\u7ebf\u7a0b\u95ee\u9898",level:2},{value:"Node \u7ebf\u7a0b",id:"node-\u7ebf\u7a0b",level:2},{value:"\u5f02\u6b65 IO",id:"\u5f02\u6b65-io",level:2},{value:"cluster \u591a\u8fdb\u7a0b",id:"cluster-\u591a\u8fdb\u7a0b",level:2},{value:"\u771f Node \u591a\u7ebf\u7a0b",id:"\u771f-node-\u591a\u7ebf\u7a0b",level:2},{value:"\u7ebf\u7a0b\u901a\u4fe1",id:"\u7ebf\u7a0b\u901a\u4fe1",level:3},{value:"\u591a\u8fdb\u7a0b vs \u591a\u7ebf\u7a0b",id:"\u591a\u8fdb\u7a0b-vs-\u591a\u7ebf\u7a0b",level:2},{value:"\u5206\u5e03\u5f0f\u9501",id:"\u5206\u5e03\u5f0f\u9501",level:2},{value:"\u6570\u636e\u5e93\u7684\u552f\u4e00\u7d22\u5f15",id:"\u6570\u636e\u5e93\u7684\u552f\u4e00\u7d22\u5f15",level:3},{value:"Redis \u7684 SETNX \u6307\u4ee4",id:"redis-\u7684-setnx-\u6307\u4ee4",level:3},{value:"Redis \u7684 RedLock \u7b97\u6cd5",id:"redis-\u7684-redlock-\u7b97\u6cd5",level:3},{value:"\u7ec4\u4ef6\u5f0f\u6784\u5efa",id:"\u7ec4\u4ef6\u5f0f\u6784\u5efa",level:2},{value:"\u591a\u73af\u5883\u914d\u7f6e",id:"\u591a\u73af\u5883\u914d\u7f6e",level:2},{value:"\u4f9d\u8d56\u7ba1\u7406",id:"\u4f9d\u8d56\u7ba1\u7406",level:2},{value:"\u5904\u7406\u672a\u6355\u83b7\u7684\u5f02\u5e38",id:"\u5904\u7406\u672a\u6355\u83b7\u7684\u5f02\u5e38",level:2},{value:"\u901a\u8fc7 domain \u7ba1\u7406\u5f02\u5e38",id:"\u901a\u8fc7-domain-\u7ba1\u7406\u5f02\u5e38",level:2},{value:"Joi \u9a8c\u8bc1\u53c2\u6570",id:"joi-\u9a8c\u8bc1\u53c2\u6570",level:2},{value:"Kibana \u7cfb\u7edf\u76d1\u63a7",id:"kibana-\u7cfb\u7edf\u76d1\u63a7",level:2},{value:"\u4f7f\u7528 winston \u8bb0\u5f55\u65e5\u8bb0",id:"\u4f7f\u7528-winston-\u8bb0\u5f55\u65e5\u8bb0",level:2},{value:"\u59d4\u6258\u53cd\u5411\u4ee3\u7406",id:"\u59d4\u6258\u53cd\u5411\u4ee3\u7406",level:2},{value:"\u68c0\u6d4b\u6709\u6f0f\u6d1e\u7684\u4f9d\u8d56\u9879",id:"\u68c0\u6d4b\u6709\u6f0f\u6d1e\u7684\u4f9d\u8d56\u9879",level:2},{value:"PM2 HTTP \u96c6\u7fa4\u914d\u7f6e",id:"pm2-http-\u96c6\u7fa4\u914d\u7f6e",level:2},{value:"\u5de5\u4f5c\u7ebf\u7a0b\u914d\u7f6e",id:"\u5de5\u4f5c\u7ebf\u7a0b\u914d\u7f6e",level:3},{value:"PM2 \u81ea\u52a8\u542f\u52a8",id:"pm2-\u81ea\u52a8\u542f\u52a8",level:3},{value:"\u907f\u514d\u4f7f\u7528 Lodash",id:"\u907f\u514d\u4f7f\u7528-lodash",level:2},{value:"benchmark",id:"benchmark",level:2},{value:"\u4f7f\u7528 prof \u8fdb\u884c\u6027\u80fd\u5206\u6790",id:"\u4f7f\u7528-prof-\u8fdb\u884c\u6027\u80fd\u5206\u6790",level:2},{value:"\u4f7f\u7528 headdump \u5806\u5feb\u7167",id:"\u4f7f\u7528-headdump-\u5806\u5feb\u7167",level:2},{value:"helmet \u8bbe\u7f6e\u5b89\u5168\u54cd\u5e94\u5934",id:"helmet-\u8bbe\u7f6e\u5b89\u5168\u54cd\u5e94\u5934",level:2},{value:"\u4f7f\u7528 security-linter \u63d2\u4ef6",id:"\u4f7f\u7528-security-linter-\u63d2\u4ef6",level:2},{value:"koa-ratelimit \u9650\u5236\u5e76\u53d1\u8bf7\u6c42",id:"koa-ratelimit-\u9650\u5236\u5e76\u53d1\u8bf7\u6c42",level:2},{value:"\u7eaf\u6587\u672c\u673a\u5bc6\u4fe1\u606f\u653e\u7f6e",id:"\u7eaf\u6587\u672c\u673a\u5bc6\u4fe1\u606f\u653e\u7f6e",level:2},{value:"ORM/ODM \u5e93\u9632\u6b62\u67e5\u8be2\u6ce8\u5165\u6f0f\u6d1e",id:"ormodm-\u5e93\u9632\u6b62\u67e5\u8be2\u6ce8\u5165\u6f0f\u6d1e",level:2},{value:"\u4f7f\u7528 Bcrypt \u4ee3\u66ff Crypto",id:"\u4f7f\u7528-bcrypt-\u4ee3\u66ff-crypto",level:2},{value:"\u8f6c\u4e49 HTML\u3001JS \u548c CSS \u8f93\u51fa",id:"\u8f6c\u4e49-htmljs-\u548c-css-\u8f93\u51fa",level:2},{value:"\u9a8c\u8bc1\u4f20\u5165\u7684 JSON schemas",id:"\u9a8c\u8bc1\u4f20\u5165\u7684-json-schemas",level:2},{value:"\u652f\u6301\u9ed1\u540d\u5355\u7684 JWT",id:"\u652f\u6301\u9ed1\u540d\u5355\u7684-jwt",level:2},{value:"\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u5141\u8bb8\u7684\u767b\u5f55\u8bf7\u6c42",id:"\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u5141\u8bb8\u7684\u767b\u5f55\u8bf7\u6c42",level:2},{value:"\u4f7f\u7528\u975e root \u7528\u6237\u8fd0\u884c Node.js",id:"\u4f7f\u7528\u975e-root-\u7528\u6237\u8fd0\u884c-nodejs",level:2},{value:"\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\u6216\u4e2d\u95f4\u4ef6\u9650\u5236\u8d1f\u8f7d\u5927\u5c0f",id:"\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\u6216\u4e2d\u95f4\u4ef6\u9650\u5236\u8d1f\u8f7d\u5927\u5c0f",level:2},{value:"\u9632\u6b62 RegEx \u8ba9 NodeJS \u8fc7\u8f7d",id:"\u9632\u6b62-regex-\u8ba9-nodejs-\u8fc7\u8f7d",level:2},{value:"\u5728\u6c99\u7bb1\u4e2d\u8fd0\u884c\u4e0d\u5b89\u5168\u4ee3\u7801",id:"\u5728\u6c99\u7bb1\u4e2d\u8fd0\u884c\u4e0d\u5b89\u5168\u4ee3\u7801",level:2},{value:"\u9690\u85cf\u5ba2\u6237\u7aef\u7684\u9519\u8bef\u8be6\u7ec6\u4fe1\u606f",id:"\u9690\u85cf\u5ba2\u6237\u7aef\u7684\u9519\u8bef\u8be6\u7ec6\u4fe1\u606f",level:2},{value:"\u5bf9 npm \u6216 Yarn\uff0c\u914d\u7f6e 2FA",id:"\u5bf9-npm-\u6216-yarn\u914d\u7f6e-2fa",level:2},{value:"session \u4e2d\u95f4\u4ef6\u8bbe\u7f6e",id:"session-\u4e2d\u95f4\u4ef6\u8bbe\u7f6e",level:2},{value:"csurf \u9632\u6b62 CSRF",id:"csurf-\u9632\u6b62-csrf",level:2},{value:"watch \u670d\u52a1",id:"watch-\u670d\u52a1",level:2},{value:"RESTful web \u5e94\u7528",id:"restful-web-\u5e94\u7528",level:2},{value:"\u4e2d\u95f4\u4ef6\u5e94\u7528",id:"\u4e2d\u95f4\u4ef6\u5e94\u7528",level:2},{value:"\u901a\u8fc7\u4e8b\u4ef6\u7ec4\u7ec7\u5e94\u7528",id:"\u901a\u8fc7\u4e8b\u4ef6\u7ec4\u7ec7\u5e94\u7528",level:2},{value:"WebSocket \u4e0e session",id:"websocket-\u4e0e-session",level:2},{value:"Express4 \u4e2d\u95f4\u4ef6",id:"express4-\u4e2d\u95f4\u4ef6",level:2},{value:"JWT",id:"jwt",level:2},{value:"\u8de8\u57df\u8ba4\u8bc1",id:"\u8de8\u57df\u8ba4\u8bc1",level:3},{value:"\u4e00\u822c\u6d41\u7a0b",id:"\u4e00\u822c\u6d41\u7a0b",level:4},{value:"session \u5171\u4eab",id:"session-\u5171\u4eab",level:4},{value:"JWT",id:"jwt-1",level:3},{value:"\u539f\u7406",id:"\u539f\u7406",level:4},{value:"\u6570\u636e\u7ed3\u6784",id:"\u6570\u636e\u7ed3\u6784",level:4},{value:"Header",id:"header",level:5},{value:"Payload",id:"payload",level:5},{value:"Signature",id:"signature",level:5},{value:"\u4f7f\u7528\u65b9\u5f0f",id:"\u4f7f\u7528\u65b9\u5f0f",level:4},{value:"\u7279\u70b9",id:"\u7279\u70b9",level:4},{value:"koa",id:"koa",level:2},{value:"\u6838\u5fc3\u5bf9\u8c61",id:"\u6838\u5fc3\u5bf9\u8c61",level:3},{value:"\u6e90\u7801\u7ec4\u6210",id:"\u6e90\u7801\u7ec4\u6210",level:3},{value:"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528",id:"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528",level:3},{value:"\u8fd4\u56de\u5a92\u4f53\u8d44\u6e90",id:"\u8fd4\u56de\u5a92\u4f53\u8d44\u6e90",level:3},{value:"Web API \u8bbe\u8ba1",id:"web-api-\u8bbe\u8ba1",level:2},{value:"\u9700\u6c42",id:"\u9700\u6c42",level:3},{value:"\u91cd\u8981\u51c6\u5219",id:"\u91cd\u8981\u51c6\u5219",level:3},{value:"\u516c\u94a5\u52a0\u5bc6\u79c1\u94a5\u89e3\u5bc6",id:"\u516c\u94a5\u52a0\u5bc6\u79c1\u94a5\u89e3\u5bc6",level:2},{value:"\u751f\u6210\u516c\u94a5\u79c1\u94a5",id:"\u751f\u6210\u516c\u94a5\u79c1\u94a5",level:3},{value:"crypto \u4f7f\u7528",id:"crypto-\u4f7f\u7528",level:3},{value:"redis \u7f13\u5b58\u63a5\u53e3",id:"redis-\u7f13\u5b58\u63a5\u53e3",level:2},{value:"redis \u4f7f\u7528",id:"redis-\u4f7f\u7528",level:3},{value:"node-schedule \u4f7f\u7528",id:"node-schedule-\u4f7f\u7528",level:2},{value:"\u8de8\u57df\u5171\u4eab Cookie",id:"\u8de8\u57df\u5171\u4eab-cookie",level:2},{value:"\u4e8c\u7ea7\u57df\u540d\u5171\u4eab Cookie",id:"\u4e8c\u7ea7\u57df\u540d\u5171\u4eab-cookie",level:3},{value:"\u6dd8\u5b9d\u5929\u732b\u5171\u4eab Cookie",id:"\u6dd8\u5b9d\u5929\u732b\u5171\u4eab-cookie",level:3}],c={toc:p};function u(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"\u6700\u8fd1\u8bfb\u300a\u91cd\u5b66\u524d\u7aef\u300b\uff0c\u5f00\u7bc7\u5c31\u662f\u8ba9\u4f60\u62e5\u6709\u81ea\u5df1\u7684\u77e5\u8bc6\u4f53\u7cfb\u56fe\u8c31\uff0c\u540e\u7eed\u5b66\u7684\u4e1c\u897f\u8865\u5145\u5230\u76f8\u5e94\u7684\u6a21\u5757\uff0c\u65e2\u53ef\u4ee5\u52a0\u6df1\u5bf9\u539f\u6709\u77e5\u8bc6\u7684\u7406\u89e3\uff0c\u53c8\u53ef\u4ee5\u5f3a\u5316\u8bb0\u5fc6\uff0c\u5f88\u4e0d\u9519\u7684\u5b66\u4e60\u65b9\u6848\u3002"),(0,a.kt)("p",null,"\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u77e5\u8bc6\u70b9\u6765\u81ea\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.amazon.cn/dp/B01MYX8XG1"},"\u300aNode.js\u786c\u5b9e\u6218\uff1a115\u4e2a\u6838\u5fc3\u6280\u5de7\u300b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/i0natan/nodebestpractices"},"i0natan/nodebestpractices")),(0,a.kt)("li",{parentName:"ul"},"\u540e\u7eed\u5b66\u4e60\u7684\u4e00\u4e9b\u77e5\u8bc6\u70b9")),(0,a.kt)("h1",{id:"docsify-\u6587\u6863"},"docsify \u6587\u6863"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://static.chenng.cn/#/%E5%9F%BA%E7%A1%80-%E5%90%8E%E7%AB%AF/NodeJS"},"https://static.chenng.cn/#/%E5%9F%BA%E7%A1%80-%E5%90%8E%E7%AB%AF/NodeJS")),(0,a.kt)("h1",{id:"\u66f4\u65b0\u8bb0\u5f55"},"\u66f4\u65b0\u8bb0\u5f55"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/ringcrl/node-point/commits/master"},"CHANGE LOG")),(0,a.kt)("h1",{id:"\u8bf4\u660e"},"\u8bf4\u660e"),(0,a.kt)("p",null,"\u6bd4\u8f83\u597d\u7684 markdown \u7684\u67e5\u770b\u65b9\u5f0f\u662f\u76f4\u63a5\u7528 VSCode \u6253\u5f00\u5927\u7eb2\uff0c\u8fd9\u6837\u6574\u4e2a\u8109\u7edc\u4e00\u76ee\u4e86\u7136\uff0c\u540e\u7eed\u8865\u5145\u77e5\u8bc6\u70b9\u4e5f\u5f88\u5feb\u5b9a\u4f4d\u5230\u76f8\u5e94\u7684\u4f4d\u7f6e\uff1a"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://qiniu.chenng.cn/2019-01-28-09-44-31.png",alt:"01.png"})),(0,a.kt)("p",null,"\u8fd9\u4e2a markdown \u6587\u4ef6\u5df2\u7ecf\u4e22\u5230 Github\uff0c\u6709\u66f4\u65b0\u4f1a\u76f4\u63a5\u63a8\u8fd9\u91cc\uff1a"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/ringcrl/node-point"},"https://github.com/ringcrl/node-point")),(0,a.kt)("p",null,"\u535a\u5ba2\u4e0a\u4e5f\u4f1a\u8bb0\u5f55\u4e00\u4e9b\u597d\u73a9\u7684\u4e1c\u897f\uff1a"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"http://www.chenng.cn/archives/"},"www.chenng.cn/archives/")),(0,a.kt)("h1",{id:"\u5b89\u88c5"},"\u5b89\u88c5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"# \u4f7f\u7528 nvm \u5b89\u88c5\nhttps://github.com/creationix/nvm#install-script # Git install\n\nnvm install\nnvm alias default\n\n# \u5378\u8f7d pkg \u5b89\u88c5\u7248\nsudo rm -rf /usr/local/{bin/{node,npm},lib/node_modules/npm,lib/node,share/man/*/node.*}\n")),(0,a.kt)("h1",{id:"\u5168\u5c40\u53d8\u91cf"},"\u5168\u5c40\u53d8\u91cf"),(0,a.kt)("h2",{id:"requireid"},"require(id)"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5185\u5efa\u6a21\u5757\u76f4\u63a5\u4ece\u5185\u5b58\u52a0\u8f7d"),(0,a.kt)("li",{parentName:"ul"},"\u6587\u4ef6\u6a21\u5757\u901a\u8fc7\u6587\u4ef6\u67e5\u627e\u5b9a\u4f4d\u5230\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ul"},"\u5305\u901a\u8fc7 package.json \u91cc\u9762\u7684 main \u5b57\u6bb5\u67e5\u627e\u5165\u53e3\u6587\u4ef6")),(0,a.kt)("h3",{id:"moduleexports"},"module.exports"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u901a\u8fc7\u5982\u4e0b\u6a21\u5757\u5305\u88c5\u5f97\u5230\n(funciton (exports, require, module, __filename, __dirname) { // \u5305\u88c5\u5934\n\n}); // \u5305\u88c5\u5c3e\n")),(0,a.kt)("h3",{id:"json-\u6587\u4ef6"},"JSON \u6587\u4ef6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"fs.readFileSync()")," \u52a0\u8f7d"),(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"JSON.parse()")," \u89e3\u6790")),(0,a.kt)("h3",{id:"\u52a0\u8f7d\u5927\u6587\u4ef6"},"\u52a0\u8f7d\u5927\u6587\u4ef6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"require \u6210\u529f\u540e\u4f1a\u7f13\u5b58\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ul"},"\u5927\u91cf\u4f7f\u7528\u4f1a\u5bfc\u81f4\u5927\u91cf\u6570\u636e\u9a7b\u7559\u5728\u5185\u5b58\u4e2d\uff0c\u5bfc\u81f4 GC \u9891\u5206\u548c\u5185\u5b58\u6cc4\u9732")),(0,a.kt)("h2",{id:"moduleexports-\u548c-exports"},"module.exports \u548c exports"),(0,a.kt)("h3",{id:"\u6267\u884c\u65f6"},"\u6267\u884c\u65f6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"(funciton(exports, require, module, __filename, __dirname) { // \u5305\u88c5\u5934\n  console.log('hello world!') // \u539f\u59cb\u6587\u4ef6\n}); // \u5305\u88c5\u5c3e\n")),(0,a.kt)("h3",{id:"exports"},"exports"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"exports \u662f module \u7684\u5c5e\u6027\uff0c\u9ed8\u8ba4\u60c5\u51b5\u662f\u7a7a\u5bf9\u8c61"),(0,a.kt)("li",{parentName:"ul"},"require \u4e00\u4e2a\u6a21\u5757\u5b9e\u9645\u5f97\u5230\u7684\u662f\u8be5\u6a21\u5757\u7684 exports \u5c5e\u6027"),(0,a.kt)("li",{parentName:"ul"},"exports.xxx \u5bfc\u51fa\u5177\u6709\u591a\u4e2a\u5c5e\u6027\u7684\u5bf9\u8c61"),(0,a.kt)("li",{parentName:"ul"},"module.exports = xxx \u5bfc\u51fa\u4e00\u4e2a\u5bf9\u8c61")),(0,a.kt)("h3",{id:"\u4f7f\u7528"},"\u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// module-2.js\nexports.method = function() {\n  return 'Hello';\n};\n\nexports.method2 = function() {\n  return 'Hello again';\n};\n\n// module-1.js\nconst module2 = require('./module-2');\nconsole.log(module2.method()); // Hello\nconsole.log(module2.method2()); // Hello again\n")),(0,a.kt)("h2",{id:"\u8def\u5f84\u53d8\u91cf"},"\u8def\u5f84\u53d8\u91cf"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"console.log('__dirname:', __dirname); // \u6587\u4ef6\u5939\nconsole.log('__filename:', __filename); // \u6587\u4ef6\n\npath.join(__dirname, 'views', 'view.html'); // \u5982\u679c\u4e0d\u5e0c\u671b\u81ea\u5df1\u624b\u52a8\u5904\u7406 / \u7684\u95ee\u9898\uff0c\u4f7f\u7528 path.join\n\n// HOME \u76ee\u5f55\nconst homeDir =  require('os').homedir();\n")),(0,a.kt)("h2",{id:"console"},"console"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"center"},"\u5360\u4f4d\u7b26"),(0,a.kt)("th",{parentName:"tr",align:"center"},"\u7c7b\u578b"),(0,a.kt)("th",{parentName:"tr",align:"center"},"\u4f8b\u5b50"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"center"},"%s"),(0,a.kt)("td",{parentName:"tr",align:"center"},"String"),(0,a.kt)("td",{parentName:"tr",align:"center"},"console.log('%s', 'value')")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"center"},"%d"),(0,a.kt)("td",{parentName:"tr",align:"center"},"Number"),(0,a.kt)("td",{parentName:"tr",align:"center"},"console.log('%d', 3.14)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"center"},"%j"),(0,a.kt)("td",{parentName:"tr",align:"center"},"JSON"),(0,a.kt)("td",{parentName:"tr",align:"center"},"console.log('%j', {name: 'Chenng'})")))),(0,a.kt)("h2",{id:"process"},"process"),(0,a.kt)("h3",{id:"\u67e5\u770b-path"},"\u67e5\u770b PATH"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"node\n\nconsole.log(process.env.PATH.split(':').join('\\n'));\n")),(0,a.kt)("h3",{id:"\u8bbe\u7f6e-path"},"\u8bbe\u7f6e PATH"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"process.env.PATH += ':/a_new_path_to_executables';\n")),(0,a.kt)("h3",{id:"\u83b7\u53d6\u4fe1\u606f"},"\u83b7\u53d6\u4fe1\u606f"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u83b7\u53d6\u5e73\u53f0\u4fe1\u606f\nprocess.arch // x64\nprocess.platform // darwin\n\n// \u83b7\u53d6\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\nprocess.memoryUsage();\n\n// \u83b7\u53d6\u547d\u4ee4\u884c\u53c2\u6570\nprocess.argv\n")),(0,a.kt)("h3",{id:"nexttick"},"nextTick"),(0,a.kt)("p",null,"process.nextTick \u65b9\u6cd5\u5141\u8bb8\u4f60\u628a\u4e00\u4e2a\u56de\u8c03\u653e\u5728\u4e0b\u4e00\u6b21\u65f6\u95f4\u8f6e\u8be2\u961f\u5217\u7684\u5934\u4e0a\uff0c\u8fd9\u610f\u5473\u7740\u53ef\u4ee5\u7528\u6765\u5ef6\u8fdf\u6267\u884c\uff0c\u7ed3\u679c\u662f\u6bd4 setTimeout \u66f4\u6709\u6548\u7387\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const EventEmitter = require('events').EventEmitter;\n\nfunction complexOperations() {\n  const events = new EventEmitter();\n\n  process.nextTick(function () {\n    events.emit('success');\n  });\n\n  return events;\n}\n\ncomplexOperations().on('success', function () {\n  console.log('success!');\n});\n")),(0,a.kt)("h1",{id:"buffer"},"Buffer"),(0,a.kt)("p",null,"\u5982\u679c\u6ca1\u6709\u63d0\u4f9b\u7f16\u7801\u683c\u5f0f\uff0c\u6587\u4ef6\u64cd\u4f5c\u4ee5\u53ca\u5f88\u591a\u7f51\u7edc\u64cd\u4f5c\u5c31\u4f1a\u5c06\u6570\u636e\u4f5c\u4e3a Buffer \u7c7b\u578b\u8fd4\u56de\u3002"),(0,a.kt)("h2",{id:"tostring"},"toString"),(0,a.kt)("p",null,"\u9ed8\u8ba4\u8f6c\u4e3a ",(0,a.kt)("inlineCode",{parentName:"p"},"UTF-8")," \u683c\u5f0f\uff0c\u8fd8\u652f\u6301 ",(0,a.kt)("inlineCode",{parentName:"p"},"ascii"),"\u3001",(0,a.kt)("inlineCode",{parentName:"p"},"base64")," \u7b49\u3002"),(0,a.kt)("h2",{id:"data-uri"},"data URI"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u751f\u6210 data URI\nconst fs = require('fs');\nconst mime = 'image/png';\nconst encoding = 'base64';\nconst base64Data = fs.readFileSync(`${__dirname}/monkey.png`).toString(encoding);\nconst uri = `data:${mime};${encoding},${base64Data}`;\nconsole.log(uri);\n\n// data URI \u8f6c\u6587\u4ef6\nconst fs = require('fs');\nconst uri = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgA...';\nconst base64Data = uri.split(',')[1];\nconst buf = Buffer(base64Data, 'base64');\nfs.writeFileSync(`${__dirname}/secondmonkey.png`, buf);\n")),(0,a.kt)("h1",{id:"events"},"events"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const EventEmitter = require('events').EventEmitter;\n\nconst AudioDevice = {\n  play: function (track) {\n    console.log('play', track);\n  },\n  stop: function () {\n    console.log('stop');\n  },\n};\n\nclass MusicPlayer extends EventEmitter {\n  constructor() {\n    super();\n    this.playing = false; \n  }\n}\n\nconst musicPlayer = new MusicPlayer();\nmusicPlayer.on('play', function (track) {\n  this.playing = true;\n  AudioDevice.play(track);\n});\nmusicPlayer.on('stop', function () {\n  this.playing = false;\n  AudioDevice.stop();\n});\n\nmusicPlayer.emit('play', 'The Roots - The Fire');\nsetTimeout(function () {\n  musicPlayer.emit('stop');\n}, 1000);\n\n// \u5904\u7406\u5f02\u5e38\n// EventEmitter \u5b9e\u4f8b\u53d1\u751f\u9519\u8bef\u4f1a\u53d1\u51fa\u4e00\u4e2a error \u4e8b\u4ef6\n// \u5982\u679c\u6ca1\u6709\u76d1\u542c\u5668\uff0c\u9ed8\u8ba4\u52a8\u4f5c\u662f\u6253\u5370\u4e00\u4e2a\u5806\u6808\u5e76\u9000\u51fa\u7a0b\u5e8f\nmusicPlayer.on('error', function (err) {\n  console.err('Error:', err);\n});\n")),(0,a.kt)("h1",{id:"util"},"util"),(0,a.kt)("h2",{id:"promisify"},"promisify"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const util = require('util');\nconst fs = require('fs');\nconst readAsync = util.promisify(fs.readFile);\n\nasync function init() {\n  try {\n    let data = await readAsync('./package.json');\n\n    data  =JSON.parse(data);\n\n    console.log(data.name);\n  } catch (err) {\n    console.log(err);\n  }\n}\n")),(0,a.kt)("h1",{id:"\u6d41"},"\u6d41"),(0,a.kt)("h2",{id:"\u7406\u89e3\u6d41"},"\u7406\u89e3\u6d41"),(0,a.kt)("p",null,"\u6d41\u662f\u57fa\u4e8e\u4e8b\u4ef6\u7684 API\uff0c\u7528\u4e8e\u7ba1\u7406\u548c\u5904\u7406\u6570\u636e\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6d41\u662f\u80fd\u591f\u8bfb\u5199\u7684"),(0,a.kt)("li",{parentName:"ul"},"\u662f\u57fa\u4e8e\u4e8b\u4ef6\u5b9e\u73b0\u7684\u4e00\u4e2a\u5b9e\u4f8b")),(0,a.kt)("p",null,"\u7406\u89e3\u6d41\u7684\u6700\u597d\u65b9\u5f0f\u5c31\u662f\u60f3\u8c61\u4e00\u4e0b\u6ca1\u6709\u6d41\u7684\u65f6\u5019\u600e\u4e48\u5904\u7406\u6570\u636e\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fs.readFileSync")," \u540c\u6b65\u8bfb\u53d6\u6587\u4ef6\uff0c\u7a0b\u5e8f\u4f1a\u963b\u585e\uff0c\u6240\u6709\u6570\u636e\u88ab\u8bfb\u5230\u5185\u5b58"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"fs.readFile")," \u963b\u6b62\u7a0b\u5e8f\u963b\u585e\uff0c\u4f46\u4ecd\u4f1a\u5c06\u6587\u4ef6\u6240\u6709\u6570\u636e\u8bfb\u53d6\u5230\u5185\u5b58\u4e2d"),(0,a.kt)("li",{parentName:"ul"},"\u5e0c\u671b\u5c11\u5185\u5b58\u8bfb\u53d6\u5927\u6587\u4ef6\uff0c\u8bfb\u53d6\u4e00\u4e2a\u6570\u636e\u5757\u5230\u5185\u5b58\u5904\u7406\u5b8c\u518d\u53bb\u7d22\u53d6\u66f4\u591a\u7684\u6570\u636e")),(0,a.kt)("h3",{id:"\u6d41\u7684\u7c7b\u578b"},"\u6d41\u7684\u7c7b\u578b"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5185\u7f6e\uff1a\u8bb8\u591a\u6838\u5fc3\u6a21\u5757\u90fd\u5b9e\u73b0\u4e86\u6d41\u63a5\u53e3\uff0c\u5982 ",(0,a.kt)("inlineCode",{parentName:"li"},"fs.createReadStream")),(0,a.kt)("li",{parentName:"ul"},"HTTP\uff1a\u5904\u7406\u7f51\u7edc\u6280\u672f\u7684\u6d41"),(0,a.kt)("li",{parentName:"ul"},"\u89e3\u91ca\u5668\uff1a\u7b2c\u4e09\u65b9\u6a21\u5757 XML\u3001JSON \u89e3\u91ca\u5668"),(0,a.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\uff1aNode \u6d41\u53ef\u4ee5\u88ab\u62d3\u5c55\u4f7f\u7528\u5728\u6d4f\u89c8\u5668"),(0,a.kt)("li",{parentName:"ul"},"Audio\uff1a\u6d41\u63a5\u53e3\u7684\u58f0\u97f3\u6a21\u5757"),(0,a.kt)("li",{parentName:"ul"},"RPC\uff08\u8fdc\u7a0b\u8c03\u7528\uff09\uff1a\u901a\u8fc7\u7f51\u7edc\u53d1\u9001\u6d41\u662f\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6709\u6548\u65b9\u5f0f"),(0,a.kt)("li",{parentName:"ul"},"\u6d4b\u8bd5\uff1a\u4f7f\u7528\u6d41\u7684\u6d4b\u8bd5\u5e93")),(0,a.kt)("h2",{id:"\u4f7f\u7528\u5185\u5efa\u6d41-api"},"\u4f7f\u7528\u5185\u5efa\u6d41 API"),(0,a.kt)("h3",{id:"\u9759\u6001-web-\u670d\u52a1\u5668"},"\u9759\u6001 web \u670d\u52a1\u5668"),(0,a.kt)("p",null,"\u60f3\u8981\u901a\u8fc7\u7f51\u7edc\u9ad8\u6548\u4e14\u652f\u6301\u5927\u6587\u4ef6\u7684\u53d1\u9001\u4e00\u4e2a\u6587\u4ef6\u5230\u4e00\u4e2a\u5ba2\u6237\u7aef\u3002"),(0,a.kt)("h4",{id:"\u4e0d\u4f7f\u7528\u6d41"},"\u4e0d\u4f7f\u7528\u6d41"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst fs = require('fs');\n\nhttp.createServer((req, res) => {\n  fs.readFile(`${__dirname}/index.html`, (err, data) => {\n    if (err) {\n      res.statusCode = 500;\n      res.end(String(err));\n      return;\n    }\n\n    res.end(data);\n  });\n}).listen(8000);\n")),(0,a.kt)("h4",{id:"\u4f7f\u7528\u6d41"},"\u4f7f\u7528\u6d41"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst fs = require('fs');\n\nhttp.createServer((req, res) => {\n  fs.createReadStream(`${__dirname}/index.html`).pipe(res);\n}).listen(8000);\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u66f4\u5c11\u4ee3\u7801\uff0c\u66f4\u52a0\u9ad8\u6548"),(0,a.kt)("li",{parentName:"ul"},"\u63d0\u4f9b\u4e00\u4e2a\u7f13\u51b2\u533a\u53d1\u9001\u5230\u5ba2\u6237\u7aef")),(0,a.kt)("h4",{id:"\u4f7f\u7528\u6d41--gzip"},"\u4f7f\u7528\u6d41 + gzip"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst fs = require('fs');\nconst zlib = require('zlib');\n\nhttp.createServer((req, res) => {\n  res.writeHead(200, {\n    'content-encoding': 'gzip',\n  });\n  fs.createReadStream(`${__dirname}/index.html`)\n    .pipe(zlib.createGzip())\n    .pipe(res);\n}).listen(8000);\n")),(0,a.kt)("h3",{id:"\u6d41\u7684\u9519\u8bef\u5904\u7406"},"\u6d41\u7684\u9519\u8bef\u5904\u7406"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst stream = fs.createReadStream('not-found');\n\nstream.on('error', (err) => {\n  console.trace();\n  console.error('Stack:', err.stack);\n  console.error('The error raised was:', err);\n});\n")),(0,a.kt)("h2",{id:"\u4f7f\u7528\u6d41\u57fa\u7c7b"},"\u4f7f\u7528\u6d41\u57fa\u7c7b"),(0,a.kt)("h3",{id:"\u53ef\u8bfb\u6d41---json-\u884c\u89e3\u6790\u5668"},"\u53ef\u8bfb\u6d41 - JSON \u884c\u89e3\u6790\u5668"),(0,a.kt)("p",null,"\u53ef\u8bfb\u6d41\u88ab\u7528\u6765\u4e3a I/O \u6e90\u63d0\u4f9b\u7075\u6d3b\u7684 API\uff0c\u4e5f\u53ef\u4ee5\u88ab\u7528\u4f5c\u89e3\u6790\u5668\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7ee7\u627f\u81ea steam.Readable \u7c7b"),(0,a.kt)("li",{parentName:"ul"},"\u5e76\u5b9e\u73b0\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"li"},"_read(size)")," \u65b9\u6cd5")),(0,a.kt)("p",null,"json-lines.txt"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{ "position": 0, "letter": "a" }\n{ "position": 1, "letter": "b" }\n{ "position": 2, "letter": "c" }\n{ "position": 3, "letter": "d" }\n{ "position": 4, "letter": "e" }\n{ "position": 5, "letter": "f" }\n{ "position": 6, "letter": "g" }\n{ "position": 7, "letter": "h" }\n{ "position": 8, "letter": "i" }\n{ "position": 9, "letter": "j" }\n')),(0,a.kt)("p",null,"JSONLineReader.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const stream = require('stream');\nconst fs = require('fs');\nconst util = require('util');\n\nclass JSONLineReader extends stream.Readable {\n  constructor(source) {\n    super();\n    this._source = source;\n    this._foundLineEnd = false;\n    this._buffer = '';\n\n    source.on('readable', () => {\n      this.read();\n    });\n  }\n\n  // \u6240\u6709\u5b9a\u5236 stream.Readable \u7c7b\u90fd\u9700\u8981\u5b9e\u73b0 _read \u65b9\u6cd5\n  _read(size) {\n    let chunk;\n    let line;\n    let result;\n\n    if (this._buffer.length === 0) {\n      chunk = this._source.read();\n      this._buffer += chunk;\n    }\n\n    const lineIndex = this._buffer.indexOf('\\n');\n\n    if (lineIndex !== -1) {\n      line = this._buffer.slice(0, lineIndex); // \u4ece buffer \u7684\u5f00\u59cb\u622a\u53d6\u7b2c\u4e00\u884c\u6765\u83b7\u53d6\u4e00\u4e9b\u6587\u672c\u8fdb\u884c\u89e3\u6790\n      if (line) {\n        result = JSON.parse(line);\n        this._buffer = this._buffer.slice(lineIndex + 1);\n        this.emit('object', result); // \u5f53\u4e00\u4e2a JSON \u8bb0\u5f55\u89e3\u6790\u51fa\u6765\u7684\u65f6\u5019\uff0c\u89e6\u53d1\u4e00\u4e2a object \u4e8b\u4ef6\n        this.push(util.inspect(result)); // \u5c06\u89e3\u6790\u597d\u7684 SJON \u53d1\u56de\u5185\u90e8\u961f\u5217\n      } else {\n        this._buffer = this._buffer.slice(1);\n      }\n    }\n  }\n}\n\nconst input = fs.createReadStream(`${__dirname}/json-lines.txt`, {\n  encoding: 'utf8',\n});\nconst jsonLineReader = new JSONLineReader(input); // \u521b\u5efa\u4e00\u4e2a JSONLineReader \u5b9e\u4f8b\uff0c\u4f20\u9012\u4e00\u4e2a\u6587\u4ef6\u6d41\u7ed9\u5b83\u5904\u7406\n\njsonLineReader.on('object', (obj) => {\n  console.log('pos:', obj.position, '- letter:', obj.letter);\n});\n")),(0,a.kt)("h3",{id:"\u53ef\u5199\u6d41---\u6587\u5b57\u53d8\u8272"},"\u53ef\u5199\u6d41 - \u6587\u5b57\u53d8\u8272"),(0,a.kt)("p",null,"\u53ef\u5199\u7684\u6d41\u53ef\u7528\u4e8e\u8f93\u51fa\u6570\u636e\u5230\u5e95\u5c42 I/O:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7ee7\u627f\u81ea ",(0,a.kt)("inlineCode",{parentName:"li"},"stream.Writable")),(0,a.kt)("li",{parentName:"ul"},"\u5b9e\u73b0\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"li"},"_write")," \u65b9\u6cd5\u5411\u5e95\u5c42\u6e90\u6570\u636e\u53d1\u9001\u6570\u636e")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"cat json-lines.txt | node stram_writable.js\n")),(0,a.kt)("p",null,"stram_writable.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const stream = require('stream');\n\nclass GreenStream extends stream.Writable {\n  constructor(options) {\n    super(options);\n  }\n\n  _write(chunk, encoding, cb) {\n    process.stdout.write(`\\u001b[32m${chunk}\\u001b[39m`);\n    cb();\n  }\n}\n\nprocess.stdin.pipe(new GreenStream());\n")),(0,a.kt)("h3",{id:"\u53cc\u5de5\u6d41---\u63a5\u53d7\u548c\u8f6c\u6362\u6570\u636e"},"\u53cc\u5de5\u6d41 - \u63a5\u53d7\u548c\u8f6c\u6362\u6570\u636e"),(0,a.kt)("p",null,"\u53cc\u5de5\u6d41\u5141\u8bb8\u53d1\u9001\u548c\u63a5\u53d7\u6570\u636e\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7ee7\u627f\u81ea ",(0,a.kt)("inlineCode",{parentName:"li"},"stream.Duplex")),(0,a.kt)("li",{parentName:"ul"},"\u5b9e\u73b0 ",(0,a.kt)("inlineCode",{parentName:"li"},"_read")," \u548c ",(0,a.kt)("inlineCode",{parentName:"li"},"_write")," \u65b9\u6cd5")),(0,a.kt)("h3",{id:"\u8f6c\u6362\u6d41---\u89e3\u6790\u6570\u636e"},"\u8f6c\u6362\u6d41 - \u89e3\u6790\u6570\u636e"),(0,a.kt)("p",null,"\u4f7f\u7528\u6d41\u6539\u53d8\u6570\u636e\u4e3a\u53e6\u4e00\u79cd\u683c\u5f0f\uff0c\u5e76\u4e14\u9ad8\u6548\u5730\u7ba1\u7406\u5185\u5b58\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7ee7\u627f\u81ea ",(0,a.kt)("inlineCode",{parentName:"li"},"stream.Transform")),(0,a.kt)("li",{parentName:"ul"},"\u5b9e\u73b0 ",(0,a.kt)("inlineCode",{parentName:"li"},"_transform")," \u65b9\u6cd5")),(0,a.kt)("h2",{id:"\u6d4b\u8bd5\u6d41"},"\u6d4b\u8bd5\u6d41"),(0,a.kt)("p",null,"\u4f7f\u7528 Node \u5185\u7f6e\u7684\u65ad\u8a00\u6a21\u5757\u6d4b\u8bd5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const assert = require('assert');\nconst fs = require('fs');\nconst CSVParser = require('./csvparser');\n\nconst parser = new CSVParser();\nconst actual = [];\n\nfs.createReadStream(`${__dirname}/sample.csv`)\n  .pipe(parser);\n\nprocess.on('exit', function () {\n  actual.push(parser.read());\n  actual.push(parser.read());\n  actual.push(parser.read());\n\n  const expected = [\n    { name: 'Alex', location: 'UK', role: 'admin' },\n    { name: 'Sam', location: 'France', role: 'user' },\n    { name: 'John', location: 'Canada', role: 'user' },\n  ];\n\n  assert.deepEqual(expected, actual);\n});\n")),(0,a.kt)("h1",{id:"\u6587\u4ef6\u7cfb\u7edf"},"\u6587\u4ef6\u7cfb\u7edf"),(0,a.kt)("h2",{id:"fs-\u6a21\u5757\u4ea4\u4e92"},"fs \u6a21\u5757\u4ea4\u4e92"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"POSIX \u6587\u4ef6 I/O"),(0,a.kt)("li",{parentName:"ul"},"\u6587\u4ef6\u6d41"),(0,a.kt)("li",{parentName:"ul"},"\u6279\u91cf\u6587\u4ef6 I/O"),(0,a.kt)("li",{parentName:"ul"},"\u6587\u4ef6\u76d1\u63a7")),(0,a.kt)("h2",{id:"posix-\u6587\u4ef6\u7cfb\u7edf"},"POSIX \u6587\u4ef6\u7cfb\u7edf"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:"left"},"fs \u65b9\u6cd5"),(0,a.kt)("th",{parentName:"tr",align:"left"},"\u63cf\u8ff0"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.truncate"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u622a\u65ad\u6216\u8005\u62d3\u5c55\u6587\u4ef6\u5230\u5236\u5b9a\u7684\u957f\u5ea6")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.ftruncate"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u548c truncate \u4e00\u6837\uff0c\u4f46\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f5c\u4e3a\u53c2\u6570")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.chown"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u6539\u53d8\u6587\u4ef6\u7684\u6240\u6709\u8005\u4ee5\u53ca\u7ec4")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.fchown"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u548c chown \u4e00\u6837\uff0c\u4f46\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f5c\u4e3a\u53c2\u6570")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.lchown"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u548c chown \u4e00\u6837\uff0c\u4f46\u4e0d\u89e3\u6790\u7b26\u53f7\u94fe\u63a5")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.stat"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u83b7\u53d6\u6587\u4ef6\u72b6\u6001")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.lstat"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u548c stat \u4e00\u6837\uff0c\u4f46\u662f\u8fd4\u56de\u4fe1\u606f\u662f\u5173\u4e8e\u7b26\u53f7\u94fe\u63a5\u800c\u4e0d\u662f\u5b83\u6307\u5411\u7684\u5185\u5bb9")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.fstat"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u548c stat \u4e00\u6837\uff0c\u4f46\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f5c\u4e3a\u53c2\u6570")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.link"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u521b\u5efa\u4e00\u4e2a\u786c\u94fe\u63a5")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.symlink"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u521b\u5efa\u4e00\u4e2a\u8f6f\u8fde\u63a5")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.readlink"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u8bfb\u53d6\u4e00\u4e2a\u8f6f\u8fde\u63a5\u7684\u503c")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.realpath"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u8fd4\u56de\u89c4\u8303\u7684\u7edd\u5bf9\u8def\u5f84\u540d")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.unlink"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u5220\u9664\u6587\u4ef6")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.rmdir"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u5220\u9664\u6587\u4ef6\u76ee\u5f55")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.mkdir"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u521b\u5efa\u6587\u4ef6\u76ee\u5f55")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.readdir"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u8bfb\u53d6\u4e00\u4e2a\u6587\u4ef6\u76ee\u5f55\u7684\u5185\u5bb9")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.close"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u5173\u95ed\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.open"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u6253\u5f00\u6216\u8005\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u7528\u6765\u8bfb\u53d6\u6216\u8005\u5199\u5165")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.utimes"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u8bbe\u7f6e\u6587\u4ef6\u7684\u8bfb\u53d6\u548c\u4fee\u6539\u65f6\u95f4")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.futimes"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u548c utimes \u4e00\u6837\uff0c\u4f46\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f5c\u4e3a\u53c2\u6570")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.fsync"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u540c\u6b65\u78c1\u76d8\u4e2d\u7684\u6587\u4ef6\u6570\u636e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.write"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u5199\u5165\u6570\u636e\u5230\u4e00\u4e2a\u6587\u4ef6")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:"left"},"fs.read"),(0,a.kt)("td",{parentName:"tr",align:"left"},"\u8bfb\u53d6\u4e00\u4e2a\u6587\u4ef6\u7684\u6570\u636e")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst assert = require('assert');\n\nconst fd = fs.openSync('./file.txt', 'w+');\nconst writeBuf = new Buffer('some data to write');\nfs.writeSync(fd, writeBuf, 0, writeBuf.length, 0);\n\nconst readBuf = new Buffer(writeBuf.length);\nfs.readSync(fd, readBuf, 0, writeBuf.length, 0);\nassert.equal(writeBuf.toString(), readBuf.toString());\n\nfs.closeSync(fd);\n")),(0,a.kt)("h2",{id:"\u8bfb\u5199\u6d41"},"\u8bfb\u5199\u6d41"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst readable = fs.createReadStream('./original.txt');\nconst writeable = fs.createWriteStream('./copy.txt');\nreadable.pipe(writeable);\n")),(0,a.kt)("h2",{id:"\u6587\u4ef6\u76d1\u63a7"},"\u6587\u4ef6\u76d1\u63a7"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"fs.watchFile")," \u6bd4 ",(0,a.kt)("inlineCode",{parentName:"p"},"fs.watch")," \u4f4e\u6548\uff0c\u4f46\u66f4\u597d\u7528\u3002"),(0,a.kt)("h2",{id:"\u540c\u6b65\u8bfb\u53d6\u4e0e-require"},"\u540c\u6b65\u8bfb\u53d6\u4e0e require"),(0,a.kt)("p",null,"\u540c\u6b65 fs \u7684\u65b9\u6cd5\u5e94\u8be5\u5728\u7b2c\u4e00\u6b21\u521d\u59cb\u5316\u5e94\u7528\u7684\u65f6\u5019\u4f7f\u7528\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst config = JSON.parse(fs.readFileSync('./config.json').toString());\ninit(config);\n")),(0,a.kt)("p",null,"require\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const config = require('./config.json);\ninit(config);\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6a21\u5757\u4f1a\u88ab\u5168\u5c40\u7f13\u51b2\uff0c\u5176\u4ed6\u6587\u4ef6\u4e5f\u52a0\u8f7d\u5e76\u4fee\u6539\uff0c\u4f1a\u5f71\u54cd\u5230\u6574\u4e2a\u7cfb\u7edf\u52a0\u8f7d\u4e86\u6b64\u6587\u4ef6\u7684\u6a21\u5757"),(0,a.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"Object.freeze")," \u6765\u51bb\u7ed3\u4e00\u4e2a\u5bf9\u8c61")),(0,a.kt)("h2",{id:"\u6587\u4ef6\u63cf\u8ff0"},"\u6587\u4ef6\u63cf\u8ff0"),(0,a.kt)("p",null,"\u6587\u4ef6\u63cf\u8ff0\u662f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7ba1\u7406\u7684\u5728\u8fdb\u7a0b\u4e2d\u6253\u5f00\u6587\u4ef6\u6240\u5173\u8054\u7684\u4e00\u4e9b\u6570\u5b57\u6216\u8005\u7d22\u5f15\u3002\u64cd\u4f5c\u7cfb\u7edf\u901a\u8fc7\u6307\u6d3e\u4e00\u4e2a\u552f\u4e00\u7684\u6574\u6570\u7ed9\u6bcf\u4e2a\u6253\u5f00\u7684\u6587\u4ef6\u7528\u6765\u67e5\u770b\u5173\u4e8e\u8fd9\u4e2a\u6587\u4ef6"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Stream"),(0,a.kt)("th",{parentName:"tr",align:null},"\u6587\u4ef6\u63cf\u8ff0"),(0,a.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"stdin"),(0,a.kt)("td",{parentName:"tr",align:null},"0"),(0,a.kt)("td",{parentName:"tr",align:null},"\u6807\u51c6\u8f93\u5165")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"stdout"),(0,a.kt)("td",{parentName:"tr",align:null},"1"),(0,a.kt)("td",{parentName:"tr",align:null},"\u6807\u51c6\u8f93\u51fa")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"stderr"),(0,a.kt)("td",{parentName:"tr",align:null},"2"),(0,a.kt)("td",{parentName:"tr",align:null},"\u6807\u51c6\u9519\u8bef")))),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"console.log('Log')")," \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"process.stdout.write('log')")," \u7684\u8bed\u6cd5\u7cd6\u3002"),(0,a.kt)("p",null,"\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u662f open \u4ee5\u53ca openSync \u65b9\u6cd5\u8c03\u7528\u8fd4\u56de\u7684\u4e00\u4e2a\u6570\u5b57"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fd = fs.openSync('myfile', 'a');\nconsole.log(typeof fd === 'number'); // true\n")),(0,a.kt)("h2",{id:"\u6587\u4ef6\u9501"},"\u6587\u4ef6\u9501"),(0,a.kt)("p",null,"\u534f\u540c\u591a\u4e2a\u8fdb\u7a0b\u540c\u65f6\u8bbf\u95ee\u4e00\u4e2a\u6587\u4ef6\uff0c\u4fdd\u8bc1\u6587\u4ef6\u7684\u5b8c\u6574\u6027\u4ee5\u53ca\u6570\u636e\u4e0d\u80fd\u4e22\u5931\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5f3a\u5236\u9501\uff08\u5728\u5185\u6838\u7ea7\u522b\u6267\u884c\uff09"),(0,a.kt)("li",{parentName:"ul"},"\u54a8\u8be2\u9501\uff08\u975e\u5f3a\u5236\uff0c\u53ea\u5728\u6d89\u53ca\u5230\u8fdb\u7a0b\u8ba2\u9605\u4e86\u76f8\u540c\u7684\u9501\u673a\u5236\uff09",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"node-fs-ext")," \u901a\u8fc7 ",(0,a.kt)("inlineCode",{parentName:"li"},"flock")," \u9501\u4f4f\u4e00\u4e2a\u6587\u4ef6"))),(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u9501\u6587\u4ef6",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b A \u5c1d\u8bd5\u521b\u5efa\u4e00\u4e2a\u9501\u6587\u4ef6\uff0c\u5e76\u4e14\u6210\u529f\u4e86"),(0,a.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b A \u5df2\u7ecf\u83b7\u5f97\u4e86\u8fd9\u4e2a\u9501\uff0c\u53ef\u4ee5\u4fee\u6539\u5171\u4eab\u7684\u8d44\u6e90"),(0,a.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b B \u5c1d\u8bd5\u521b\u5efa\u4e00\u4e2a\u9501\u6587\u4ef6\uff0c\u4f46\u5931\u8d25\u4e86\uff0c\u65e0\u6cd5\u4fee\u6539\u5171\u4eab\u7684\u8d44\u6e90")))),(0,a.kt)("p",null,"Node \u5b9e\u73b0\u9501\u6587\u4ef6"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u72ec\u5360\u6807\u8bb0\u521b\u5efa\u9501\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528 mkdir \u521b\u5efa\u9501\u6587\u4ef6")),(0,a.kt)("h3",{id:"\u72ec\u5360\u6807\u8bb0"},"\u72ec\u5360\u6807\u8bb0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u6240\u6709\u9700\u8981\u6253\u5f00\u6587\u4ef6\u7684\u65b9\u6cd5\uff0cfs.writeFile\u3001fs.createWriteStream\u3001fs.open \u90fd\u6709\u4e00\u4e2a x \u6807\u8bb0\n// \u8fd9\u4e2a\u6587\u4ef6\u5e94\u8be5\u5df2\u72ec\u5360\u6253\u5f00\uff0c\u82e5\u8fd9\u4e2a\u6587\u4ef6\u5b58\u5728\uff0c\u6587\u4ef6\u4e0d\u80fd\u88ab\u6253\u5f00\nfs.open('config.lock', 'wx', (err) => {\n  if (err) { return console.err(err); }\n});\n\n// \u6700\u597d\u5c06\u5f53\u524d\u8fdb\u7a0b\u53f7\u5199\u8fdb\u6587\u4ef6\u9501\u4e2d\n// \u5f53\u6709\u5f02\u5e38\u7684\u65f6\u5019\u5c31\u77e5\u9053\u6700\u540e\u8fd9\u4e2a\u9501\u7684\u8fdb\u7a0b\nfs.writeFile(\n  'config.lock',\n  process.pid,\n  { flogs: 'wx' },\n  (err) => {\n    if (err) { return console.error(err) };\n  },\n);\n")),(0,a.kt)("h3",{id:"mkdir-\u6587\u4ef6\u9501"},"mkdir \u6587\u4ef6\u9501"),(0,a.kt)("p",null,"\u72ec\u5360\u6807\u8bb0\u6709\u4e2a\u95ee\u9898\uff0c\u53ef\u80fd\u6709\u4e9b\u7cfb\u7edf\u4e0d\u80fd\u8bc6\u522b ",(0,a.kt)("inlineCode",{parentName:"p"},"0_EXCL")," \u6807\u8bb0\u3002\u53e6\u4e00\u4e2a\u65b9\u6848\u662f\u628a\u9501\u6587\u4ef6\u6362\u6210\u4e00\u4e2a\u76ee\u5f55\uff0cPID \u53ef\u4ee5\u5199\u5165\u76ee\u5f55\u4e2d\u7684\u4e00\u4e2a\u6587\u4ef6\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"fs.mkidr('config.lock', (err) => {\n  if (err) { return console.error(err); }\n  fs.writeFile(`/config.lock/${process.pid}`, (err) => {\n    if (err) { return console.error(err); }\n  });\n});\n")),(0,a.kt)("h3",{id:"lock-\u6a21\u5757\u5b9e\u73b0"},"lock \u6a21\u5757\u5b9e\u73b0"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/npm/lockfile"},"https://github.com/npm/lockfile")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst lockDir = 'config.lock';\nlet hasLock = false;\n\nexports.lock = function (cb) { // \u83b7\u53d6\u9501\n  if (hasLock) { return cb(); } // \u5df2\u7ecf\u83b7\u53d6\u4e86\u4e00\u4e2a\u9501\n  fs.mkdir(lockDir, function (err) {\n    if (err) { return cb(err); } // \u65e0\u6cd5\u521b\u5efa\u9501\n\n    fs.writeFile(lockDir + '/' + process.pid, function (err) { // \u628a PID\u5199\u5165\u5230\u76ee\u5f55\u4e2d\u4ee5\u4fbf\u8c03\u8bd5\n      if (err) { console.error(err); } // \u65e0\u6cd5\u5199\u5165 PID\uff0c\u7ee7\u7eed\u8fd0\u884c\n      hasLock = true; // \u9501\u521b\u5efa\u4e86\n      return cb();\n    });\n  });\n};\n\nexports.unlock = function (cb) { // \u89e3\u9501\u65b9\u6cd5\n  if (!hasLock) { return cb(); } // \u5982\u679c\u6ca1\u6709\u9700\u8981\u89e3\u5f00\u7684\u9501\n  fs.unlink(lockDir + '/' + process.pid, function (err) {\n    if (err) { return cb(err); }\n\n    fs.rmdir(lockDir, function (err) {\n      if (err) return cb(err);\n      hasLock = false;\n      cb();\n    });\n  });\n};\n\nprocess.on('exit', function () {\n  if (hasLock) {\n    fs.unlinkSync(lockDir + '/' + process.pid); // \u5982\u679c\u8fd8\u6709\u9501\uff0c\u5728\u9000\u51fa\u4e4b\u524d\u540c\u6b65\u5220\u9664\u6389\n    fs.rmdirSync(lockDir);\n    console.log('removed lock');\n  }\n});\n")),(0,a.kt)("h2",{id:"\u9012\u5f52\u6587\u4ef6\u64cd\u4f5c"},"\u9012\u5f52\u6587\u4ef6\u64cd\u4f5c"),(0,a.kt)("p",null,"\u4e00\u4e2a\u7ebf\u4e0a\u5e93\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://github.com/substack/node-mkdirp"},"mkdirp")),(0,a.kt)("p",null,"\u9012\u5f52\uff1a\u8981\u89e3\u51b3\u6211\u4eec\u7684\u95ee\u9898\u5c31\u8981\u5148\u89e3\u51b3\u66f4\u5c0f\u7684\u76f8\u540c\u7684\u95ee\u9898\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"dir-a\n\u251c\u2500\u2500 dir-b\n\u2502   \u251c\u2500\u2500 dir-c\n\u2502   \u2502   \u251c\u2500\u2500 dir-d\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 file-e.png\n\u2502   \u2502   \u2514\u2500\u2500 file-e.png\n\u2502   \u251c\u2500\u2500 file-c.js\n\u2502   \u2514\u2500\u2500 file-d.txt\n\u251c\u2500\u2500 file-a.js\n\u2514\u2500\u2500 file-b.txt\n")),(0,a.kt)("p",null,"\u67e5\u627e\u6a21\u5757\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},'find /asset/dir-a -name="file.*"')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"[\n  'dir-a/dir-b/dir-c/dir-d/file-e.png',\n  'dir-a/dir-b/dir-c/file-e.png',\n  'dir-a/dir-b/file-c.js',\n  'dir-a/dir-b/file-d.txt',\n  'dir-a/file-a.js',\n  'dir-a/file-b.txt',\n]\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst join = require('path').join;\n\n// \u540c\u6b65\u67e5\u627e\nexports.findSync = function (nameRe, startPath) {\n  const results = [];\n\n  function finder(path) {\n    const files = fs.readdirSync(path);\n\n    for (let i = 0; i < files.length; i++) {\n      const fpath = join(path, files[i]);\n      const stats = fs.statSync(fpath);\n\n      if (stats.isDirectory()) { finder(fpath); }\n\n      if (stats.isFile() && nameRe.test(files[i])) {\n        results.push(fpath);\n      }\n    }\n  }\n\n  finder(startPath);\n  return results;\n};\n\n// \u5f02\u6b65\u67e5\u627e\nexports.find = function (nameRe, startPath, cb) { // cb \u53ef\u4ee5\u4f20\u5165 console.log\uff0c\u7075\u6d3b\n  const results = [];\n  let asyncOps = 0; // 2\n\n  function finder(path) {\n    asyncOps++;\n    fs.readdir(path, function (er, files) {\n      if (er) { return cb(er); }\n\n      files.forEach(function (file) {\n        const fpath = join(path, file);\n\n        asyncOps++;\n        fs.stat(fpath, function (er, stats) {\n          if (er) { return cb(er); }\n\n          if (stats.isDirectory()) finder(fpath);\n\n          if (stats.isFile() && nameRe.test(file)) {\n            results.push(fpath);\n          }\n\n          asyncOps--;\n          if (asyncOps == 0) {\n            cb(null, results);\n          }\n        });\n      });\n\n      asyncOps--;\n      if (asyncOps == 0) {\n        cb(null, results);\n      }\n    });\n  }\n\n  finder(startPath);\n};\n\nconsole.log(exports.findSync(/file.*/, `${__dirname}/dir-a`));\nconsole.log(exports.find(/file.*/, `${__dirname}/dir-a`, console.log));\n")),(0,a.kt)("h2",{id:"\u76d1\u89c6\u6587\u4ef6\u548c\u6587\u4ef6\u5939"},"\u76d1\u89c6\u6587\u4ef6\u548c\u6587\u4ef6\u5939"),(0,a.kt)("p",null,"\u60f3\u8981\u76d1\u542c\u4e00\u4e2a\u6587\u4ef6\u6216\u8005\u76ee\u5f55\uff0c\u5e76\u5728\u6587\u4ef6\u66f4\u6539\u540e\u6267\u884c\u4e00\u4e2a\u52a8\u4f5c\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nfs.watch('./watchdir', console.log); // \u7a33\u5b9a\u4e14\u5feb\nfs.watchFile('./watchdir', console.log); // \u8de8\u5e73\u53f0\n")),(0,a.kt)("h2",{id:"\u9010\u884c\u5730\u8bfb\u53d6\u6587\u4ef6\u6d41"},"\u9010\u884c\u5730\u8bfb\u53d6\u6587\u4ef6\u6d41"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst readline = require('readline');\n\nconst rl = readline.createInterface({\n  input: fs.createReadStream('/etc/hosts'),\n  crlfDelay: Infinity\n});\n\nrl.on('line', (line) => {\n  console.log(`cc ${line}`);\n  const extract = line.match(/(\\d+\\.\\d+\\.\\d+\\.\\d+) (.*)/);\n});\n")),(0,a.kt)("h1",{id:"\u7f51\u7edc"},"\u7f51\u7edc"),(0,a.kt)("h2",{id:"\u83b7\u53d6\u672c\u5730-ip"},"\u83b7\u53d6\u672c\u5730 IP"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function get_local_ip() {\n  const interfaces = require('os').networkInterfaces();\n  let IPAdress = '';\n  for (const devName in interfaces) {\n    const iface = interfaces[devName];\n    for (let i = 0; i < iface.length; i++) {\n      const alias = iface[i];\n      if (alias.family === 'IPv4' && alias.address !== '127.0.0.1' && !alias.internal) {\n        IPAdress = alias.address;\n      }\n    }\n  }\n  return IPAdress;\n}\n")),(0,a.kt)("h2",{id:"tcp-\u5ba2\u6237\u7aef"},"TCP \u5ba2\u6237\u7aef"),(0,a.kt)("p",null,"NodeJS \u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"net")," \u6a21\u5757\u521b\u5efa TCP \u8fde\u63a5\u548c\u670d\u52a1\u3002"),(0,a.kt)("h3",{id:"\u542f\u52a8\u4e0e\u6d4b\u8bd5-tcp"},"\u542f\u52a8\u4e0e\u6d4b\u8bd5 TCP"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const assert = require('assert');\nconst net = require('net');\nlet clients = 0;\nlet expectedAssertions = 2;\n\nconst server = net.createServer(function (client) {\n  clients++;\n  const clientId = clients;\n  console.log('Client connected:', clientId);\n\n  client.on('end', function () {\n    console.log('Client disconnected:', clientId);\n  });\n\n  client.write('Welcome client: ' + clientId);\n  client.pipe(client);\n});\n\nserver.listen(8000, function () {\n  console.log('Server started on port 8000');\n\n  runTest(1, function () {\n    runTest(2, function () {\n      console.log('Tests finished');\n      assert.equal(0, expectedAssertions);\n      server.close();\n    });\n  });\n});\n\nfunction runTest(expectedId, done) {\n  const client = net.connect(8000);\n\n  client.on('data', function (data) {\n    const expected = 'Welcome client: ' + expectedId;\n    assert.equal(data.toString(), expected);\n    expectedAssertions--;\n    client.end();\n  });\n\n  client.on('end', done);\n}\n")),(0,a.kt)("h2",{id:"udp-\u5ba2\u6237\u7aef"},"UDP \u5ba2\u6237\u7aef"),(0,a.kt)("p",null,"\u5229\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"dgram")," \u6a21\u5757\u521b\u5efa\u6570\u636e\u62a5 ",(0,a.kt)("inlineCode",{parentName:"p"},"socket"),"\uff0c\u7136\u540e\u5229\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"socket.send")," \u53d1\u9001\u6570\u636e\u3002"),(0,a.kt)("h3",{id:"\u6587\u4ef6\u53d1\u9001\u670d\u52a1"},"\u6587\u4ef6\u53d1\u9001\u670d\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const dgram = require('dgram');\nconst fs = require('fs');\nconst port = 41230;\nconst defaultSize = 16;\n\nfunction Client(remoteIP) {\n  const inStream = fs.createReadStream(__filename); // \u4ece\u5f53\u524d\u6587\u4ef6\u521b\u5efa\u53ef\u8bfb\u6d41\n  const socket = dgram.createSocket('udp4'); // \u521b\u5efa\u65b0\u7684\u6570\u636e\u6d41 socket \u4f5c\u4e3a\u5ba2\u6237\u7aef\n\n  inStream.on('readable', function () {\n    sendData(); // \u5f53\u53ef\u8bfb\u6d41\u51c6\u5907\u597d\uff0c\u5f00\u59cb\u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668\n  });\n\n  function sendData() {\n    const message = inStream.read(defaultSize); // \u8bfb\u53d6\u6570\u636e\u5757\n\n    if (!message) {\n      return socket.unref(); // \u5ba2\u6237\u7aef\u5b8c\u6210\u4efb\u52a1\u540e\uff0c\u4f7f\u7528 unref \u5b89\u5168\u5173\u95ed\u5b83\n    }\n\n    // \u53d1\u9001\u6570\u636e\u5230\u670d\u52a1\u5668\n    socket.send(message, 0, message.length, port, remoteIP, function () {\n        sendData();\n      }\n    );\n  }\n}\n\nfunction Server() {\n  const socket = dgram.createSocket('udp4'); // \u521b\u5efa\u4e00\u4e2a socket \u63d0\u4f9b\u670d\u52a1\n\n  socket.on('message', function (msg) {\n    process.stdout.write(msg.toString());\n  });\n\n  socket.on('listening', function () {\n    console.log('Server ready:', socket.address());\n  });\n\n  socket.bind(port);\n}\n\nif (process.argv[2] === 'client') { // \u6839\u636e\u547d\u4ee4\u884c\u9009\u9879\u786e\u5b9a\u8fd0\u884c\u5ba2\u6237\u7aef\u8fd8\u662f\u670d\u52a1\u7aef\n  new Client(process.argv[3]);\n} else {\n  new Server();\n}\n")),(0,a.kt)("h2",{id:"http-\u5ba2\u6237\u7aef"},"HTTP \u5ba2\u6237\u7aef"),(0,a.kt)("p",null,"\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"http.createServer")," \u548c ",(0,a.kt)("inlineCode",{parentName:"p"},"http.createClient")," \u8fd0\u884c HTTP \u670d\u52a1\u3002"),(0,a.kt)("h3",{id:"\u542f\u52a8\u4e0e\u6d4b\u8bd5-http"},"\u542f\u52a8\u4e0e\u6d4b\u8bd5 HTTP"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const assert = require('assert');\nconst http = require('http');\n\nconst server = http.createServer(function(req, res) {\n  res.writeHead(200, { 'Content-Type': 'text/plain' }); // \u5199\u5165\u57fa\u4e8e\u6587\u672c\u7684\u54cd\u5e94\u5934\n  res.write('Hello, world.'); // \u53d1\u9001\u6d88\u606f\u56de\u5ba2\u6237\u7aef\n  res.end();\n});\n\nserver.listen(8000, function() {\n  console.log('Listening on port 8000');\n});\n\nconst req = http.request({ port: 8000}, function(res) { // \u521b\u5efa\u8bf7\u6c42\n  console.log('HTTP headers:', res.headers);\n  res.on('data', function(data) { // \u7ed9 data \u4e8b\u4ef6\u521b\u5efa\u76d1\u542c\uff0c\u786e\u4fdd\u548c\u671f\u671b\u503c\u4e00\u81f4\n    console.log('Body:', data.toString());\n    assert.equal('Hello, world.', data.toString());\n    assert.equal(200, res.statusCode);\n    server.unref();\n    console.log('\u6d4b\u8bd5\u5b8c\u6210');\n  });\n});\n\nreq.end();\n")),(0,a.kt)("h3",{id:"\u91cd\u5b9a\u5411"},"\u91cd\u5b9a\u5411"),(0,a.kt)("p",null,"HTTP \u6807\u51c6\u5b9a\u4e49\u4e86\u6807\u8bc6\u91cd\u5b9a\u5411\u53d1\u751f\u65f6\u7684\u72b6\u6001\u7801\uff0c\u5b83\u4e5f\u6307\u51fa\u4e86\u5ba2\u6237\u7aef\u5e94\u8be5\u68c0\u67e5\u65e0\u9650\u5faa\u73af\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"300\uff1a\u591a\u91cd\u9009\u62e9"),(0,a.kt)("li",{parentName:"ul"},"301\uff1a\u6c38\u4e45\u79fb\u52a8\u5230\u65b0\u4f4d\u7f6e"),(0,a.kt)("li",{parentName:"ul"},"302\uff1a\u627e\u5230\u91cd\u5b9a\u5411\u8df3\u8f6c"),(0,a.kt)("li",{parentName:"ul"},"303\uff1a\u53c2\u89c1\u5176\u4ed6\u4fe1\u606f"),(0,a.kt)("li",{parentName:"ul"},"304\uff1a\u6ca1\u6709\u6539\u52a8"),(0,a.kt)("li",{parentName:"ul"},"305\uff1a\u4f7f\u7528\u4ee3\u7406"),(0,a.kt)("li",{parentName:"ul"},"307\uff1a\u4e34\u65f6\u91cd\u5b9a\u5411")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst https = require('https');\nconst url = require('url'); // \u6709\u5f88\u591a\u63a5\u7eed URLs \u7684\u65b9\u6cd5\n\n// \u6784\u9020\u51fd\u6570\u88ab\u7528\u6765\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u6765\u6784\u6210\u8bf7\u6c42\u5bf9\u8c61\u7684\u58f0\u660e\u5468\u671f\nfunction Request() {\n  this.maxRedirects = 10;\n  this.redirects = 0;\n}\n\nRequest.prototype.get = function(href, callback) {\n  const uri = url.parse(href); // \u89e3\u6790 URLs \u6210\u4e3a Node http \u6a21\u5757\u4f7f\u7528\u7684\u683c\u5f0f\uff0c\u786e\u5b9a\u662f\u5426\u4f7f\u7528 HTTPS\n  const options = { host: uri.host, path: uri.path };\n  const httpGet = uri.protocol === 'http:' ? http.get : https.get;\n\n  console.log('GET:', href);\n\n  function processResponse(response) {\n    if (response.statusCode >= 300 && response.statusCode < 400) { // \u68c0\u67e5\u72b6\u6001\u7801\u662f\u5426\u5728 HTTP \u91cd\u5b9a\u5411\u8303\u56f4\n      if (this.redirects >= this.maxRedirects) {\n        this.error = new Error('Too many redirects for: ' + href);\n      } else {\n        this.redirects++; // \u91cd\u5b9a\u5411\u8ba1\u6570\u81ea\u589e\n        href = url.resolve(options.host, response.headers.location); // \u4f7f\u7528 url.resolve \u786e\u4fdd\u76f8\u5bf9\u8def\u5f84\u7684 URLs \u8f6c\u6362\u4e3a\u7edd\u5bf9\u8def\u5f84 URLs\n        return this.get(href, callback);\n      }\n    }\n\n    response.url = href;\n    response.redirects = this.redirects;\n\n    console.log('Redirected:', href);\n\n    function end() {\n      console.log('Connection ended');\n      callback(this.error, response);\n    }\n\n    response.on('data', function(data) {\n      console.log('Got data, length:', data.length);\n    });\n\n    response.on('end', end.bind(this)); // \u7ed1\u5b9a\u56de\u8c03\u5230 Request \u5b9e\u4f8b\uff0c\u786e\u4fdd\u80fd\u62ff\u5230\u5b9e\u4f8b\u5c5e\u6027\n  }\n\n  httpGet(options, processResponse.bind(this))\n    .on('error', function(err) {\n      callback(err);\n    });\n};\n\nconst request = new Request();\nrequest.get('http://google.com/', function(err, res) {\n  if (err) {\n    console.error(err);\n  } else {\n    console.log(`\n      Fetched URL: ${res.url} with ${res.redirects} redirects\n    `);\n    process.exit();\n  }\n});\n")),(0,a.kt)("h3",{id:"http-\u4ee3\u7406"},"HTTP \u4ee3\u7406"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"ISP \u4f7f\u7528\u900f\u660e\u4ee3\u7406\u4f7f\u7f51\u7edc\u66f4\u52a0\u9ad8\u6548"),(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u7f13\u5b58\u4ee3\u7406\u670d\u52a1\u5668\u51cf\u5c11\u5bbd\u5e26"),(0,a.kt)("li",{parentName:"ul"},"Web \u5e94\u7528\u7a0b\u5e8f\u7684 DevOps \u5229\u7528\u4ed6\u4eec\u63d0\u5347\u5e94\u7528\u7a0b\u5e8f\u6027\u80fd")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const http = require('http');\nconst url = require('url');\n\nhttp.createServer(function(req, res) {\n  console.log('start request:', req.url);\n  const options = url.parse(req.url);\n  console.log(options);\n  options.headers = req.headers;\n  const proxyRequest = http.request(options, function(proxyResponse) { // \u521b\u5efa\u8bf7\u6c42\u6765\u590d\u5236\u539f\u59cb\u7684\u8bf7\u6c42\n    proxyResponse.on('data', function(chunk) { // \u76d1\u542c\u6570\u636e\uff0c\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668\n      console.log('proxyResponse length:', chunk.length);\n      res.write(chunk, 'binary');\n    });\n\n    proxyResponse.on('end', function() { // \u8ffd\u8e2a\u4ee3\u7406\u8bf7\u6c42\u5b8c\u6210\n      console.log('proxied request ended');\n      res.end();\n    });\n\n    res.writeHead(proxyResponse.statusCode, proxyResponse.headers); // \u53d1\u9001\u5934\u90e8\u4fe1\u606f\u7ed9\u670d\u52a1\u5668\n  });\n\n  req.on('data', function(chunk) { // \u6355\u83b7\u4ece\u6d4f\u89c8\u5668\u53d1\u9001\u5230\u670d\u52a1\u5668\u7684\u6570\u636e\n    console.log('in request length:', chunk.length);\n    proxyRequest.write(chunk, 'binary');\n  });\n\n  req.on('end', function() { // \u8ffd\u8e2a\u539f\u59cb\u7684\u8bf7\u6c42\u4ec0\u4e48\u65f6\u5019\u7ed3\u675f\n    console.log('original request ended');\n    proxyRequest.end();\n  });\n}).listen(8888); // \u76d1\u542c\u6765\u81ea\u672c\u5730\u6d4f\u89c8\u5668\u7684\u8fde\u63a5\n")),(0,a.kt)("h3",{id:"\u5c01\u88c5-request-promise"},"\u5c01\u88c5 request-promise"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const https = require('https');\nconst promisify = require('util').promisify;\n\nhttps.get[promisify.custom] = function getAsync(options) {\n  return new Promise((resolve, reject) => {\n    https.get(options, (response) => {\n      response.end = new Promise((resolve) => response.on('end', resolve));\n      resolve(response);\n    }).on('error', reject);\n  });\n};\nconst rp = promisify(https.get);\n\n(async () => {\n  const res = await rp('https://jsonmock.hackerrank.com/api/movies/search/?Title=Spiderman&page=1');\n  let body = '';\n  res.on('data', (chunk) => body += chunk);\n  await res.end;\n\n  console.log(body);\n})();\n")),(0,a.kt)("h2",{id:"dns-\u8bf7\u6c42"},"DNS \u8bf7\u6c42"),(0,a.kt)("p",null,"\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"dns")," \u6a21\u5757\u521b\u5efa DNS \u8bf7\u6c42\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"dns.resolve"),"\uff0cA \u8bb0\u5f55\u5b58\u50a8 IP \u5730\u5740"),(0,a.kt)("li",{parentName:"ul"},"TXT\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"dns.resulveTxt"),"\uff0c\u6587\u672c\u503c\u53ef\u4ee5\u7528\u4e8e\u5728 DNS \u4e0a\u6784\u5efa\u5176\u4ed6\u670d\u52a1"),(0,a.kt)("li",{parentName:"ul"},"SRV\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"dns.resolveSrv"),"\uff0c\u670d\u52a1\u8bb0\u5f55\u5b9a\u4e49\u670d\u52a1\u7684\u5b9a\u4f4d\u6570\u636e\uff0c\u901a\u5e38\u5305\u542b\u4e3b\u673a\u540d\u548c\u7aef\u53e3\u53f7"),(0,a.kt)("li",{parentName:"ul"},"NS\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"dns.resolveNs"),"\uff0c\u6307\u5b9a\u57df\u540d\u670d\u52a1\u5668"),(0,a.kt)("li",{parentName:"ul"},"CNAME\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"dns.resolveCname"),"\uff0c\u76f8\u5173\u7684\u57df\u540d\u8bb0\u5f55\uff0c\u8bbe\u7f6e\u4e3a\u57df\u540d\u800c\u4e0d\u662f IP \u5730\u5740")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const dns = require('dns');\n\ndns.resolve('www.chenng.cn', function (err, addresses) {\n  if (err) {\n    console.error(err);\n  }\n\n  console.log('Addresses:', addresses);\n});\n")),(0,a.kt)("h2",{id:"crypto-\u5e93\u52a0\u5bc6\u89e3\u5bc6"},"crypto \u5e93\u52a0\u5bc6\u89e3\u5bc6"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const crypto = require('crypto')\n\nfunction aesEncrypt(data, key = 'key') {\n  const cipher = crypto.createCipher('aes192', key)\n  let crypted = cipher.update(data, 'utf8', 'hex')\n  crypted += cipher.final('hex')\n  return crypted\n}\n\nfunction aesDecrypt(encrypted, key = 'key') {\n  const decipher = crypto.createDecipher('aes192', key)\n  let decrypted = decipher.update(encrypted, 'hex', 'utf8')\n  decrypted += decipher.final('utf8')\n  return decrypted\n}\n")),(0,a.kt)("h2",{id:"\u53d1\u8d77-http-\u8bf7\u6c42\u7684\u65b9\u6cd5"},"\u53d1\u8d77 HTTP \u8bf7\u6c42\u7684\u65b9\u6cd5"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"HTTP \u6807\u51c6\u5e93",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u65e0\u9700\u5b89\u88c5\u5916\u90e8\u4f9d\u8d56"),(0,a.kt)("li",{parentName:"ul"},"\u9700\u8981\u4ee5\u5757\u4e3a\u5355\u4f4d\u63a5\u53d7\u6570\u636e\uff0c\u81ea\u5df1\u76d1\u542c end \u4e8b\u4ef6"),(0,a.kt)("li",{parentName:"ul"},"HTTP \u548c HTTPS \u662f\u4e24\u4e2a\u6a21\u5757\uff0c\u9700\u8981\u533a\u5206\u4f7f\u7528"))),(0,a.kt)("li",{parentName:"ul"},"Request \u5e93",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u65b9\u4fbf"),(0,a.kt)("li",{parentName:"ul"},"\u6709 promise \u7248\u672c ",(0,a.kt)("inlineCode",{parentName:"li"},"request-promise")))),(0,a.kt)("li",{parentName:"ul"},"Axios",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u65e2\u53ef\u4ee5\u7528\u5728\u6d4f\u89c8\u5668\u53c8\u53ef\u4ee5\u7528\u5728 NodeJS"),(0,a.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u4f7f\u7528 axios.all \u5e76\u53d1\u591a\u4e2a\u8bf7\u6c42"))),(0,a.kt)("li",{parentName:"ul"},"SuperAgent",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u94fe\u5f0f\u4f7f\u7528"))),(0,a.kt)("li",{parentName:"ul"},"node-fetch",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u6d4f\u89c8\u5668\u7684 fetch \u79fb\u690d\u8fc7\u6765\u7684")))),(0,a.kt)("h1",{id:"\u5b50\u8fdb\u7a0b"},"\u5b50\u8fdb\u7a0b"),(0,a.kt)("h2",{id:"\u6267\u884c\u5916\u90e8\u5e94\u7528"},"\u6267\u884c\u5916\u90e8\u5e94\u7528"),(0,a.kt)("h3",{id:"\u57fa\u672c\u6982\u5ff5"},"\u57fa\u672c\u6982\u5ff5"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"4\u4e2a\u5f02\u6b65\u65b9\u6cd5\uff1aexec\u3001execFile\u3001fork\u3001spawn",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Node",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"fork\uff1a\u60f3\u5c06\u4e00\u4e2a Node \u8fdb\u7a0b\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u8fdb\u7a0b\u6765\u8fd0\u884c\u7684\u65f6\u5019\u4f7f\u7528\uff0c\u662f\u7684\u8ba1\u7b97\u5904\u7406\u548c\u6587\u4ef6\u63cf\u8ff0\u5668\u8131\u79bb Node \u4e3b\u8fdb\u7a0b"))),(0,a.kt)("li",{parentName:"ul"},"\u975e Node",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"spawn\uff1a\u5904\u7406\u4e00\u4e9b\u4f1a\u6709\u5f88\u591a\u5b50\u8fdb\u7a0b I/O \u65f6\u3001\u8fdb\u7a0b\u4f1a\u6709\u5927\u91cf\u8f93\u51fa\u65f6\u4f7f\u7528"),(0,a.kt)("li",{parentName:"ul"},"execFile\uff1a\u53ea\u9700\u6267\u884c\u4e00\u4e2a\u5916\u90e8\u7a0b\u5e8f\u7684\u65f6\u5019\u4f7f\u7528\uff0c\u6267\u884c\u901f\u5ea6\u5feb\uff0c\u5904\u7406\u7528\u6237\u8f93\u5165\u76f8\u5bf9\u5b89\u5168"),(0,a.kt)("li",{parentName:"ul"},"exec\uff1a\u60f3\u76f4\u63a5\u8bbf\u95ee\u7ebf\u7a0b\u7684 shell \u547d\u4ee4\u65f6\u4f7f\u7528\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\u7528\u6237\u8f93\u5165"))))),(0,a.kt)("li",{parentName:"ul"},"3\u4e2a\u540c\u6b65\u65b9\u6cd5\uff1aexecSync\u3001execFileSync\u3001spawnSync"),(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 API \u521b\u5efa\u51fa\u6765\u7684\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\u6ca1\u6709\u4efb\u4f55\u5fc5\u7136\u8054\u7cfb")),(0,a.kt)("h3",{id:"execfile"},"execFile"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f1a\u628a\u8f93\u51fa\u7ed3\u679c\u7f13\u5b58\u597d\uff0c\u901a\u8fc7\u56de\u8c03\u8fd4\u56de\u6700\u540e\u7ed3\u679c\u6216\u8005\u5f02\u5e38\u4fe1\u606f")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const cp = require('child_process');\n\ncp.execFile('echo', ['hello', 'world'], (err, stdout, stderr) => {\n  if (err) { console.error(err); }\n  console.log('stdout: ', stdout);\n  console.log('stderr: ', stderr);\n});\n")),(0,a.kt)("h3",{id:"spawn"},"spawn"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u6d41\u53ef\u4ee5\u4f7f\u7528\u6709\u5927\u91cf\u6570\u636e\u8f93\u51fa\u7684\u5916\u90e8\u5e94\u7528\uff0c\u8282\u7ea6\u5185\u5b58"),(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u6d41\u63d0\u9ad8\u6570\u636e\u54cd\u5e94\u6548\u7387"),(0,a.kt)("li",{parentName:"ul"},"spawn \u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a I/O \u7684\u6d41\u63a5\u53e3")),(0,a.kt)("h4",{id:"\u5355\u4e00\u4efb\u52a1"},"\u5355\u4e00\u4efb\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const cp = require('child_process');\n\nconst child = cp.spawn('echo', ['hello', 'world']);\nchild.on('error', console.error);\nchild.stdout.pipe(process.stdout);\nchild.stderr.pipe(process.stderr);\n")),(0,a.kt)("h4",{id:"\u591a\u4efb\u52a1\u4e32\u8054"},"\u591a\u4efb\u52a1\u4e32\u8054"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const cp = require('child_process');\nconst path = require('path');\n\nconst cat = cp.spawn('cat', [path.resolve(__dirname, 'messy.txt')]);\nconst sort = cp.spawn('sort');\nconst uniq = cp.spawn('uniq');\n\ncat.stdout.pipe(sort.stdin);\nsort.stdout.pipe(uniq.stdin);\nuniq.stdout.pipe(process.stdout);\n")),(0,a.kt)("h3",{id:"exec"},"exec"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u53ea\u6709\u4e00\u4e2a\u5b57\u7b26\u4e32\u547d\u4ee4"),(0,a.kt)("li",{parentName:"ul"},"\u548c shell \u4e00\u6a21\u4e00\u6837")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const cp = require('child_process');\n\ncp.exec(`cat ${__dirname}/messy.txt | sort | uniq`, (err, stdout, stderr) => {\n  console.log(stdout);\n});\n")),(0,a.kt)("h3",{id:"fork"},"fork"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"fork \u65b9\u6cd5\u4f1a\u5f00\u53d1\u4e00\u4e2a IPC \u901a\u9053\uff0c\u4e0d\u540c\u7684 Node \u8fdb\u7a0b\u8fdb\u884c\u6d88\u606f\u4f20\u9001"),(0,a.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6d88\u8017 30ms \u542f\u52a8\u65f6\u95f4\u548c 10MB \u5185\u5b58"),(0,a.kt)("li",{parentName:"ul"},"\u5b50\u8fdb\u7a0b\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"process.on('message')"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"process.send()")),(0,a.kt)("li",{parentName:"ul"},"\u7236\u8fdb\u7a0b\uff1a",(0,a.kt)("inlineCode",{parentName:"li"},"child.on('message')"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"child.send()"))),(0,a.kt)("h4",{id:"\u7236\u5b50\u901a\u4fe1"},"\u7236\u5b50\u901a\u4fe1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// parent.js\nconst cp = require('child_process');\n\nconst child = cp.fork('./child', { silent: true });\nchild.send('monkeys');\nchild.on('message', function (message) {\n  console.log('got message from child', message, typeof message);\n})\nchild.stdout.pipe(process.stdout);\n\nsetTimeout(function () {\n  child.disconnect();\n}, 3000);\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// child.js\nprocess.on('message', function (message) {\n  console.log('got one', message);\n  process.send('no pizza');\n  process.send(1);\n  process.send({ my: 'object' });\n  process.send(false);\n  process.send(null);\n});\n\nconsole.log(process);\n")),(0,a.kt)("h2",{id:"\u5e38\u7528\u6280\u5de7"},"\u5e38\u7528\u6280\u5de7"),(0,a.kt)("h3",{id:"\u9000\u51fa\u65f6\u6740\u6b7b\u6240\u6709\u5b50\u8fdb\u7a0b"},"\u9000\u51fa\u65f6\u6740\u6b7b\u6240\u6709\u5b50\u8fdb\u7a0b"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4fdd\u7559\u5bf9\u7531 spawn \u8fd4\u56de\u7684 ChildProcess \u5bf9\u8c61\u7684\u5f15\u7528\uff0c\u5e76\u5728\u9000\u51fa\u4e3b\u8fdb\u7a0b\u65f6\u5c06\u5176\u6740\u6b7b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const spawn = require('child_process').spawn;\nconst children = [];\n\nprocess.on('exit', function () {\n  console.log('killing', children.length, 'child processes');\n  children.forEach(function (child) {\n    child.kill();\n  });\n});\n\nchildren.push(spawn('/bin/sleep', ['10']));\nchildren.push(spawn('/bin/sleep', ['10']));\nchildren.push(spawn('/bin/sleep', ['10']));\n\nsetTimeout(function () { process.exit(0); }, 3000);\n")),(0,a.kt)("h2",{id:"cluster-\u7684\u7406\u89e3"},"Cluster \u7684\u7406\u89e3"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u89e3\u51b3 NodeJS \u5355\u8fdb\u7a0b\u65e0\u6cd5\u5145\u5206\u5229\u7528\u591a\u6838 CPU \u95ee\u9898"),(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 master-cluster \u6a21\u5f0f\u53ef\u4ee5\u4f7f\u5f97\u5e94\u7528\u66f4\u52a0\u5065\u58ee"),(0,a.kt)("li",{parentName:"ul"},"Cluster \u5e95\u5c42\u662f child_process \u6a21\u5757\uff0c\u9664\u4e86\u53ef\u4ee5\u53d1\u9001\u666e\u901a\u6d88\u606f\uff0c\u8fd8\u53ef\u4ee5\u53d1\u9001\u5e95\u5c42\u5bf9\u8c61 ",(0,a.kt)("inlineCode",{parentName:"li"},"TCP"),"\u3001",(0,a.kt)("inlineCode",{parentName:"li"},"UDP")," \u7b49"),(0,a.kt)("li",{parentName:"ul"},"TCP \u4e3b\u8fdb\u7a0b\u53d1\u9001\u5230\u5b50\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u80fd\u6839\u636e\u6d88\u606f\u91cd\u5efa\u51fa TCP \u8fde\u63a5\uff0cCluster \u53ef\u4ee5\u51b3\u5b9a fork \u51fa\u5408\u9002\u7684\u786c\u4ef6\u8d44\u6e90\u7684\u5b50\u8fdb\u7a0b\u6570")),(0,a.kt)("h1",{id:"node-\u591a\u7ebf\u7a0b"},"Node \u591a\u7ebf\u7a0b"),(0,a.kt)("h2",{id:"\u5355\u7ebf\u7a0b\u95ee\u9898"},"\u5355\u7ebf\u7a0b\u95ee\u9898"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5bf9 cpu \u5229\u7528\u4e0d\u8db3"),(0,a.kt)("li",{parentName:"ul"},"\u67d0\u4e2a\u672a\u6355\u83b7\u7684\u5f02\u5e38\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6574\u4e2a\u7a0b\u5e8f\u7684\u9000\u51fa")),(0,a.kt)("h2",{id:"node-\u7ebf\u7a0b"},"Node \u7ebf\u7a0b"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Node \u8fdb\u7a0b\u5360\u7528\u4e86 7 \u4e2a\u7ebf\u7a0b"),(0,a.kt)("li",{parentName:"ul"},"Node \u4e2d\u6700\u6838\u5fc3\u7684\u662f v8 \u5f15\u64ce\uff0c\u5728 Node \u542f\u52a8\u540e\uff0c\u4f1a\u521b\u5efa v8 \u7684\u5b9e\u4f8b\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u662f\u591a\u7ebf\u7a0b\u7684",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"\u4e3b\u7ebf\u7a0b\uff1a\u7f16\u8bd1\u3001\u6267\u884c\u4ee3\u7801"),(0,a.kt)("li",{parentName:"ul"},"\u7f16\u8bd1/\u4f18\u5316\u7ebf\u7a0b\uff1a\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4f18\u5316\u4ee3\u7801"),(0,a.kt)("li",{parentName:"ul"},"\u5206\u6790\u5668\u7ebf\u7a0b\uff1a\u8bb0\u5f55\u5206\u6790\u4ee3\u7801\u8fd0\u884c\u65f6\u95f4\uff0c\u4e3a Crankshaft \u4f18\u5316\u4ee3\u7801\u6267\u884c\u63d0\u4f9b\u4f9d\u636e"),(0,a.kt)("li",{parentName:"ul"},"\u5783\u573e\u56de\u6536\u7684\u51e0\u4e2a\u7ebf\u7a0b"))),(0,a.kt)("li",{parentName:"ul"},"JavaScript \u7684\u6267\u884c\u662f\u5355\u7ebf\u7a0b\u7684\uff0c\u4f46 Javascript \u7684\u5bbf\u4e3b\u73af\u5883\uff0c\u65e0\u8bba\u662f Node \u8fd8\u662f\u6d4f\u89c8\u5668\u90fd\u662f\u591a\u7ebf\u7a0b\u7684")),(0,a.kt)("h2",{id:"\u5f02\u6b65-io"},"\u5f02\u6b65 IO"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Node \u4e2d\u6709\u4e00\u4e9b IO \u64cd\u4f5c\uff08DNS\uff0cFS\uff09\u548c\u4e00\u4e9b CPU \u5bc6\u96c6\u8ba1\u7b97\uff08Zlib\uff0cCrypto\uff09\u4f1a\u542f\u7528 Node \u7684\u7ebf\u7a0b\u6c60"),(0,a.kt)("li",{parentName:"ul"},"\u7ebf\u7a0b\u6c60\u9ed8\u8ba4\u5927\u5c0f\u4e3a 4\uff0c\u53ef\u4ee5\u624b\u52a8\u66f4\u6539\u7ebf\u7a0b\u6c60\u9ed8\u8ba4\u5927\u5c0f")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"process.env.UV_THREADPOOL_SIZE = 64\n")),(0,a.kt)("h2",{id:"cluster-\u591a\u8fdb\u7a0b"},"cluster \u591a\u8fdb\u7a0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const cluster = require('cluster');\nconst http = require('http');\nconst numCPUs = require('os').cpus().length;\n\nif (cluster.isMaster) {\n  console.log(`\u4e3b\u8fdb\u7a0b ${process.pid} \u6b63\u5728\u8fd0\u884c`);\n  for (let i = 0; i < numCPUs; i++) {\n    cluster.fork();\n  }\n\n  cluster.on('exit', (worker, code, signal) => {\n    console.log(`\u5de5\u4f5c\u8fdb\u7a0b ${worker.process.pid} \u5df2\u9000\u51fa`);\n  });\n} else {\n  // \u5de5\u4f5c\u8fdb\u7a0b\u53ef\u4ee5\u5171\u4eab\u4efb\u4f55 TCP \u8fde\u63a5\u3002\n  // \u5728\u672c\u4f8b\u5b50\u4e2d\uff0c\u5171\u4eab\u7684\u662f HTTP \u670d\u52a1\u5668\u3002\n  http.createServer((req, res) => {\n    res.writeHead(200);\n    res.end('Hello World');\n  }).listen(8000);\n  console.log(`\u5de5\u4f5c\u8fdb\u7a0b ${process.pid} \u5df2\u542f\u52a8`);\n}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e00\u5171\u6709 9 \u4e2a\u8fdb\u7a0b\uff0c\u5176\u4e2d\u4e00\u4e2a\u4e3b\u8fdb\u7a0b\uff0ccpu \u4e2a\u6570 x cpu \u6838\u6570 = 2 x 4 = 8 \u4e2a \u5b50\u8fdb\u7a0b"),(0,a.kt)("li",{parentName:"ul"},"\u65e0\u8bba child_process \u8fd8\u662f cluster\uff0c\u90fd\u4e0d\u662f\u591a\u7ebf\u7a0b\u6a21\u578b\uff0c\u800c\u662f\u591a\u8fdb\u7a0b\u6a21\u578b"),(0,a.kt)("li",{parentName:"ul"},"\u5e94\u5bf9\u5355\u7ebf\u7a0b\u95ee\u9898\uff0c\u901a\u5e38\u4f7f\u7528\u591a\u8fdb\u7a0b\u7684\u65b9\u5f0f\u6765\u6a21\u62df\u591a\u7ebf\u7a0b")),(0,a.kt)("h2",{id:"\u771f-node-\u591a\u7ebf\u7a0b"},"\u771f Node \u591a\u7ebf\u7a0b"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Node 10.5.0 \u7684\u53d1\u5e03\uff0c\u7ed9\u51fa\u4e86\u4e00\u4e2a\u5b9e\u9a8c\u6027\u8d28\u7684\u6a21\u5757 worker_threads \u7ed9 Node \u63d0\u4f9b\u771f\u6b63\u7684\u591a\u7ebf\u7a0b\u80fd\u529b"),(0,a.kt)("li",{parentName:"ul"},"worker_thread \u6a21\u5757\u4e2d\u6709 4 \u4e2a\u5bf9\u8c61\u548c 2 \u4e2a\u7c7b",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"isMainThread: \u662f\u5426\u662f\u4e3b\u7ebf\u7a0b\uff0c\u6e90\u7801\u4e2d\u662f\u901a\u8fc7 threadId === 0 \u8fdb\u884c\u5224\u65ad\u7684\u3002"),(0,a.kt)("li",{parentName:"ul"},"MessagePort: \u7528\u4e8e\u7ebf\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u7ee7\u627f\u81ea EventEmitter\u3002"),(0,a.kt)("li",{parentName:"ul"},"MessageChannel: \u7528\u4e8e\u521b\u5efa\u5f02\u6b65\u3001\u53cc\u5411\u901a\u4fe1\u7684\u901a\u9053\u5b9e\u4f8b\u3002"),(0,a.kt)("li",{parentName:"ul"},"threadId: \u7ebf\u7a0b ID\u3002"),(0,a.kt)("li",{parentName:"ul"},"Worker: \u7528\u4e8e\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u521b\u5efa\u5b50\u7ebf\u7a0b\u3002\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a filename\uff0c\u8868\u793a\u5b50\u7ebf\u7a0b\u6267\u884c\u7684\u5165\u53e3\u3002"),(0,a.kt)("li",{parentName:"ul"},"parentPort: \u5728 worker \u7ebf\u7a0b\u91cc\u662f\u8868\u793a\u7236\u8fdb\u7a0b\u7684 MessagePort \u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5728\u4e3b\u7ebf\u7a0b\u91cc\u4e3a null"),(0,a.kt)("li",{parentName:"ul"},"workerData: \u7528\u4e8e\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u5411\u5b50\u8fdb\u7a0b\u4f20\u9012\u6570\u636e\uff08data \u526f\u672c\uff09")))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const {\n  isMainThread,\n  parentPort,\n  workerData,\n  threadId,\n  MessageChannel,\n  MessagePort,\n  Worker\n} = require('worker_threads');\n\nfunction mainThread() {\n  for (let i = 0; i < 5; i++) {\n    const worker = new Worker(__filename, { workerData: i });\n    worker.on('exit', code => { console.log(`main: worker stopped with exit code ${code}`); });\n    worker.on('message', msg => {\n      console.log(`main: receive ${msg}`);\n      worker.postMessage(msg + 1);\n    });\n  }\n}\n\nfunction workerThread() {\n  console.log(`worker: workerDate ${workerData}`);\n  parentPort.on('message', msg => {\n    console.log(`worker: receive ${msg}`);\n  }),\n  parentPort.postMessage(workerData);\n}\n\nif (isMainThread) {\n  mainThread();\n} else {\n  workerThread();\n}\n")),(0,a.kt)("h3",{id:"\u7ebf\u7a0b\u901a\u4fe1"},"\u7ebf\u7a0b\u901a\u4fe1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const assert = require('assert');\nconst {\n  Worker,\n  MessageChannel,\n  MessagePort,\n  isMainThread,\n  parentPort\n} = require('worker_threads');\nif (isMainThread) {\n  const worker = new Worker(__filename);\n  const subChannel = new MessageChannel();\n  worker.postMessage({ hereIsYourPort: subChannel.port1 }, [subChannel.port1]);\n  subChannel.port2.on('message', (value) => {\n    console.log('received:', value);\n  });\n} else {\n  parentPort.once('message', (value) => {\n    assert(value.hereIsYourPort instanceof MessagePort);\n    value.hereIsYourPort.postMessage('the worker is sending this');\n    value.hereIsYourPort.close();\n  });\n}\n")),(0,a.kt)("h2",{id:"\u591a\u8fdb\u7a0b-vs-\u591a\u7ebf\u7a0b"},"\u591a\u8fdb\u7a0b vs \u591a\u7ebf\u7a0b"),(0,a.kt)("p",null,"\u8fdb\u7a0b\u662f\u8d44\u6e90\u5206\u914d\u7684\u6700\u5c0f\u5355\u4f4d\uff0c\u7ebf\u7a0b\u662fCPU\u8c03\u5ea6\u7684\u6700\u5c0f\u5355\u4f4d"),(0,a.kt)("h1",{id:"\u5206\u5e03\u5f0f"},"\u5206\u5e03\u5f0f"),(0,a.kt)("h2",{id:"\u5206\u5e03\u5f0f\u9501"},"\u5206\u5e03\u5f0f\u9501"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5728\u5355\u673a\u573a\u666f\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u8bed\u8a00\u7684\u5185\u7f6e\u9501\u6765\u5b9e\u73b0\u8fdb\u7a0b\u540c\u6b65"),(0,a.kt)("li",{parentName:"ul"},"\u5728\u5206\u5e03\u5f0f\u573a\u666f\u4e0b\uff0c\u9700\u8981\u540c\u6b65\u7684\u8fdb\u7a0b\u53ef\u80fd\u4f4d\u4e8e\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4f7f\u7528\u5206\u5e03\u5f0f\u9501")),(0,a.kt)("h3",{id:"\u6570\u636e\u5e93\u7684\u552f\u4e00\u7d22\u5f15"},"\u6570\u636e\u5e93\u7684\u552f\u4e00\u7d22\u5f15"),(0,a.kt)("p",null,"\u83b7\u5f97\u9501\u65f6\u5411\u8868\u4e2d\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u91ca\u653e\u9501\u65f6\u5220\u9664\u8fd9\u6761\u8bb0\u5f55\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u9501\u6ca1\u6709\u5931\u6548\u65f6\u95f4\uff0c\u89e3\u9501\u5931\u8d25\u7684\u8bdd\u5176\u5b83\u8fdb\u7a0b\u65e0\u6cd5\u518d\u83b7\u5f97\u8be5\u9501\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u53ea\u80fd\u662f\u975e\u963b\u585e\u9501\uff0c\u63d2\u5165\u5931\u8d25\u76f4\u63a5\u5c31\u62a5\u9519\u4e86\uff0c\u65e0\u6cd5\u91cd\u8bd5\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u53ef\u91cd\u5165\uff0c\u5df2\u7ecf\u83b7\u5f97\u9501\u7684\u8fdb\u7a0b\u4e5f\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u9501\u3002")),(0,a.kt)("h3",{id:"redis-\u7684-setnx-\u6307\u4ee4"},"Redis \u7684 SETNX \u6307\u4ee4"),(0,a.kt)("p",null,"\u4f7f\u7528 SETNX\uff08set if not exist\uff09\u6307\u4ee4\u63d2\u5165\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u5982\u679c Key \u5df2\u7ecf\u5b58\u5728\uff0c\u90a3\u4e48\u4f1a\u8fd4\u56de False\uff0c\u5426\u5219\u63d2\u5165\u6210\u529f\u5e76\u8fd4\u56de True"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"SETNX \u6307\u4ee4\u548c\u6570\u636e\u5e93\u7684\u552f\u4e00\u7d22\u5f15\u7c7b\u4f3c\uff0c\u4fdd\u8bc1\u4e86\u53ea\u5b58\u5728\u4e00\u4e2a Key \u7684\u952e\u503c\u5bf9\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a Key \u7684\u952e\u503c\u5bf9\u662f\u5426\u5b58\u5728\u6765\u5224\u65ad\u662f\u5426\u5b58\u4e8e\u9501\u5b9a\u72b6\u6001"),(0,a.kt)("li",{parentName:"ul"},"EXPIRE \u6307\u4ee4\u53ef\u4ee5\u4e3a\u4e00\u4e2a\u952e\u503c\u5bf9\u8bbe\u7f6e\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\uff0c\u4ece\u800c\u907f\u514d\u4e86\u6570\u636e\u5e93\u552f\u4e00\u7d22\u5f15\u5b9e\u73b0\u65b9\u5f0f\u4e2d\u91ca\u653e\u9501\u5931\u8d25\u7684\u95ee\u9898")),(0,a.kt)("h3",{id:"redis-\u7684-redlock-\u7b97\u6cd5"},"Redis \u7684 RedLock \u7b97\u6cd5"),(0,a.kt)("p",null,"\u4f7f\u7528\u4e86\u591a\u4e2a Redis \u5b9e\u4f8b\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff0c\u8fd9\u662f\u4e3a\u4e86\u4fdd\u8bc1\u5728\u53d1\u751f\u5355\u70b9\u6545\u969c\u65f6\u4ecd\u7136\u53ef\u7528"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5c1d\u8bd5\u4ece N \u4e2a\u76f8\u4e92\u72ec\u7acb Redis \u5b9e\u4f8b\u83b7\u53d6\u9501"),(0,a.kt)("li",{parentName:"ul"},"\u8ba1\u7b97\u83b7\u53d6\u9501\u6d88\u8017\u7684\u65f6\u95f4\uff0c\u53ea\u6709\u5f53\u8fd9\u4e2a\u65f6\u95f4\u5c0f\u4e8e\u9501\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5e76\u4e14\u4ece\u5927\u591a\u6570\uff08N / 2 + 1\uff09\u5b9e\u4f8b\u4e0a\u83b7\u53d6\u4e86\u9501\uff0c\u90a3\u4e48\u5c31\u8ba4\u4e3a\u9501\u83b7\u53d6\u6210\u529f\u4e86"),(0,a.kt)("li",{parentName:"ul"},"\u5982\u679c\u9501\u83b7\u53d6\u5931\u8d25\uff0c\u5c31\u5230\u6bcf\u4e2a\u5b9e\u4f8b\u4e0a\u91ca\u653e\u9501")),(0,a.kt)("h1",{id:"\u9879\u76ee\u7ba1\u7406"},"\u9879\u76ee\u7ba1\u7406"),(0,a.kt)("h2",{id:"\u7ec4\u4ef6\u5f0f\u6784\u5efa"},"\u7ec4\u4ef6\u5f0f\u6784\u5efa"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/i0natan/nodebestpractices/blob/master/sections/projectstructre/breakintcomponents.chinese.md"},"https://github.com/i0natan/nodebestpractices/blob/master/sections/projectstructre/breakintcomponents.chinese.md")),(0,a.kt)("h2",{id:"\u591a\u73af\u5883\u914d\u7f6e"},"\u591a\u73af\u5883\u914d\u7f6e"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"JSON \u914d\u7f6e\u6587\u4ef6"),(0,a.kt)("li",{parentName:"ul"},"\u73af\u5883\u53d8\u91cf\n\u4f7f\u7528\u7b2c\u4e09\u65b9\u6a21\u5757\u7ba1\u7406\uff08nconf\uff09")),(0,a.kt)("h2",{id:"\u4f9d\u8d56\u7ba1\u7406"},"\u4f9d\u8d56\u7ba1\u7406"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"dependencies\uff1a\u6a21\u5757\u6b63\u5e38\u8fd0\u884c\u9700\u8981\u7684\u4f9d\u8d56"),(0,a.kt)("li",{parentName:"ul"},"devDependencies\uff1a\u5f00\u53d1\u65f6\u5019\u9700\u8981\u7684\u4f9d\u8d56"),(0,a.kt)("li",{parentName:"ul"},"optionalDependencies\uff1a\u975e\u5fc5\u8981\u4f9d\u8d56\uff0c\u67d0\u79cd\u7a0b\u5ea6\u4e0a\u589e\u5f3a"),(0,a.kt)("li",{parentName:"ul"},"peerDependencies\uff1a\u8fd0\u884c\u65f6\u4f9d\u8d56\uff0c\u9650\u5b9a\u7248\u672c")),(0,a.kt)("h1",{id:"\u5f02\u5e38\u5904\u7406"},"\u5f02\u5e38\u5904\u7406"),(0,a.kt)("h2",{id:"\u5904\u7406\u672a\u6355\u83b7\u7684\u5f02\u5e38"},"\u5904\u7406\u672a\u6355\u83b7\u7684\u5f02\u5e38"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u9664\u975e\u5f00\u53d1\u8005\u8bb0\u5f97\u6dfb\u52a0.catch\u8bed\u53e5\uff0c\u5728\u8fd9\u4e9b\u5730\u65b9\u629b\u51fa\u7684\u9519\u8bef\u90fd\u4e0d\u4f1a\u88ab uncaughtException \u4e8b\u4ef6\u5904\u7406\u7a0b\u5e8f\u6765\u5904\u7406\uff0c\u7136\u540e\u6d88\u5931\u6389\u3002"),(0,a.kt)("li",{parentName:"ul"},"Node \u5e94\u7528\u4e0d\u4f1a\u5954\u6e83\uff0c\u4f46\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6cc4\u9732")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"process.on('uncaughtException', (error) => {\n  // \u6211\u521a\u6536\u5230\u4e00\u4e2a\u4ece\u672a\u88ab\u5904\u7406\u7684\u9519\u8bef\n  // \u73b0\u5728\u5904\u7406\u5b83\uff0c\u5e76\u51b3\u5b9a\u662f\u5426\u9700\u8981\u91cd\u542f\u5e94\u7528\n  errorManagement.handler.handleError(error);\n  if (!errorManagement.handler.isTrustedError(error)) {\n    process.exit(1);\n  }\n});\n\nprocess.on('unhandledRejection', (reason, p) => {\n  // \u6211\u521a\u521a\u6355\u83b7\u4e86\u4e00\u4e2a\u672a\u5904\u7406\u7684promise rejection,\n  // \u56e0\u4e3a\u6211\u4eec\u5df2\u7ecf\u6709\u4e86\u5bf9\u4e8e\u672a\u5904\u7406\u9519\u8bef\u7684\u540e\u5907\u7684\u5904\u7406\u673a\u5236\uff08\u89c1\u4e0b\u9762\uff09\n  // \u76f4\u63a5\u629b\u51fa\uff0c\u8ba9\u5b83\u6765\u5904\u7406\n  throw reason;\n});\n")),(0,a.kt)("h2",{id:"\u901a\u8fc7-domain-\u7ba1\u7406\u5f02\u5e38"},"\u901a\u8fc7 domain \u7ba1\u7406\u5f02\u5e38"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u901a\u8fc7 domain \u6a21\u5757\u7684 create \u65b9\u6cd5\u521b\u5efa\u5b9e\u4f8b"),(0,a.kt)("li",{parentName:"ul"},"\u67d0\u4e2a\u9519\u8bef\u5df2\u7ecf\u4efb\u4f55\u5176\u4ed6\u9519\u8bef\u90fd\u4f1a\u88ab\u540c\u4e00\u4e2a error \u5904\u7406\u65b9\u6cd5\u5904\u7406"),(0,a.kt)("li",{parentName:"ul"},"\u4efb\u4f55\u5728\u8fd9\u4e2a\u56de\u8c03\u4e2d\u5bfc\u81f4\u9519\u8bef\u7684\u4ee3\u7801\u90fd\u4f1a\u88ab domain \u8986\u76d6\u5230"),(0,a.kt)("li",{parentName:"ul"},"\u5141\u8bb8\u6211\u4eec\u4ee3\u7801\u5728\u4e00\u4e2a\u6c99\u76d2\u8fd0\u884c\uff0c\u5e76\u4e14\u53ef\u4ee5\u4f7f\u7528 res \u5bf9\u8c61\u7ed9\u7528\u6237\u53cd\u9988")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const domain = require('domain');\nconst audioDomain = domain.create();\n\naudioDomain.on('error', function(err) {\n  console.log('audioDomain error:', err);\n});\n\naudioDomain.run(function() {\n  const musicPlayer = new MusicPlayer();\n  musicPlayer.play();\n});\n")),(0,a.kt)("h2",{id:"joi-\u9a8c\u8bc1\u53c2\u6570"},"Joi \u9a8c\u8bc1\u53c2\u6570"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const memberSchema = Joi.object().keys({\n password: Joi.string().regex(/^[a-zA-Z0-9]{3,30}$/),\n birthyear: Joi.number().integer().min(1900).max(2013),\n email: Joi.string().email(),\n});\n \nfunction addNewMember(newMember) {\n //assertions come first\n Joi.assert(newMember, memberSchema); //throws if validation fails\n \n //other logic here\n}\n")),(0,a.kt)("h2",{id:"kibana-\u7cfb\u7edf\u76d1\u63a7"},"Kibana \u7cfb\u7edf\u76d1\u63a7"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/i0natan/nodebestpractices/blob/master/sections/production/smartlogging.chinese.md"},"https://github.com/i0natan/nodebestpractices/blob/master/sections/production/smartlogging.chinese.md")),(0,a.kt)("h1",{id:"\u4e0a\u7ebf\u5b9e\u8df5"},"\u4e0a\u7ebf\u5b9e\u8df5"),(0,a.kt)("h2",{id:"\u4f7f\u7528-winston-\u8bb0\u5f55\u65e5\u8bb0"},"\u4f7f\u7528 winston \u8bb0\u5f55\u65e5\u8bb0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"var winston = require('winston');\nvar moment = require('moment');\n\nconst logger = new (winston.Logger)({\n  transports: [\n    new (winston.transports.Console)({\n      timestamp: function() {\n        return moment().format('YYYY-MM-DD HH:mm:ss')\n      },\n      formatter: function(params) {\n        let time = params.timestamp() // \u65f6\u95f4\n        let message = params.message // \u624b\u52a8\u4fe1\u606f\n        let meta = params.meta && Object.keys(params.meta).length ? '\\n\\t'+ JSON.stringify(params.meta) : ''\n        return `${time} ${message}`\n      },\n    }),\n    new (winston.transports.File)({\n      filename: `${__dirname}/../winston/winston.log`,\n      json: false,\n      timestamp: function() {\n        return moment().format('YYYY-MM-DD HH:mm:ss')\n      },\n      formatter: function(params) {\n        let time = params.timestamp() // \u65f6\u95f4\n        let message = params.message // \u624b\u52a8\u4fe1\u606f\n        let meta = params.meta && Object.keys(params.meta).length ? '\\n\\t'+ JSON.stringify(params.meta) : ''\n        return `${time} ${message}`\n      }\n    })\n  ]\n})\n\nmodule.exports = logger\n\n// logger.error('error')\n// logger.warm('warm')\n// logger.info('info')\n")),(0,a.kt)("h2",{id:"\u59d4\u6258\u53cd\u5411\u4ee3\u7406"},"\u59d4\u6258\u53cd\u5411\u4ee3\u7406"),(0,a.kt)("p",null,"Node \u5904\u7406 CPU \u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u5982 gzipping\uff0cSSL termination \u7b49\uff0c\u8868\u73b0\u7cdf\u7cd5\u3002\u76f8\u53cd\uff0c\u4f7f\u7528\u4e00\u4e2a\u771f\u6b63\u7684\u4e2d\u95f4\u4ef6\u670d\u52a1\u50cf Nginx \u66f4\u597d\u3002\u5426\u5219\u53ef\u601c\u7684\u5355\u7ebf\u7a0b Node \u5c06\u4e0d\u5e78\u5730\u5fd9\u4e8e\u5904\u7406\u7f51\u7edc\u4efb\u52a1\uff0c\u800c\u4e0d\u662f\u5904\u7406\u5e94\u7528\u7a0b\u5e8f\u6838\u5fc3\uff0c\u6027\u80fd\u4f1a\u76f8\u5e94\u964d\u4f4e\u3002"),(0,a.kt)("p",null,"\u867d\u7136 express.js \u901a\u8fc7\u4e00\u4e9b connect \u4e2d\u95f4\u4ef6\u5904\u7406\u9759\u6001\u6587\u4ef6\uff0c\u4f46\u4f60\u4e0d\u5e94\u8be5\u4f7f\u7528\u5b83\u3002Nginx \u53ef\u4ee5\u66f4\u597d\u5730\u5904\u7406\u9759\u6001\u6587\u4ef6\uff0c\u5e76\u53ef\u4ee5\u9632\u6b62\u8bf7\u6c42\u52a8\u6001\u5185\u5bb9\u5835\u585e\u6211\u4eec\u7684 node \u8fdb\u7a0b\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"# \u914d\u7f6e gzip \u538b\u7f29\ngzip on;\ngzip_comp_level 6;\ngzip_vary on;\n\n# \u914d\u7f6e upstream\nupstream myApplication {\n  server 127.0.0.1:3000;\n  server 127.0.0.1:3001;\n  keepalive 64;\n}\n\n#\u5b9a\u4e49 web server\nserver {\n  # configure server with ssl and error pages\n  listen 80;\n  listen 443 ssl;\n  ssl_certificate /some/location/sillyfacesociety.com.bundle.crt;\n  error_page 502 /errors/502.html;\n\n  # handling static content\n  location ~ ^/(images/|img/|javascript/|js/|css/|stylesheets/|flash/|media/|static/|robots.txt|humans.txt|favicon.ico) {\n  root /usr/local/silly_face_society/node/public;\n  access_log off;\n  expires max;\n}\n")),(0,a.kt)("h2",{id:"\u68c0\u6d4b\u6709\u6f0f\u6d1e\u7684\u4f9d\u8d56\u9879"},"\u68c0\u6d4b\u6709\u6f0f\u6d1e\u7684\u4f9d\u8d56\u9879"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/audit"},"https://docs.npmjs.com/cli/audit")),(0,a.kt)("h2",{id:"pm2-http-\u96c6\u7fa4\u914d\u7f6e"},"PM2 HTTP \u96c6\u7fa4\u914d\u7f6e"),(0,a.kt)("h3",{id:"\u5de5\u4f5c\u7ebf\u7a0b\u914d\u7f6e"},"\u5de5\u4f5c\u7ebf\u7a0b\u914d\u7f6e"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pm2 start app.js -i 4"),"\uff0c",(0,a.kt)("inlineCode",{parentName:"li"},"-i 4")," \u662f\u4ee5 cluster_mode \u5f62\u5f0f\u8fd0\u884c app\uff0c\u6709 4 \u4e2a\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u5982\u679c\u914d\u7f6e ",(0,a.kt)("inlineCode",{parentName:"li"},"0"),"\uff0cPM2 \u4f1a\u6839\u636e CPU \u6838\u5fc3\u6570\u6765\u751f\u6210\u5bf9\u5e94\u7684\u5de5\u4f5c\u7ebf\u7a0b"),(0,a.kt)("li",{parentName:"ul"},"\u5de5\u4f5c\u7ebf\u7a0b\u6302\u4e86 PM2 \u4f1a\u7acb\u5373\u5c06\u5176\u91cd\u542f"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pm2 scale <app name> <n>")," \u5bf9\u96c6\u7fa4\u8fdb\u884c\u6269\u5c55")),(0,a.kt)("h3",{id:"pm2-\u81ea\u52a8\u542f\u52a8"},"PM2 \u81ea\u52a8\u542f\u52a8"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pm2 save")," \u4fdd\u5b58\u5f53\u524d\u8fd0\u884c\u7684\u5e94\u7528"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"pm2 startup")," \u542f\u52a8")),(0,a.kt)("h1",{id:"\u6027\u80fd\u5b9e\u8df5"},"\u6027\u80fd\u5b9e\u8df5"),(0,a.kt)("h2",{id:"\u907f\u514d\u4f7f\u7528-lodash"},"\u907f\u514d\u4f7f\u7528 Lodash"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u50cf lodash \u8fd9\u6837\u7684\u65b9\u6cd5\u5e93\u8fd9\u4f1a\u5bfc\u81f4\u4e0d\u5fc5\u8981\u7684\u4f9d\u8d56\u548c\u8f83\u6162\u7684\u6027\u80fd"),(0,a.kt)("li",{parentName:"ul"},"\u968f\u7740\u65b0\u7684 V8 \u5f15\u64ce\u548c\u65b0\u7684 ES \u6807\u51c6\u7684\u5f15\u5165\uff0c\u539f\u751f\u65b9\u6cd5\u5f97\u5230\u4e86\u6539\u8fdb\uff0c\u73b0\u5728\u6027\u80fd\u6bd4\u65b9\u6cd5\u5e93\u63d0\u9ad8\u4e86 50%")),(0,a.kt)("p",null,"\u4f7f\u7528 ESLint \u63d2\u4ef6\u68c0\u6d4b\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "extends": [\n    "plugin:you-dont-need-lodash-underscore/compatible"\n  ]\n}\n')),(0,a.kt)("h2",{id:"benchmark"},"benchmark"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const _ = require('lodash'),\n  __ = require('underscore'),\n  Suite = require('benchmark').Suite,\n  opts = require('./utils');\n  //cf. https://github.com/Berkmann18/NativeVsUtils/blob/master/utils.js\n\nconst concatSuite = new Suite('concat', opts);\nconst array = [0, 1, 2];\n\nconcatSuite.add('lodash', () => _.concat(array, 3, 4, 5))\n  .add('underscore', () => __.concat(array, 3, 4, 5))\n  .add('native', () => array.concat(3, 4, 5))\n  .run({ 'async': true });\n")),(0,a.kt)("h2",{id:"\u4f7f\u7528-prof-\u8fdb\u884c\u6027\u80fd\u5206\u6790"},"\u4f7f\u7528 prof \u8fdb\u884c\u6027\u80fd\u5206\u6790"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528 tick-processor \u5de5\u5177\u5904\u7406\u5206\u6790")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"node --prof profile-test.js\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"npm install tick -g\n\nnode-tick-processor\n")),(0,a.kt)("h2",{id:"\u4f7f\u7528-headdump-\u5806\u5feb\u7167"},"\u4f7f\u7528 headdump \u5806\u5feb\u7167"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4ee3\u7801\u52a0\u8f7d\u6a21\u5757\u8fdb\u884c\u5feb\u7167\u6587\u4ef6\u751f\u6210"),(0,a.kt)("li",{parentName:"ul"},"Chrome Profiles \u52a0\u8f7d\u5feb\u7167\u6587\u4ef6")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"yarn add heapdump -D\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const heapdump = require('heapdump');\nconst string = '1 string to rule them all';\n\nconst leakyArr = [];\nlet count = 2;\nsetInterval(function () {\n  leakyArr.push(string.replace(/1/g, count++));\n}, 0);\n\nsetInterval(function () {\n  if (heapdump.writeSnapshot()) console.log('wrote snapshot');\n}, 20000);\n")),(0,a.kt)("h1",{id:"\u5e94\u7528\u5b89\u5168\u6e05\u5355"},"\u5e94\u7528\u5b89\u5168\u6e05\u5355"),(0,a.kt)("h2",{id:"helmet-\u8bbe\u7f6e\u5b89\u5168\u54cd\u5e94\u5934"},"helmet \u8bbe\u7f6e\u5b89\u5168\u54cd\u5e94\u5934"),(0,a.kt)("p",null,"\u68c0\u6d4b\u5934\u90e8\u914d\u7f6e\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://securityheaders.com/"},"Security Headers"),"\u3002"),(0,a.kt)("p",null,"\u5e94\u7528\u7a0b\u5e8f\u5e94\u8be5\u4f7f\u7528\u5b89\u5168\u7684 header \u6765\u9632\u6b62\u653b\u51fb\u8005\u4f7f\u7528\u5e38\u89c1\u7684\u653b\u51fb\u65b9\u5f0f\uff0c\u8bf8\u5982\u8de8\u7ad9\u70b9\u811a\u672c\u653b\u51fb(XSS)\u3001\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020(CSRF)\u3002\u53ef\u4ee5\u4f7f\u7528\u6a21\u5757 ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/helmet"},"helmet")," \u8f7b\u677e\u8fdb\u884c\u914d\u7f6e\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6784\u9020",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"X-Frame-Options\uff1asameorigin\u3002\u63d0\u4f9b\u70b9\u51fb\u52ab\u6301\u4fdd\u62a4\uff0ciframe \u53ea\u80fd\u540c\u6e90\u3002"))),(0,a.kt)("li",{parentName:"ul"},"\u4f20\u8f93",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Strict-Transport-Security\uff1amax-age=31536000; includeSubDomains\u3002\u5f3a\u5236 HTTPS\uff0c\u8fd9\u51cf\u5c11\u4e86web \u5e94\u7528\u7a0b\u5e8f\u4e2d\u9519\u8bef\u901a\u8fc7 cookies \u548c\u5916\u90e8\u94fe\u63a5\uff0c\u6cc4\u9732\u4f1a\u8bdd\u6570\u636e\uff0c\u5e76\u9632\u6b62\u4e2d\u95f4\u4eba\u653b\u51fb"))),(0,a.kt)("li",{parentName:"ul"},"\u5185\u5bb9",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"X-Content-Type-Options\uff1anosniff\u3002\u963b\u6b62\u4ece\u58f0\u660e\u7684\u5185\u5bb9\u7c7b\u578b\u4e2d\u55c5\u63a2\u54cd\u5e94\uff0c\u51cf\u5c11\u4e86\u7528\u6237\u4e0a\u4f20\u6076\u610f\u5185\u5bb9\u9020\u6210\u7684\u98ce\u9669"),(0,a.kt)("li",{parentName:"ul"},"Content-Type\uff1atext/html;charset=utf-8\u3002\u6307\u793a\u6d4f\u89c8\u5668\u5c06\u9875\u9762\u89e3\u91ca\u4e3a\u7279\u5b9a\u7684\u5185\u5bb9\u7c7b\u578b\uff0c\u800c\u4e0d\u662f\u4f9d\u8d56\u6d4f\u89c8\u5668\u8fdb\u884c\u5047\u8bbe"))),(0,a.kt)("li",{parentName:"ul"},"XSS",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"X-XSS-Protection\uff1a1; mode=block\u3002\u542f\u7528\u4e86\u5185\u7f6e\u4e8e\u6700\u65b0 web \u6d4f\u89c8\u5668\u4e2d\u7684\u8de8\u7ad9\u70b9\u811a\u672c(XSS)\u8fc7\u6ee4\u5668"))),(0,a.kt)("li",{parentName:"ul"},"\u4e0b\u8f7d",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"X-Download-Options\uff1anoopen\u3002"))),(0,a.kt)("li",{parentName:"ul"},"\u7f13\u5b58",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Cache-Control\uff1ano-cache\u3002web \u5e94\u4e2d\u8fd4\u56de\u7684\u6570\u636e\u53ef\u4ee5\u7531\u7528\u6237\u6d4f\u89c8\u5668\u4ee5\u53ca\u4e2d\u95f4\u4ee3\u7406\u7f13\u5b58\u3002\u8be5\u6307\u4ee4\u6307\u793a\u4ed6\u4eec\u4e0d\u8981\u4fdd\u7559\u9875\u9762\u5185\u5bb9\uff0c\u4ee5\u514d\u5176\u4ed6\u4eba\u4ece\u8fd9\u4e9b\u7f13\u5b58\u4e2d\u8bbf\u95ee\u654f\u611f\u5185\u5bb9"),(0,a.kt)("li",{parentName:"ul"},"Pragma\uff1ano-cache\u3002\u540c\u4e0a"),(0,a.kt)("li",{parentName:"ul"},"Expires\uff1a-1\u3002web \u54cd\u5e94\u4e2d\u8fd4\u56de\u7684\u6570\u636e\u53ef\u4ee5\u7531\u7528\u6237\u6d4f\u89c8\u5668\u4ee5\u53ca\u4e2d\u95f4\u4ee3\u7406\u7f13\u5b58\u3002\u8be5\u6307\u4ee4\u901a\u8fc7\u5c06\u5230\u671f\u65f6\u95f4\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u503c\u6765\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u3002"))),(0,a.kt)("li",{parentName:"ul"},"\u8bbf\u95ee\u63a7\u5236",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Access-Control-Allow-Origin\uff1anot ",(0,a.kt)("em",{parentName:"li"},"\u3002'Access-Control-Allow-Origin: "),"' \u9ed8\u8ba4\u5728\u73b0\u4ee3\u6d4f\u89c8\u5668\u4e2d\u7981\u7528"),(0,a.kt)("li",{parentName:"ul"},"X-Permitted-Cross-Domain-Policies\uff1amaster-only\u3002\u6307\u793a\u53ea\u6709\u6307\u5b9a\u7684\u6587\u4ef6\u5728\u6b64\u57df\u4e2d\u624d\u88ab\u89c6\u4e3a\u6709\u6548"))),(0,a.kt)("li",{parentName:"ul"},"\u5185\u5bb9\u5b89\u5168\u7b56\u7565",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Content-Security-Policy\uff1a\u5185\u5bb9\u5b89\u5168\u7b56\u7565\u9700\u8981\u4ed4\u7ec6\u8c03\u6574\u5e76\u7cbe\u786e\u5b9a\u4e49\u7b56\u7565"))),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u4fe1\u606f",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Server\uff1a\u4e0d\u663e\u793a\u3002")))),(0,a.kt)("h2",{id:"\u4f7f\u7528-security-linter-\u63d2\u4ef6"},"\u4f7f\u7528 security-linter \u63d2\u4ef6"),(0,a.kt)("p",null,"\u4f7f\u7528\u5b89\u5168\u68c0\u9a8c\u63d2\u4ef6 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nodesecurity/eslint-plugin-security"},"eslint-plugin-security")," \u6216\u8005 ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/tslint-config-security"},"tslint-config-security"),"\u3002"),(0,a.kt)("h2",{id:"koa-ratelimit-\u9650\u5236\u5e76\u53d1\u8bf7\u6c42"},"koa-ratelimit \u9650\u5236\u5e76\u53d1\u8bf7\u6c42"),(0,a.kt)("p",null,"DOS \u653b\u51fb\u975e\u5e38\u6d41\u884c\u800c\u4e14\u76f8\u5bf9\u5bb9\u6613\u5904\u7406\u3002\u4f7f\u7528\u5916\u90e8\u670d\u52a1\uff0c\u6bd4\u5982 cloud \u8d1f\u8f7d\u5747\u8861, cloud \u9632\u706b\u5899, nginx, \u6216\u8005\uff08\u5bf9\u4e8e\u5c0f\u7684\uff0c\u4e0d\u662f\u90a3\u4e48\u91cd\u8981\u7684app\uff09\u4e00\u4e2a\u901f\u7387\u9650\u5236\u4e2d\u95f4\u4ef6(\u6bd4\u5982 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/koajs/ratelimit"},"koa-ratelimit"),")\uff0c\u6765\u5b9e\u73b0\u901f\u7387\u9650\u5236\u3002"),(0,a.kt)("h2",{id:"\u7eaf\u6587\u672c\u673a\u5bc6\u4fe1\u606f\u653e\u7f6e"},"\u7eaf\u6587\u672c\u673a\u5bc6\u4fe1\u606f\u653e\u7f6e"),(0,a.kt)("p",null,"\u5b58\u50a8\u5728\u6e90\u4ee3\u7801\u7ba1\u7406\u4e2d\u7684\u673a\u5bc6\u4fe1\u606f\u5fc5\u987b\u8fdb\u884c\u52a0\u5bc6\u548c\u7ba1\u7406 (\u6eda\u52a8\u5bc6\u94a5(rolling keys)\u3001\u8fc7\u671f\u65f6\u95f4\u3001\u5ba1\u6838\u7b49)\u3002\u4f7f\u7528 pre-commit/push \u94a9\u5b50\u9632\u6b62\u610f\u5916\u63d0\u4ea4\u673a\u5bc6\u4fe1\u606f\u3002"),(0,a.kt)("h2",{id:"ormodm-\u5e93\u9632\u6b62\u67e5\u8be2\u6ce8\u5165\u6f0f\u6d1e"},"ORM/ODM \u5e93\u9632\u6b62\u67e5\u8be2\u6ce8\u5165\u6f0f\u6d1e"),(0,a.kt)("p",null,"\u8981\u9632\u6b62 SQL/NoSQL \u6ce8\u5165\u548c\u5176\u4ed6\u6076\u610f\u653b\u51fb, \u8bf7\u59cb\u7ec8\u4f7f\u7528 ORM/ODM \u6216 database \u5e93\u6765\u8f6c\u4e49\u6570\u636e\u6216\u652f\u6301\u547d\u540d\u7684\u6216\u7d22\u5f15\u7684\u53c2\u6570\u5316\u67e5\u8be2, \u5e76\u6ce8\u610f\u9a8c\u8bc1\u7528\u6237\u8f93\u5165\u7684\u9884\u671f\u7c7b\u578b\u3002\u4e0d\u8981\u53ea\u4f7f\u7528 JavaScript \u6a21\u677f\u5b57\u7b26\u4e32\u6216\u5b57\u7b26\u4e32\u4e32\u8054\u5c06\u503c\u63d2\u5165\u5230\u67e5\u8be2\u8bed\u53e5\u4e2d, \u56e0\u4e3a\u8fd9\u4f1a\u5c06\u5e94\u7528\u7a0b\u5e8f\u7f6e\u4e8e\u5e7f\u6cdb\u7684\u6f0f\u6d1e\u4e2d\u3002"),(0,a.kt)("p",null,"\u5e93\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"TypeORM"),(0,a.kt)("li",{parentName:"ul"},"sequelize"),(0,a.kt)("li",{parentName:"ul"},"mongoose"),(0,a.kt)("li",{parentName:"ul"},"Knex"),(0,a.kt)("li",{parentName:"ul"},"Objection.js"),(0,a.kt)("li",{parentName:"ul"},"waterline")),(0,a.kt)("h2",{id:"\u4f7f\u7528-bcrypt-\u4ee3\u66ff-crypto"},"\u4f7f\u7528 Bcrypt \u4ee3\u66ff Crypto"),(0,a.kt)("p",null,"\u5bc6\u7801\u6216\u673a\u5bc6\u4fe1\u606f(API \u5bc6\u94a5)\u5e94\u8be5\u4f7f\u7528\u5b89\u5168\u7684 hash + salt \u51fd\u6570(",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/bcrypt"},"bcrypt"),")\u6765\u5b58\u50a8, \u56e0\u4e3a\u6027\u80fd\u548c\u5b89\u5168\u539f\u56e0, \u8fd9\u5e94\u8be5\u662f\u5176 JavaScript \u5b9e\u73b0\u7684\u9996\u9009\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u4f7f\u752810\u4e2a\u54c8\u5e0c\u56de\u5408\u5f02\u6b65\u751f\u6210\u5b89\u5168\u5bc6\u7801\nbcrypt.hash('myPassword', 10, function(err, hash) {\n  // \u5728\u7528\u6237\u8bb0\u5f55\u4e2d\u5b58\u50a8\u5b89\u5168\u54c8\u5e0c\n});\n\n// \u5c06\u63d0\u4f9b\u7684\u5bc6\u7801\u8f93\u5165\u4e0e\u5df2\u4fdd\u5b58\u7684\u54c8\u5e0c\u8fdb\u884c\u6bd4\u8f83\nbcrypt.compare('somePassword', hash, function(err, match) {\n  if(match) {\n   // \u5bc6\u7801\u5339\u914d\n  } else {\n   // \u5bc6\u7801\u4e0d\u5339\u914d\n  } \n});\n")),(0,a.kt)("h2",{id:"\u8f6c\u4e49-htmljs-\u548c-css-\u8f93\u51fa"},"\u8f6c\u4e49 HTML\u3001JS \u548c CSS \u8f93\u51fa"),(0,a.kt)("p",null,"\u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\u7684\u4e0d\u53d7\u4fe1\u4efb\u6570\u636e\u53ef\u80fd\u4f1a\u88ab\u6267\u884c, \u800c\u4e0d\u662f\u663e\u793a, \u8fd9\u901a\u5e38\u88ab\u79f0\u4e3a\u8de8\u7ad9\u70b9\u811a\u672c(XSS)\u653b\u51fb\u3002\u4f7f\u7528\u4e13\u7528\u5e93\u5c06\u6570\u636e\u663e\u5f0f\u6807\u8bb0\u4e3a\u4e0d\u5e94\u6267\u884c\u7684\u7eaf\u6587\u672c\u5185\u5bb9(\u4f8b\u5982:\u7f16\u7801\u3001\u8f6c\u4e49)\uff0c\u53ef\u4ee5\u51cf\u8f7b\u8fd9\u79cd\u95ee\u9898\u3002"),(0,a.kt)("h2",{id:"\u9a8c\u8bc1\u4f20\u5165\u7684-json-schemas"},"\u9a8c\u8bc1\u4f20\u5165\u7684 JSON schemas"),(0,a.kt)("p",null,"\u9a8c\u8bc1\u4f20\u5165\u8bf7\u6c42\u7684 body payload\uff0c\u5e76\u786e\u4fdd\u5176\u7b26\u5408\u9884\u671f\u8981\u6c42, \u5982\u679c\u6ca1\u6709, \u5219\u5feb\u901f\u62a5\u9519\u3002\u4e3a\u4e86\u907f\u514d\u6bcf\u4e2a\u8def\u7531\u4e2d\u7e41\u7410\u7684\u9a8c\u8bc1\u7f16\u7801, \u60a8\u53ef\u4ee5\u4f7f\u7528\u57fa\u4e8e JSON \u7684\u8f7b\u91cf\u7ea7\u9a8c\u8bc1\u67b6\u6784\uff0c\u6bd4\u5982 ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/jsonschema"},"jsonschema")," \u6216 ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/joi"},"joi")),(0,a.kt)("h2",{id:"\u652f\u6301\u9ed1\u540d\u5355\u7684-jwt"},"\u652f\u6301\u9ed1\u540d\u5355\u7684 JWT"),(0,a.kt)("p",null,"\u5f53\u4f7f\u7528 JSON Web Tokens(\u4f8b\u5982, \u901a\u8fc7 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/jaredhanson/passport"},"Passport.js"),"), \u9ed8\u8ba4\u60c5\u51b5\u4e0b, \u6ca1\u6709\u4efb\u4f55\u673a\u5236\u53ef\u4ee5\u4ece\u53d1\u51fa\u7684\u4ee4\u724c\u4e2d\u64a4\u6d88\u8bbf\u95ee\u6743\u9650\u3002\u4e00\u65e6\u53d1\u73b0\u4e86\u4e00\u4e9b\u6076\u610f\u7528\u6237\u6d3b\u52a8, \u53ea\u8981\u5b83\u4eec\u6301\u6709\u6709\u6548\u7684\u6807\u8bb0, \u5c31\u65e0\u6cd5\u963b\u6b62\u4ed6\u4eec\u8bbf\u95ee\u7cfb\u7edf\u3002\u901a\u8fc7\u5b9e\u73b0\u4e00\u4e2a\u4e0d\u53d7\u4fe1\u4efb\u4ee4\u724c\u7684\u9ed1\u540d\u5355\uff0c\u5e76\u5728\u6bcf\u4e2a\u8bf7\u6c42\u4e0a\u9a8c\u8bc1\uff0c\u6765\u51cf\u8f7b\u6b64\u95ee\u9898\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const jwt = require('express-jwt');\nconst blacklist = require('express-jwt-blacklist');\n \napp.use(jwt({\n  secret: 'my-secret',\n  isRevoked: blacklist.isRevoked\n}));\n \napp.get('/logout', function (req, res) {\n  blacklist.revoke(req.user)\n  res.sendStatus(200);\n});\n")),(0,a.kt)("h2",{id:"\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u5141\u8bb8\u7684\u767b\u5f55\u8bf7\u6c42"},"\u9650\u5236\u6bcf\u4e2a\u7528\u6237\u5141\u8bb8\u7684\u767b\u5f55\u8bf7\u6c42"),(0,a.kt)("p",null,"\u4e00\u7c7b\u4fdd\u62a4\u66b4\u529b\u7834\u89e3\u7684\u4e2d\u95f4\u4ef6\uff0c\u6bd4\u5982 express-brute\uff0c\u5e94\u8be5\u88ab\u7528\u5728 express \u7684\u5e94\u7528\u4e2d\uff0c\u6765\u9632\u6b62\u66b4\u529b/\u5b57\u5178\u653b\u51fb\uff1b\u8fd9\u7c7b\u653b\u51fb\u4e3b\u8981\u5e94\u7528\u4e8e\u4e00\u4e9b\u654f\u611f\u8def\u7531\uff0c\u6bd4\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"/admin")," \u6216\u8005 ",(0,a.kt)("inlineCode",{parentName:"p"},"/login"),"\uff0c\u57fa\u4e8e\u67d0\u4e9b\u8bf7\u6c42\u5c5e\u6027, \u5982\u7528\u6237\u540d, \u6216\u5176\u4ed6\u6807\u8bc6\u7b26, \u5982\u6b63\u6587\u53c2\u6570\u7b49\u3002\u5426\u5219\u653b\u51fb\u8005\u53ef\u4ee5\u53d1\u51fa\u65e0\u9650\u5236\u7684\u5bc6\u7801\u5339\u914d\u5c1d\u8bd5, \u4ee5\u83b7\u53d6\u5bf9\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7279\u6743\u5e10\u6237\u7684\u8bbf\u95ee\u6743\u9650\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const ExpressBrute = require('express-brute');\nconst RedisStore = require('express-brute-redis');\n\nconst redisStore = new RedisStore({\n  host: '127.0.0.1',\n  port: 6379\n});\n\n// Start slowing requests after 5 failed \n// attempts to login for the same user\nconst loginBruteforce = new ExpressBrute(redisStore, {\n  freeRetries: 5,\n  minWait: 5 * 60 * 1000, // 5 minutes\n  maxWait: 60 * 60 * 1000, // 1 hour\n  failCallback: failCallback,\n  handleStoreError: handleStoreErrorCallback\n});\n\napp.post('/login',\n  loginBruteforce.getMiddleware({\n    key: function (req, res, next) {\n      // prevent too many attempts for the same username\n      next(req.body.username);\n    }\n  }), // error 403 if we hit this route too often\n  function (req, res, next) {\n    if (User.isValidLogin(req.body.username, req.body.password)) {\n      // reset the failure counter for valid login\n      req.brute.reset(function () {\n        res.redirect('/'); // logged in\n      });\n    } else {\n      // handle invalid user\n    }\n  }\n);\n")),(0,a.kt)("h2",{id:"\u4f7f\u7528\u975e-root-\u7528\u6237\u8fd0\u884c-nodejs"},"\u4f7f\u7528\u975e root \u7528\u6237\u8fd0\u884c Node.js"),(0,a.kt)("p",null,'Node.js \u4f5c\u4e3a\u4e00\u4e2a\u5177\u6709\u65e0\u9650\u6743\u9650\u7684 root \u7528\u6237\u8fd0\u884c\uff0c\u8fd9\u662f\u4e00\u79cd\u666e\u904d\u7684\u60c5\u666f\u3002\u4f8b\u5982\uff0c\u5728 Docker \u5bb9\u5668\u4e2d\uff0c\u8fd9\u662f\u9ed8\u8ba4\u884c\u4e3a\u3002\u5efa\u8bae\u521b\u5efa\u4e00\u4e2a\u975e root \u7528\u6237\uff0c\u5e76\u4fdd\u5b58\u5230 Docker \u955c\u50cf\u4e2d\uff08\u4e0b\u9762\u7ed9\u51fa\u4e86\u793a\u4f8b\uff09\uff0c\u6216\u8005\u901a\u8fc7\u8c03\u7528\u5e26\u6709"-u username" \u7684\u5bb9\u5668\u6765\u4ee3\u8868\u6b64\u7528\u6237\u8fd0\u884c\u8be5\u8fdb\u7a0b\u3002\u5426\u5219\u5728\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u811a\u672c\u7684\u653b\u51fb\u8005\u5728\u672c\u5730\u8ba1\u7b97\u673a\u4e0a\u83b7\u5f97\u65e0\u9650\u5236\u7684\u6743\u5229 (\u4f8b\u5982\uff0c\u6539\u53d8 iptable\uff0c\u5f15\u6d41\u5230\u4ed6\u7684\u670d\u52a1\u5668\u4e0a)'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-dockerfile"},'FROM node:latest\nCOPY package.json .\nRUN npm install\nCOPY . .\nEXPOSE 3000\nUSER node\nCMD ["node", "server.js"]\n')),(0,a.kt)("h2",{id:"\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\u6216\u4e2d\u95f4\u4ef6\u9650\u5236\u8d1f\u8f7d\u5927\u5c0f"},"\u4f7f\u7528\u53cd\u5411\u4ee3\u7406\u6216\u4e2d\u95f4\u4ef6\u9650\u5236\u8d1f\u8f7d\u5927\u5c0f"),(0,a.kt)("p",null,"\u8bf7\u6c42 body \u6709\u6548\u8f7d\u8377\u8d8a\u5927, Node.js \u7684\u5355\u7ebf\u7a0b\u5c31\u8d8a\u96be\u5904\u7406\u5b83\u3002\u8fd9\u662f\u653b\u51fb\u8005\u5728\u6ca1\u6709\u5927\u91cf\u8bf7\u6c42(DOS/DDOS \u653b\u51fb)\u7684\u60c5\u51b5\u4e0b\uff0c\u5c31\u53ef\u4ee5\u8ba9\u670d\u52a1\u5668\u8dea\u4e0b\u7684\u673a\u4f1a\u3002\u5728\u8fb9\u7f18\u4e0a\uff08\u4f8b\u5982\uff0c\u9632\u706b\u5899\uff0cELB\uff09\u9650\u5236\u4f20\u5165\u8bf7\u6c42\u7684 body \u5927\u5c0f\uff0c\u6216\u8005\u901a\u8fc7\u914d\u7f6e ",(0,a.kt)("inlineCode",{parentName:"p"},"express body parser")," \u4ec5\u63a5\u6536\u5c0f\u7684\u8f7d\u8377\uff0c\u53ef\u4ee5\u51cf\u8f7b\u8fd9\u79cd\u95ee\u9898\u3002\u5426\u5219\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u4e0d\u5f97\u4e0d\u5904\u7406\u5927\u7684\u8bf7\u6c42, \u65e0\u6cd5\u5904\u7406\u5b83\u5fc5\u987b\u5b8c\u6210\u7684\u5176\u4ed6\u91cd\u8981\u5de5\u4f5c, \u4ece\u800c\u5bfc\u81f4\u5bf9 DOS \u653b\u51fb\u7684\u6027\u80fd\u5f71\u54cd\u548c\u8106\u5f31\u6027\u3002"),(0,a.kt)("p",null,"express\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const express = require('express');\n\nconst app = express();\n\n// body-parser defaults to a body size limit of 300kb\napp.use(express.json({ limit: '300kb' })); \n\n// Request with json body\napp.post('/json', (req, res) => {\n\n    // Check if request payload content-type matches json\n    // because body-parser does not check for content types\n    if (!req.is('json')) {\n        return res.sendStatus(415); // Unsupported media type if request doesn't have JSON body\n    }\n\n    res.send('Hooray, it worked!');\n});\n\napp.listen(3000, () => console.log('Example app listening on port 3000!'));\n")),(0,a.kt)("p",null,"nginx\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"http {\n    ...\n    # Limit the body size for ALL incoming requests to 1 MB\n    client_max_body_size 1m;\n}\n\nserver {\n    ...\n    # Limit the body size for incoming requests to this specific server block to 1 MB\n    client_max_body_size 1m;\n}\n\nlocation /upload {\n    ...\n    # Limit the body size for incoming requests to this route to 1 MB\n    client_max_body_size 1m;\n}\n")),(0,a.kt)("h2",{id:"\u9632\u6b62-regex-\u8ba9-nodejs-\u8fc7\u8f7d"},"\u9632\u6b62 RegEx \u8ba9 NodeJS \u8fc7\u8f7d"),(0,a.kt)("p",null,"\u5339\u914d\u6587\u672c\u7684\u7528\u6237\u8f93\u5165\u9700\u8981\u5927\u91cf\u7684 CPU \u5468\u671f\u6765\u5904\u7406\u3002\u5728\u67d0\u79cd\u7a0b\u5ea6\u4e0a\uff0c\u6b63\u5219\u5904\u7406\u662f\u6548\u7387\u4f4e\u4e0b\u7684\uff0c\u6bd4\u5982\u9a8c\u8bc1 10 \u4e2a\u5355\u8bcd\u7684\u5355\u4e2a\u8bf7\u6c42\u53ef\u80fd\u963b\u6b62\u6574\u4e2a event loop \u957f\u8fbe6\u79d2\u3002\u7531\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u504f\u5411\u7b2c\u4e09\u65b9\u7684\u9a8c\u8bc1\u5305\uff0c\u6bd4\u5982",(0,a.kt)("a",{parentName:"p",href:"https://github.com/chriso/validator.js"},"validator.js"),"\uff0c\u800c\u4e0d\u662f\u91c7\u7528\u6b63\u5219\uff0c\u6216\u8005\u4f7f\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/substack/safe-regex"},"safe-regex")," \u6765\u68c0\u6d4b\u6709\u95ee\u9898\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const saferegex = require('safe-regex');\nconst emailRegex = /^([a-zA-Z0-9])(([\\-.]|[_]+)?([a-zA-Z0-9]+))*(@){1}[a-z0-9]+[.]{1}(([a-z]{2,3})|([a-z]{2,3}[.]{1}[a-z]{2,3}))$/;\n\n// should output false because the emailRegex is vulnerable to redos attacks\nconsole.log(saferegex(emailRegex));\n\n// instead of the regex pattern, use validator:\nconst validator = require('validator');\nconsole.log(validator.isEmail('liran.tal@gmail.com'));\n")),(0,a.kt)("h2",{id:"\u5728\u6c99\u7bb1\u4e2d\u8fd0\u884c\u4e0d\u5b89\u5168\u4ee3\u7801"},"\u5728\u6c99\u7bb1\u4e2d\u8fd0\u884c\u4e0d\u5b89\u5168\u4ee3\u7801"),(0,a.kt)("p",null,"\u5f53\u4efb\u52a1\u6267\u884c\u5728\u8fd0\u884c\u65f6\u7ed9\u51fa\u7684\u5916\u90e8\u4ee3\u7801\u65f6(\u4f8b\u5982, \u63d2\u4ef6), \u4f7f\u7528\u4efb\u4f55\u7c7b\u578b\u7684\u6c99\u76d2\u6267\u884c\u73af\u5883\u4fdd\u62a4\u4e3b\u4ee3\u7801\uff0c\u5e76\u9694\u79bb\u5f00\u4e3b\u4ee3\u7801\u548c\u63d2\u4ef6\u3002\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u4e13\u7528\u7684\u8fc7\u7a0b\u6765\u5b9e\u73b0 (\u4f8b\u5982:cluster.fork()), \u65e0\u670d\u52a1\u5668\u73af\u5883\u6216\u5145\u5f53\u6c99\u76d2\u7684\u4e13\u7528 npm \u5305\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u4e13\u95e8\u7684\u5b50\u8fdb\u7a0b - \u8fd9\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5feb\u901f\u7684\u4fe1\u606f\u9694\u79bb, \u4f46\u8981\u6c42\u5236\u7ea6\u5b50\u8fdb\u7a0b, \u9650\u5236\u5176\u6267\u884c\u65f6\u95f4, \u5e76\u4ece\u9519\u8bef\u4e2d\u6062\u590d"),(0,a.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u57fa\u4e8e\u4e91\u7684\u65e0\u670d\u52a1\u6846\u67b6\u6ee1\u8db3\u6240\u6709\u6c99\u76d2\u8981\u6c42\uff0c\u4f46\u52a8\u6001\u90e8\u7f72\u548c\u8c03\u7528Faas\u65b9\u6cd5\u4e0d\u662f\u672c\u90e8\u5206\u7684\u5185\u5bb9"),(0,a.kt)("li",{parentName:"ul"},"\u4e00\u4e9b npm \u5e93\uff0c\u6bd4\u5982 ",(0,a.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/sandbox"},"sandbox")," \u548c ",(0,a.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/vm2"},"vm2")," \u5141\u8bb8\u901a\u8fc7\u4e00\u884c\u4ee3\u7801\u6267\u884c\u9694\u79bb\u4ee3\u7801\u3002\u5c3d\u7ba1\u540e\u4e00\u79cd\u9009\u62e9\u5728\u7b80\u5355\u4e2d\u83b7\u80dc, \u4f46\u5b83\u63d0\u4f9b\u4e86\u6709\u9650\u7684\u4fdd\u62a4\u3002")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const Sandbox = require("sandbox");\nconst s = new Sandbox();\n\ns.run( "lol)hai", function( output ) {\n  console.log(output);\n  //output=\'Synatx error\'\n});\n\n// Example 4 - Restricted code\ns.run( "process.platform", function( output ) {\n  console.log(output);\n  //output=Null\n})\n\n// Example 5 - Infinite loop\ns.run( "while (true) {}", function( output ) {\n  console.log(output);\n  //output=\'Timeout\'\n})\n')),(0,a.kt)("h2",{id:"\u9690\u85cf\u5ba2\u6237\u7aef\u7684\u9519\u8bef\u8be6\u7ec6\u4fe1\u606f"},"\u9690\u85cf\u5ba2\u6237\u7aef\u7684\u9519\u8bef\u8be6\u7ec6\u4fe1\u606f"),(0,a.kt)("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b, \u96c6\u6210\u7684 express \u9519\u8bef\u5904\u7406\u7a0b\u5e8f\u9690\u85cf\u9519\u8bef\u8be6\u7ec6\u4fe1\u606f\u3002\u4f46\u662f, \u6781\u6709\u53ef\u80fd, \u60a8\u5b9e\u73b0\u81ea\u5df1\u7684\u9519\u8bef\u5904\u7406\u903b\u8f91\u4e0e\u81ea\u5b9a\u4e49\u9519\u8bef\u5bf9\u8c61(\u88ab\u8bb8\u591a\u4eba\u8ba4\u4e3a\u662f\u6700\u4f73\u505a\u6cd5)\u3002\u5982\u679c\u8fd9\u6837\u505a, \u8bf7\u786e\u4fdd\u4e0d\u5c06\u6574\u4e2a Error \u5bf9\u8c61\u8fd4\u56de\u5230\u5ba2\u6237\u7aef, \u8fd9\u53ef\u80fd\u5305\u542b\u4e00\u4e9b\u654f\u611f\u7684\u5e94\u7528\u7a0b\u5e8f\u8be6\u7ec6\u4fe1\u606f\u3002\u5426\u5219\u654f\u611f\u5e94\u7528\u7a0b\u5e8f\u8be6\u7ec6\u4fe1\u606f(\u5982\u670d\u52a1\u5668\u6587\u4ef6\u8def\u5f84\u3001\u4f7f\u7528\u4e2d\u7684\u7b2c\u4e09\u65b9\u6a21\u5757\u548c\u53ef\u80fd\u88ab\u653b\u51fb\u8005\u5229\u7528\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u5176\u4ed6\u5185\u90e8\u5de5\u4f5c\u6d41)\u53ef\u80fd\u4f1a\u4ece stack trace \u53d1\u73b0\u7684\u4fe1\u606f\u4e2d\u6cc4\u9732\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"// production error handler\n// no stacktraces leaked to user\napp.use(function(err, req, res, next) {\n    res.status(err.status || 500);\n    res.render('error', {\n        message: err.message,\n        error: {}\n    });\n});\n")),(0,a.kt)("h2",{id:"\u5bf9-npm-\u6216-yarn\u914d\u7f6e-2fa"},"\u5bf9 npm \u6216 Yarn\uff0c\u914d\u7f6e 2FA"),(0,a.kt)("p",null,"\u5f00\u53d1\u94fe\u4e2d\u7684\u4efb\u4f55\u6b65\u9aa4\u90fd\u5e94\u4f7f\u7528 MFA(\u591a\u91cd\u8eab\u4efd\u9a8c\u8bc1)\u8fdb\u884c\u4fdd\u62a4, npm/Yarn \u5bf9\u4e8e\u90a3\u4e9b\u80fd\u591f\u638c\u63e1\u67d0\u4e9b\u5f00\u53d1\u4eba\u5458\u5bc6\u7801\u7684\u653b\u51fb\u8005\u6765\u8bf4\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u673a\u4f1a\u3002\u4f7f\u7528\u5f00\u53d1\u4eba\u5458\u51ed\u636e, \u653b\u51fb\u8005\u53ef\u4ee5\u5411\u8de8\u9879\u76ee\u548c\u670d\u52a1\u5e7f\u6cdb\u5b89\u88c5\u7684\u5e93\u4e2d\u6ce8\u5165\u6076\u610f\u4ee3\u7801\u3002\u751a\u81f3\u53ef\u80fd\u5728\u7f51\u7edc\u4e0a\u516c\u5f00\u53d1\u5e03\u3002\u5728 npm \u4e2d\u542f\u7528\u4e24\u5c42\u8eab\u4efd\u9a8c\u8bc1\uff082-factor-authentication\uff09, \u653b\u51fb\u8005\u51e0\u4e4e\u6ca1\u6709\u673a\u4f1a\u6539\u53d8\u60a8\u7684\u8f6f\u4ef6\u5305\u4ee3\u7801\u3002"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://itnext.io/eslint-backdoor-what-it-is-and-how-to-fix-the-issue-221f58f1a8c8"},"https://itnext.io/eslint-backdoor-what-it-is-and-how-to-fix-the-issue-221f58f1a8c8")),(0,a.kt)("h2",{id:"session-\u4e2d\u95f4\u4ef6\u8bbe\u7f6e"},"session \u4e2d\u95f4\u4ef6\u8bbe\u7f6e"),(0,a.kt)("p",null,"\u6bcf\u4e2a web \u6846\u67b6\u548c\u6280\u672f\u90fd\u6709\u5176\u5df2\u77e5\u7684\u5f31\u70b9\uff0c\u544a\u8bc9\u653b\u51fb\u8005\u6211\u4eec\u4f7f\u7528\u7684 web \u6846\u67b6\u5bf9\u4ed6\u4eec\u6765\u8bf4\u662f\u5f88\u5927\u7684\u5e2e\u52a9\u3002\u4f7f\u7528 session \u4e2d\u95f4\u4ef6\u7684\u9ed8\u8ba4\u8bbe\u7f6e, \u53ef\u4ee5\u4ee5\u7c7b\u4f3c\u4e8e ",(0,a.kt)("inlineCode",{parentName:"p"},"X-Powered-Byheader")," \u7684\u65b9\u5f0f\u5411\u6a21\u5757\u548c\u6846\u67b6\u7279\u5b9a\u7684\u52ab\u6301\u653b\u51fb\u516c\u5f00\u60a8\u7684\u5e94\u7528\u3002\u5c1d\u8bd5\u9690\u85cf\u8bc6\u522b\u548c\u63ed\u9732\u6280\u672f\u6808\u7684\u4efb\u4f55\u5185\u5bb9(\u4f8b\u5982:Nonde.js, express)\u3002\u5426\u5219\u53ef\u4ee5\u901a\u8fc7\u4e0d\u5b89\u5168\u7684\u8fde\u63a5\u53d1\u9001cookie, \u653b\u51fb\u8005\u53ef\u80fd\u4f1a\u4f7f\u7528\u4f1a\u8bdd\u6807\u8bc6\u6765\u6807\u8bc6web\u5e94\u7528\u7a0b\u5e8f\u7684\u57fa\u7840\u6846\u67b6\u4ee5\u53ca\u7279\u5b9a\u4e8e\u6a21\u5757\u7684\u6f0f\u6d1e\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// using the express session middleware\napp.use(session({  \n secret: 'youruniquesecret', // secret string used in the signing of the session ID that is stored in the cookie\n name: 'youruniquename', // set a unique name to remove the default connect.sid\n cookie: {\n   httpOnly: true, // minimize risk of XSS attacks by restricting the client from reading the cookie\n   secure: true, // only send cookie over https\n   maxAge: 60000*60*24 // set cookie expiry length in ms\n }\n}));\n")),(0,a.kt)("h2",{id:"csurf-\u9632\u6b62-csrf"},"csurf \u9632\u6b62 CSRF"),(0,a.kt)("p",null,"\u8def\u7531\u5c42\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"var cookieParser = require('cookie-parser');  \nvar csrf = require('csurf');  \nvar bodyParser = require('body-parser');  \nvar express = require('express');\n\n// \u8bbe\u7f6e\u8def\u7531\u4e2d\u95f4\u4ef6\nvar csrfProtection = csrf({ cookie: true });  \nvar parseForm = bodyParser.urlencoded({ extended: false });\n\nvar app = express();\n\n// \u6211\u4eec\u9700\u8981\u8fd9\u4e2a\uff0c\u56e0\u4e3a\u5728 csrfProtection \u4e2d \u201ccookie\u201d \u662f\u6b63\u786e\u7684\napp.use(cookieParser());\n\napp.get('/form', csrfProtection, function(req, res) {  \n  // \u5c06 CSRFToken \u4f20\u9012\u7ed9\u89c6\u56fe\n  res.render('send', { csrfToken: req.csrfToken() });\n});\n\napp.post('/process', parseForm, csrfProtection, function(req, res) {  \n  res.send('data is being processed');\n});\n")),(0,a.kt)("p",null,"\u5c55\u793a\u5c42\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<form action="/process" method="POST">  \n  <input type="hidden" name="_csrf" value="{{csrfToken}}">\n\n  Favorite color: <input type="text" name="favoriteColor">\n  <button type="submit">Submit</button>\n</form>  \n')),(0,a.kt)("h1",{id:"\u7efc\u5408\u5e94\u7528"},"\u7efc\u5408\u5e94\u7528"),(0,a.kt)("h2",{id:"watch-\u670d\u52a1"},"watch \u670d\u52a1"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fs = require('fs');\nconst exec = require('child_process').exec;\n\nfunction watch() {\n  const child = exec('node server.js');\n  const watcher = fs.watch(__dirname + '/server.js', function () {\n    console.log('File changed, reloading.');\n    child.kill();\n    watcher.close();\n    watch();\n  });\n}\n\nwatch();\n")),(0,a.kt)("h2",{id:"restful-web-\u5e94\u7528"},"RESTful web \u5e94\u7528"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"REST \u610f\u601d\u662f\u8868\u5f81\u6027\u72b6\u6001\u4f20\u8f93")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"\u4f7f\u7528\u6b63\u786e\u7684 HTTP \u65b9\u6cd5\u3001URLs \u548c\u5934\u90e8\u4fe1\u606f\u6765\u521b\u5efa\u8bed\u4e49\u5316 RESTful API")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"GET /gages\uff1a\u83b7\u53d6")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"POST /pages\uff1a\u521b\u5efa")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"GET /pages/10\uff1a\u83b7\u53d6 pages10")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"PATCH /pages/10\uff1a\u66f4\u65b0 pages10")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"PUT /pages/10\uff1a\u66ff\u6362 pages10")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"DELETE /pages/10\uff1a\u5220\u9664 pages10"))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"let app;\nconst express = require('express');\nconst routes = require('./routes');\n\nmodule.exports = app = express();\n\napp.use(express.json()); // \u4f7f\u7528 JSON body \u89e3\u6790\napp.use(express.methodOverride()); // \u5141\u8bb8\u4e00\u4e2a\u67e5\u8be2\u53c2\u6570\u6765\u5236\u5b9a\u989d\u5916\u7684 HTTP \u65b9\u6cd5\n\n// \u8d44\u6e90\u4f7f\u7528\u7684\u8def\u7531\napp.get('/pages', routes.pages.index);\napp.get('/pages/:id', routes.pages.show);\napp.post('/pages', routes.pages.create);\napp.patch('/pages/:id', routes.pages.patch);\napp.put('/pages/:id', routes.pages.update);\napp.del('/pages/:id', routes.pages.remove);\n")),(0,a.kt)("h2",{id:"\u4e2d\u95f4\u4ef6\u5e94\u7528"},"\u4e2d\u95f4\u4ef6\u5e94\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const express = require('express');\nconst app = express();\nconst Schema = require('validate');\nconst xml2json = require('xml2json');\nconst util = require('util');\nconst Page = new Schema();\n\nPage.path('title').type('string').required(); // \u6570\u636e\u6821\u9a8c\u786e\u4fdd\u9875\u9762\u6709\u6807\u9898\n\nfunction ValidatorError(errors) { // \u4ece\u9519\u8bef\u5bf9\u8c61\u7ee7\u627f\uff0c\u6821\u9a8c\u51fa\u73b0\u7684\u9519\u8bef\u5728\u9519\u8bef\u4e2d\u95f4\u4ef6\u5904\u7406\n  this.statusCode = 400;\n  this.message = errors.join(', ');\n}\nutil.inherits(ValidatorError, Error);\n\nfunction xmlMiddleware(req, res, next) { // \u5904\u7406 xml \u7684\u4e2d\u95f4\u4ef6\n  if (!req.is('xml')) return next();\n\n  let body = '';\n  req.on('data', function (str) { // \u4ece\u5ba2\u6237\u7aef\u8bfb\u5230\u6570\u636e\u65f6\u89e6\u53d1\n    body += str;\n  });\n\n  req.on('end', function () {\n    req.body = xml2json.toJson(body.toString(), {\n      object: true,\n      sanitize: false,\n    });\n    next();\n  });\n}\n\nfunction checkValidXml(req, res, next) { // \u6570\u636e\u6821\u9a8c\u4e2d\u95f4\u4ef6\n  const page = Page.validate(req.body.page);\n  if (page.errors.length) {\n    next(new ValidatorError(page.errors)); // \u4f20\u9012\u9519\u8bef\u7ed9 next \u963b\u6b62\u8def\u7531\u7ee7\u7eed\u8fd0\u884c\n  } else {\n    next();\n  }\n}\n\nfunction errorHandler(err, req, res, next) { // \u9519\u8bef\u5904\u7406\u4e2d\u95f4\u4ef6\n  console.error('errorHandler', err);\n  res.send(err.statusCode || 500, err.message);\n}\n\napp.use(xmlMiddleware); // \u5e94\u7528 XML \u4e2d\u95f4\u4ef6\u5230\u6240\u6709\u7684\u8bf7\u6c42\u4e2d\n\napp.post('/pages', checkValidXml, function (req, res) { // \u7279\u5b9a\u7684\u8bf7\u6c42\u6821\u9a8c xml\n  console.log('Valid page:', req.body.page);\n  res.send(req.body);\n});\n\napp.use(errorHandler); // \u6dfb\u52a0\u9519\u8bef\u5904\u7406\u4e2d\u95f4\u4ef6\n\napp.listen(3000);\n")),(0,a.kt)("h2",{id:"\u901a\u8fc7\u4e8b\u4ef6\u7ec4\u7ec7\u5e94\u7528"},"\u901a\u8fc7\u4e8b\u4ef6\u7ec4\u7ec7\u5e94\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u76d1\u542c\u7528\u6237\u6ce8\u518c\u6210\u529f\u6d88\u606f\uff0c\u7ed1\u5b9a\u90ae\u4ef6\u7a0b\u5e8f\nconst express = require('express');\nconst app = express();\nconst emails = require('./emails');\nconst routes = require('./routes');\n\napp.use(express.json());\n\napp.post('/users', routes.users.create); // \u8bbe\u7f6e\u8def\u7531\u521b\u5efa\u7528\u6237\n\napp.on('user:created', emails.welcome); // \u76d1\u542c\u521b\u5efa\u6210\u529f\u4e8b\u4ef6\uff0c\u7ed1\u5b9a email \u4ee3\u7801\n\nmodule.exports = app;\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"// \u7528\u6237\u6ce8\u518c\u6210\u529f\u53d1\u8d77\u4e8b\u4ef6\nconst User = require('./../models/user');\n\nmodule.exports.create = function (req, res, next) {\n  const user = new User(req.body);\n  user.save(function (err) {\n    if (err) return next(err);\n    res.app.emit('user:created', user); // \u5f53\u7528\u6237\u6210\u529f\u6ce8\u518c\u65f6\u89e6\u53d1\u521b\u5efa\u7528\u6237\u4e8b\u4ef6\n    res.send('User created');\n  });\n};\n")),(0,a.kt)("h2",{id:"websocket-\u4e0e-session"},"WebSocket \u4e0e session"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const express = require('express');\nconst WebSocketServer = require('ws').Server;\nconst parseCookie = express.cookieParser('some secret'); // \u52a0\u8f7d\u89e3\u6790 cookie \u4e2d\u95f4\u4ef6\uff0c\u8bbe\u7f6e\u5bc6\u7801\nconst MemoryStore = express.session.MemoryStore; // \u52a0\u8f7d\u8981\u4f7f\u7528\u7684\u4f1a\u8bdd\u5b58\u50a8\nconst store = new MemoryStore();\n\nconst app = express();\nconst server = app.listen(process.env.PORT || 3000);\n\napp.use(parseCookie);\napp.use(express.session({ store: store, secret: 'some secret' })); // \u544a\u77e5 Express \u4f7f\u7528\u4f1a\u8bdd\u5b58\u50a8\u548c\u8bbe\u7f6e\u5bc6\u7801(\u4f7f\u7528 session \u4e2d\u95f4\u4ef6)\napp.use(express.static(__dirname + '/public'));\n\napp.get('/random', function (req, res) { // \u6d4b\u8bd5\u6d4b\u8bd5\u7528\u7684\u4f1a\u8bdd\u503c\n  req.session.random = Math.random().toString();\n  res.send(200);\n});\n\n// \u8bbe\u7f6e WebSocket \u670d\u52a1\u5668\uff0c\u5c06\u5176\u4f20\u9012\u7ed9 Express \u670d\u52a1\u5668\n// \u9700\u8981\u4f20\u9012\u5df2\u6709\u7684 Express \u670d\u52a1\uff08listen \u7684\u8fd4\u56de\u5bf9\u8c61\uff09\nconst webSocketServer = new WebSocketServer({ server: server });\n\n// \u5728\u8fde\u63a5\u4e8b\u4ef6\u7ed9\u5ba2\u6237\u7aef\u521b\u5efa WebSocket\nwebSocketServer.on('connection', function (ws) {\n  let session;\n\n  ws.on('message', function (data, flags) {\n    const message = JSON.parse(data);\n\n    // \u5ba2\u6237\u7aef\u53d1\u9001\u7684 JSON\uff0c\u9700\u8981\u4e00\u4e9b\u4ee3\u7801\u6765\u89e3\u6790 JSON \u5b57\u7b26\u4e32\u786e\u5b9a\u662f\u5426\u53ef\u7528\n    if (message.type === 'getSession') {\n      parseCookie(ws.upgradeReq, null, function (err) {\n        // \u4ece HTTP \u7684\u66f4\u65b0\u8bf7\u6c42\u4e2d\u83b7\u53d6 WebSocket \u7684\u4f1a\u8bdd ID\n        // \u4e00\u65e6 WebSockets \u670d\u52a1\u5668\u6709\u4e00\u4e2a\u8fde\u63a5\uff0csession ID \u53ef\u4ee5\u7528=\u4ece\u521d\u59cb\u5316\u8bf7\u6c42\u4e2d\u7684 cookies \u4e2d\u83b7\u53d6\n        const sid = ws.upgradeReq.signedCookies['connect.sid'];\n\n        // \u4ece\u5b58\u50a8\u4e2d\u83b7\u53d6\u7528\u6237\u7684\u4f1a\u8bdd\u4fe1\u606f\n        // \u53ea\u9700\u8981\u5728\u521d\u59cb\u5316\u7684\u8bf7\u6c42\u4e2d\u4f20\u9012\u4e00\u4e2a\u5f15\u7528\u7ed9\u89e3\u6790 cookie \u7684\u4e2d\u95f4\u4ef6\n        // \u7136\u540e session \u53ef\u4ee5\u4f7f\u7528 session \u5b58\u50a8\u7684 get \u65b9\u6cd5\u52a0\u8f7d\n        store.get(sid, function (err, loadedSession) {\n          if (err) console.error(err);\n          session = loadedSession;\n          ws.send('session.random: ' + session.random, {\n            mask: false,\n          }); // session \u52a0\u8f7d\u540e\u4f1a\u628a\u4e00\u4e2a\u5305\u542b\u4e86 session \u503c\u7684\u6d88\u606f\u53d1\u56de\u7ed9\u5ba2\u6237\u7aef\n        });\n      });\n    } else {\n      ws.send('Unknown command');\n    }\n  });\n});\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},"<!DOCTYPE html>\n<html>\n\n<head>\n  <script>\n    const host = window.document.location.host.replace(/:.*/, '');\n    const ws = new WebSocket('ws://' + host + ':3000');\n\n    setInterval(function () {\n      ws.send('{ \"type\": \"getSession\" }'); // \u5b9a\u671f\u5411\u670d\u52a1\u5668\u53d1\u9001\u6d88\u606f\n    }, 1000);\n\n    ws.onmessage = function (event) {\n      document.getElementById('message').innerHTML = event.data;\n    };\n  <\/script>\n</head>\n\n<body>\n  <h1>WebSocket sessions</h1>\n  <div id='message'></div><br>\n</body>\n\n</html>\n")),(0,a.kt)("h2",{id:"express4-\u4e2d\u95f4\u4ef6"},"Express4 \u4e2d\u95f4\u4ef6"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"package"),(0,a.kt)("th",{parentName:"tr",align:null},"\u63cf\u8ff0"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"body-parser"),(0,a.kt)("td",{parentName:"tr",align:null},"\u89e3\u6790 URL \u7f16\u7801 \u548c JSON POST \u8bf7\u6c42\u7684 body \u6570\u636e")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"compression"),(0,a.kt)("td",{parentName:"tr",align:null},"\u538b\u7f29\u670d\u52a1\u5668\u54cd\u5e94")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"connect-timeout"),(0,a.kt)("td",{parentName:"tr",align:null},"\u8bf7\u6c42\u5141\u8bb8\u8d85\u65f6")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"cookie-parser"),(0,a.kt)("td",{parentName:"tr",align:null},"\u4ece HTTP \u5934\u90e8\u4fe1\u606f\u4e2d\u89e3\u6790 cookies\uff0c\u7ed3\u679c\u653e\u5728 req.cookies")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"cookie-session"),(0,a.kt)("td",{parentName:"tr",align:null},"\u4f7f\u7528 cookies \u6765\u652f\u6301\u7b80\u5355\u4f1a\u8bdd")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"csurf"),(0,a.kt)("td",{parentName:"tr",align:null},"\u5728\u4f1a\u8bdd\u4e2d\u6dfb\u52a0 token\uff0c\u9632\u5fa1 CSRF \u653b\u51fb")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"errorhandler"),(0,a.kt)("td",{parentName:"tr",align:null},"Connect \u4e2d\u4f7f\u7528\u7684\u9ed8\u8ba4\u9519\u8bef\u5904\u7406")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"express-session"),(0,a.kt)("td",{parentName:"tr",align:null},"\u7b80\u5355\u7684\u4f1a\u8bdd\u5904\u7406\uff0c\u4f7f\u7528 stores \u6269\u5c55\u6765\u5427\u4f1a\u8bdd\u4fe1\u606f\u5199\u5165\u5230\u6570\u636e\u5e93\u6216\u6587\u4ef6\u4e2d")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"method-override"),(0,a.kt)("td",{parentName:"tr",align:null},"\u6620\u5c04\u65b0\u7684 HTTP \u52a8\u8bcd\u5230\u8bf7\u6c42\u53d8\u91cf\u4e2d\u7684 _method")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"morgan"),(0,a.kt)("td",{parentName:"tr",align:null},"\u65e5\u5fd7\u683c\u5f0f\u5316")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"response-time"),(0,a.kt)("td",{parentName:"tr",align:null},"\u8ddf\u8e2a\u54cd\u5e94\u65f6\u95f4")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"serve-favicon"),(0,a.kt)("td",{parentName:"tr",align:null},"\u53d1\u9001\u7f51\u7ad9\u56fe\u6807")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"serve-index"),(0,a.kt)("td",{parentName:"tr",align:null},"\u76ee\u5f55\u5217\u8868")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"whost"),(0,a.kt)("td",{parentName:"tr",align:null},"\u5141\u8bb8\u8def\u7531\u5339\u914d\u5b50\u57df\u540d")))),(0,a.kt)("h2",{id:"jwt"},"JWT"),(0,a.kt)("p",null,"JSON Web Token\uff08\u7f29\u5199 JWT\uff09\u662f\u76ee\u524d\u6700\u6d41\u884c\u7684\u8de8\u57df\u8ba4\u8bc1\u89e3\u51b3\u65b9\u6848\u3002"),(0,a.kt)("h3",{id:"\u8de8\u57df\u8ba4\u8bc1"},"\u8de8\u57df\u8ba4\u8bc1"),(0,a.kt)("h4",{id:"\u4e00\u822c\u6d41\u7a0b"},"\u4e00\u822c\u6d41\u7a0b"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u7528\u6237\u5411\u670d\u52a1\u5668\u53d1\u9001\u7528\u6237\u540d\u548c\u5bc6\u7801"),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u9a8c\u8bc1\u901a\u8fc7\u540e\uff0c\u5728\u5f53\u524d\u5bf9\u8bdd\uff08session\uff09\u91cc\u9762\u4fdd\u5b58\u76f8\u5173\u6570\u636e\uff0c\u6bd4\u5982\u7528\u6237\u89d2\u8272\u3001\u767b\u5f55\u65f6\u95f4\u7b49\u7b49"),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u5411\u7528\u6237\u8fd4\u56de\u4e00\u4e2a session_id\uff0c\u5199\u5165\u7528\u6237\u7684 Cookie"),(0,a.kt)("li",{parentName:"ul"},"\u7528\u6237\u968f\u540e\u7684\u6bcf\u4e00\u6b21\u8bf7\u6c42\uff0c\u90fd\u4f1a\u901a\u8fc7 Cookie\uff0c\u5c06 session_id \u4f20\u56de\u670d\u52a1\u5668"),(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u6536\u5230 session_id\uff0c\u627e\u5230\u524d\u671f\u4fdd\u5b58\u7684\u6570\u636e\uff0c\u7531\u6b64\u5f97\u77e5\u7528\u6237\u7684\u8eab\u4efd")),(0,a.kt)("h4",{id:"session-\u5171\u4eab"},"session \u5171\u4eab"),(0,a.kt)("p",null,"\u5728\u670d\u52a1\u5668\u96c6\u7fa4\uff0c\u8981\u6c42 session \u6570\u636e\u5171\u4eab\uff0c\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u80fd\u591f\u8bfb\u53d6 session\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\u662f session \u6570\u636e\u6301\u4e45\u5316\uff0c\u5199\u5165\u6570\u636e\u5e93\u6216\u522b\u7684\u6301\u4e45\u5c42\u3002\u5404\u79cd\u670d\u52a1\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u90fd\u5411\u6301\u4e45\u5c42\u8bf7\u6c42\u6570\u636e\u3002\u8fd9\u79cd\u65b9\u6848\u7684\u4f18\u70b9\u662f\u67b6\u6784\u6e05\u6670\uff0c\u7f3a\u70b9\u662f\u5de5\u7a0b\u91cf\u6bd4\u8f83\u5927\u3002\u53e6\u5916\uff0c\u6301\u4e45\u5c42\u4e07\u4e00\u6302\u4e86\uff0c\u5c31\u4f1a\u5355\u70b9\u5931\u8d25\u3002"),(0,a.kt)("li",{parentName:"ul"},"\u53e6\u4e00\u79cd\u65b9\u6848\u662f\u670d\u52a1\u5668\u7d22\u6027\u4e0d\u4fdd\u5b58 session \u6570\u636e\u4e86\uff0c\u6240\u6709\u6570\u636e\u90fd\u4fdd\u5b58\u5728\u5ba2\u6237\u7aef\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u53d1\u56de\u670d\u52a1\u5668\u3002JWT \u5c31\u662f\u8fd9\u79cd\u65b9\u6848\u7684\u4e00\u4e2a\u4ee3\u8868\u3002")),(0,a.kt)("h3",{id:"jwt-1"},"JWT"),(0,a.kt)("h4",{id:"\u539f\u7406"},"\u539f\u7406"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u670d\u52a1\u5668\u8ba4\u8bc1\u4ee5\u540e\uff0c\u751f\u6210\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u53d1\u56de\u7ed9\u7528\u6237"),(0,a.kt)("li",{parentName:"ul"},"\u7528\u6237\u4e0e\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u65f6\u5019\uff0c\u90fd\u8981\u53d1\u56de\u8fd9\u4e2a JSON \u5bf9\u8c61\uff0c\u670d\u52a1\u5668\u5b8c\u5168\u53ea\u9760\u8fd9\u4e2a\u5bf9\u8c61\u8ba4\u5b9a\u7528\u6237\u8eab\u4efd"),(0,a.kt)("li",{parentName:"ul"},"\u9632\u6b62\u7be1\u6539\u4f1a\u52a0\u4e0a\u7b7e\u540d")),(0,a.kt)("h4",{id:"\u6570\u636e\u7ed3\u6784"},"\u6570\u636e\u7ed3\u6784"),(0,a.kt)("p",null,"Header\uff08\u5934\u90e8\uff09.Payload\uff08\u8d1f\u8f7d\uff09.Signature\uff08\u7b7e\u540d\uff09\uff1a"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Header\uff1aJSON\uff0c\u4f7f\u7528 Base64 URL \u8f6c\u6210\u5b57\u7b26\u4e32"),(0,a.kt)("li",{parentName:"ul"},"Payload\uff1aJSON\uff0c\u4f7f\u7528 Base64 URL \u8f6c\u6210\u5b57\u7b26\u4e32"),(0,a.kt)("li",{parentName:"ul"},"Signature\uff1a\u5bf9\u524d\u4e24\u90e8\u5206\u7684\u7b7e\u540d")),(0,a.kt)("h5",{id:"header"},"Header"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "alg": "HS256", // \u7b7e\u540d\u7684\u7b97\u6cd5\n  "typ": "JWT" // token \u7684\u7c7b\u578b\n}\n')),(0,a.kt)("h5",{id:"payload"},"Payload"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'{\n  // 7 \u4e2a\u5b98\u65b9\u5b57\u6bb5\n  "iss": "\u7b7e\u53d1\u4eba",\n  "exp": "\u8fc7\u671f\u65f6\u95f4",\n  "sub": "\u4e3b\u9898",\n  "aud": "\u53d7\u4f17",\n  "nbf": "\u751f\u6548\u65f6\u95f4",\n  "iat": "\u7b7e\u53d1\u65f6\u95f4",\n  "jti": "\u7f16\u53f7",\n  // \u5b9a\u4e49\u79c1\u6709\u5b57\u6bb5\n  "name": "Chenng" \n}\n')),(0,a.kt)("h5",{id:"signature"},"Signature"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'HMACSHA256(\n  base64UrlEncode(header) + "." +\n  base64UrlEncode(payload),\n  secret) # secret \u79d8\u94a5\u53ea\u6709\u670d\u52a1\u5668\u77e5\u9053\n')),(0,a.kt)("h4",{id:"\u4f7f\u7528\u65b9\u5f0f"},"\u4f7f\u7528\u65b9\u5f0f"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u8fd4\u56de\u7684 JWT\uff0c\u53ef\u4ee5\u50a8\u5b58\u5728 Cookie \u91cc\u9762\uff0c\u4e5f\u53ef\u4ee5\u50a8\u5b58\u5728 localStorage"),(0,a.kt)("li",{parentName:"ul"},"\u653e\u5728 Cookie \u91cc\u9762\u81ea\u52a8\u53d1\u9001\uff0c\u4f46\u662f\u8fd9\u6837\u4e0d\u80fd\u8de8\u57df\uff0c\u6240\u4ee5\u66f4\u597d\u7684\u505a\u6cd5\u662f\u653e\u5728 HTTP \u8bf7\u6c42\u7684\u5934\u4fe1\u606f Authorization \u5b57\u6bb5\u91cc\u9762")),(0,a.kt)("h4",{id:"\u7279\u70b9"},"\u7279\u70b9"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"JWT \u4e0d\u4ec5\u53ef\u4ee5\u7528\u4e8e\u8ba4\u8bc1\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u4ea4\u6362\u4fe1\u606f\u3002\u6709\u6548\u4f7f\u7528 JWT\uff0c\u53ef\u4ee5\u964d\u4f4e\u670d\u52a1\u5668\u67e5\u8be2\u6570\u636e\u5e93\u7684\u6b21\u6570"),(0,a.kt)("li",{parentName:"ul"},"JWT \u7684\u6700\u5927\u7f3a\u70b9\u662f\uff0c\u7531\u4e8e\u670d\u52a1\u5668\u4e0d\u4fdd\u5b58 session \u72b6\u6001\uff0c\u56e0\u6b64\u65e0\u6cd5\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u5e9f\u6b62\u67d0\u4e2a token\uff0c\u6216\u8005\u66f4\u6539 token \u7684\u6743\u9650\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u65e6 JWT \u7b7e\u53d1\u4e86\uff0c\u5728\u5230\u671f\u4e4b\u524d\u5c31\u4f1a\u59cb\u7ec8\u6709\u6548\uff0c\u9664\u975e\u670d\u52a1\u5668\u90e8\u7f72\u989d\u5916\u7684\u903b\u8f91"),(0,a.kt)("li",{parentName:"ul"},"JWT \u672c\u8eab\u5305\u542b\u4e86\u8ba4\u8bc1\u4fe1\u606f\uff0c\u4e00\u65e6\u6cc4\u9732\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u83b7\u5f97\u8be5\u4ee4\u724c\u7684\u6240\u6709\u6743\u9650\u3002\u4e3a\u4e86\u51cf\u5c11\u76d7\u7528\uff0cJWT \u7684\u6709\u6548\u671f\u5e94\u8be5\u8bbe\u7f6e\u5f97\u6bd4\u8f83\u77ed\u3002\u5bf9\u4e8e\u4e00\u4e9b\u6bd4\u8f83\u91cd\u8981\u7684\u6743\u9650\uff0c\u4f7f\u7528\u65f6\u5e94\u8be5\u518d\u6b21\u5bf9\u7528\u6237\u8fdb\u884c\u8ba4\u8bc1")),(0,a.kt)("h2",{id:"koa"},"koa"),(0,a.kt)("h3",{id:"\u6838\u5fc3\u5bf9\u8c61"},"\u6838\u5fc3\u5bf9\u8c61"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"HTTP \u63a5\u6536 \u89e3\u6790 \u54cd\u5e94"),(0,a.kt)("li",{parentName:"ul"},"\u4e2d\u95f4\u4ef6 \u6267\u884c\u4e0a\u4e0b\u6587"),(0,a.kt)("li",{parentName:"ul"},"Koa \u4e2d\u4e00\u5207\u7684\u6d41\u7a0b\u90fd\u662f\u4e2d\u95f4\u4ef6")),(0,a.kt)("h3",{id:"\u6e90\u7801\u7ec4\u6210"},"\u6e90\u7801\u7ec4\u6210"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"application"),(0,a.kt)("li",{parentName:"ul"},"context"),(0,a.kt)("li",{parentName:"ul"},"request"),(0,a.kt)("li",{parentName:"ul"},"response")),(0,a.kt)("h3",{id:"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528"},"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const Koa = require('koa');\n\nconst app = new Koa();\n\nconst mid1 = async (ctx, next) => {\n  ctx.body = 'Hi';\n  await next(); // next \u6267\u884c\u4e0b\u4e00\u4e2a\u4e2d\u95f4\u4ef6\n  ctx.body += ' there';\n};\nconst mid2 = async (ctx, next) => {\n  ctx.type = 'text/html; chartset=utf-8';\n  await next();\n};\nconst mid3 = async (ctx, next) => {\n  ctx.body += ' chenng';\n  await next();\n};\n\napp.use(mid1);\napp.use(mid2);\napp.use(mid3);\n\napp.listen(2333);\n// Hi chenng there\n")),(0,a.kt)("h3",{id:"\u8fd4\u56de\u5a92\u4f53\u8d44\u6e90"},"\u8fd4\u56de\u5a92\u4f53\u8d44\u6e90"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'router\n  .get(\'/api/dynamic_image/codewars\', async (ctx, next) => {\n    const res = await axios.get(\'https://www.codewars.com/users/ringcrl\');\n    const [, kyu, score] = res.data\n      .match(/<div class="stat"><b>Rank:<\\/b>(.+?)<\\/div><div class="stat"><b>Honor:<\\/b>(.+?)<\\/div>/);\n    const svg = `\n      <svg xmlns="http://www.w3.org/2000/svg" width="80" height="20">\n        <rect x="0" y="0" width="80" height="20" fill="#fff" stroke-width="2" stroke="#cccccc"></rect>\n        <rect x="0" y="0" width="50" height="20" fill="#5b5b5b"></rect>\n        <text x="5" y="15" class="small" fill="#fff" style="font-size: 14px;">${kyu}</text>\n        <rect x="50" y="0" width="30" height="20" fill="#3275b0"></rect>\n        <text x="53" y="15" class="small" fill="#fff" style="font-size: 14px">${score}</text>\n      </svg>\n    `;\n    ctx.set(\'Content-Type\', \'image/svg+xml\');\n    ctx.body = Buffer.from(svg);\n    await next();\n  });\n')),(0,a.kt)("h2",{id:"web-api-\u8bbe\u8ba1"},"Web API \u8bbe\u8ba1"),(0,a.kt)("h3",{id:"\u9700\u6c42"},"\u9700\u6c42"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6613\u4e8e\u4f7f\u7528"),(0,a.kt)("li",{parentName:"ul"},"\u4fbf\u4e8e\u4fee\u6539"),(0,a.kt)("li",{parentName:"ul"},"\u5065\u58ee\u6027\u597d"),(0,a.kt)("li",{parentName:"ul"},"\u4e0d\u6015\u516c\u4e4b\u4e8e\u4f17")),(0,a.kt)("h3",{id:"\u91cd\u8981\u51c6\u5219"},"\u91cd\u8981\u51c6\u5219"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u8bbe\u8ba1\u5bb9\u6613\u8bb0\u5fc6\u3001\u529f\u80fd\u4e00\u76ee\u4e86\u7136"),(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u5408\u9002\u7684 HTTP \u65b9\u6cd5"),(0,a.kt)("li",{parentName:"ul"},"\u9009\u62e9\u5408\u9002\u7684\u82f1\u8bed\u5355\u8bcd\uff0c\u6ce8\u610f\u5355\u8bcd\u7684\u5355\u590d\u6570\u5f62\u5f0f"),(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528 OAuth 2.0 \u8fdb\u884c\u8ba4\u8bc1")),(0,a.kt)("p",null,"API \u901a\u7528\u8d44\u6e90\u7f51\u7ad9 ProgrammableWeb\uff08",(0,a.kt)("a",{parentName:"p",href:"http://www.programmableweb.com"},"http://www.programmableweb.com"),"\uff09\u4e2d\u6709\u5404\u79cd\u5df2\u7ecf\u516c\u5f00\u7684 Web API \u6587\u6863\uff0c\u591a\u89c2\u5bdf\u4e00\u4e0b"),(0,a.kt)("h2",{id:"\u516c\u94a5\u52a0\u5bc6\u79c1\u94a5\u89e3\u5bc6"},"\u516c\u94a5\u52a0\u5bc6\u79c1\u94a5\u89e3\u5bc6"),(0,a.kt)("h3",{id:"\u751f\u6210\u516c\u94a5\u79c1\u94a5"},"\u751f\u6210\u516c\u94a5\u79c1\u94a5"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u5229\u7528 openssl \u751f\u6210\u516c\u94a5\u79c1\u94a5 \n\u751f\u6210\u516c\u94a5\uff1aopenssl genrsa -out rsa_private_key.pem 1024 \n\u751f\u6210\u79c1\u94a5\uff1aopenssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem\n")),(0,a.kt)("h3",{id:"crypto-\u4f7f\u7528"},"crypto \u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const crypto = require('crypto');\nconst fs = require('fs');\n\nconst publicKey = fs.readFileSync(`${__dirname}/rsa_public_key.pem`).toString('ascii');\nconst privateKey = fs.readFileSync(`${__dirname}/rsa_private_key.pem`).toString('ascii');\nconsole.log(publicKey);\nconsole.log(privateKey);\nconst data = 'Chenng';\nconsole.log('content: ', data);\n\n//\u516c\u94a5\u52a0\u5bc6\nconst encodeData = crypto.publicEncrypt(\n  publicKey,\n  Buffer.from(data),\n).toString('base64');\nconsole.log('encode: ', encodeData);\n\n//\u79c1\u94a5\u89e3\u5bc6\nconst decodeData = crypto.privateDecrypt(\n  privateKey,\n  Buffer.from(encodeData, 'base64'),\n);\nconsole.log('decode: ', decodeData.toString());\n")),(0,a.kt)("h2",{id:"redis-\u7f13\u5b58\u63a5\u53e3"},"redis \u7f13\u5b58\u63a5\u53e3"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u90e8\u5206\u4e0d\u7528\u5b9e\u65f6\u66f4\u65b0\u7684\u6570\u636e\u4f7f\u7528 redis \u8fdb\u884c\u7f13\u5b58"),(0,a.kt)("li",{parentName:"ul"},"\u4f7f\u7528 node-schedule \u5728\u6bcf\u665a\u5b9a\u65f6\u8c03\u7528\u63a5\u53e3")),(0,a.kt)("h3",{id:"redis-\u4f7f\u7528"},"redis \u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const redis = require('redis');\nconst redisClient = redis.createClient();\nconst getAsync = promisify(redisClient.get).bind(redisClient);\n\nlet codewarsRes = JSON.parse(await getAsync('codewarsRes'));\nif (!codewarsRes) {\n  const res = await axios.get('https://www.codewars.com/users/ringcrl');\n  codewarsRes = res.data;\n  redisClient.set('codewarsRes', JSON.stringify(codewarsRes), 'EX', 86000);\n}\n")),(0,a.kt)("h2",{id:"node-schedule-\u4f7f\u7528"},"node-schedule \u4f7f\u7528"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const schedule = require('node-schedule');\nconst axios = require('axios');\n\nschedule.scheduleJob('* 23 59 * *', function () {\n  axios.get('https://static.chenng.cn/api/dynamic_image/leetcode_problems');\n  axios.get('https://static.chenng.cn/api/dynamic_image/leetcode');\n  axios.get('https://static.chenng.cn/api/dynamic_image/codewars');\n});\n")),(0,a.kt)("h2",{id:"\u8de8\u57df\u5171\u4eab-cookie"},"\u8de8\u57df\u5171\u4eab Cookie"),(0,a.kt)("h3",{id:"\u4e8c\u7ea7\u57df\u540d\u5171\u4eab-cookie"},"\u4e8c\u7ea7\u57df\u540d\u5171\u4eab Cookie"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"app.use(express.session({\n  secret: conf.secret,\n  maxAge: new Date(Date.now() + 3600000),\n  cookie: {\n    path: '/',\n    domain: '.yourdomain.com',\n  },\n  store: new MongoStore(conf.sessiondb),\n}));\n")),(0,a.kt)("h3",{id:"\u6dd8\u5b9d\u5929\u732b\u5171\u4eab-cookie"},"\u6dd8\u5b9d\u5929\u732b\u5171\u4eab Cookie"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u6dd8\u5b9d\u767b\u5f55\u540e ",(0,a.kt)("inlineCode",{parentName:"li"},".taobao.com")," \u7684\u63a5\u53e3\u4f1a\u5e26\u4e0a Cookie"),(0,a.kt)("li",{parentName:"ul"},"\u5929\u732b\u4f7f\u7528 JSONP \u8bf7\u6c42\u4e00\u4e2a ",(0,a.kt)("inlineCode",{parentName:"li"},".taobao.com")," \u7684\u63a5\u53e3\uff0c\u63a5\u53e3\u8fd4\u56de\u4e00\u6bb5 script\uff0c\u76f4\u63a5\u628a\u5e26\u6709 Cookie \u7684\u5bf9\u8c61\u8bbe\u7f6e\u5230 window \u4e0b")),(0,a.kt)("h1",{id:"\u53c2\u8003\u5730\u5740"},"\u53c2\u8003\u5730\u5740"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://www.amazon.cn/dp/B01MYX8XG1"},"\u300aNode.js\u786c\u5b9e\u6218\uff1a115\u4e2a\u6838\u5fc3\u6280\u5de7\u300b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/i0natan/nodebestpractices"},"i0natan/nodebestpractices")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://juejin.im/post/5c63b5676fb9a049ac79a798?utm_source=gold_browser_extension"},"\u771f-Node\u591a\u7ebf\u7a0b")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/CyC2018/CS-Notes"},"CS-Notes"))))}u.isMDXComponent=!0}}]);